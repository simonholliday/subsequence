<!doctype html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="generator" content="pdoc 16.0.0"/>
    <title>subsequence API documentation</title>

    <style>/*! * Bootstrap Reboot v5.0.0 (https://getbootstrap.com/) * Copyright 2011-2021 The Bootstrap Authors * Copyright 2011-2021 Twitter, Inc. * Licensed under MIT (https://github.com/twbs/bootstrap/blob/main/LICENSE) * Forked from Normalize.css, licensed MIT (https://github.com/necolas/normalize.css/blob/master/LICENSE.md) */*,::after,::before{box-sizing:border-box}@media (prefers-reduced-motion:no-preference){:root{scroll-behavior:smooth}}body{margin:0;font-family:system-ui,-apple-system,"Segoe UI",Roboto,"Helvetica Neue",Arial,"Noto Sans","Liberation Sans",sans-serif,"Apple Color Emoji","Segoe UI Emoji","Segoe UI Symbol","Noto Color Emoji";font-size:1rem;font-weight:400;line-height:1.5;color:#212529;background-color:#fff;-webkit-text-size-adjust:100%;-webkit-tap-highlight-color:transparent}hr{margin:1rem 0;color:inherit;background-color:currentColor;border:0;opacity:.25}hr:not([size]){height:1px}h1,h2,h3,h4,h5,h6{margin-top:0;margin-bottom:.5rem;font-weight:500;line-height:1.2}h1{font-size:calc(1.375rem + 1.5vw)}@media (min-width:1200px){h1{font-size:2.5rem}}h2{font-size:calc(1.325rem + .9vw)}@media (min-width:1200px){h2{font-size:2rem}}h3{font-size:calc(1.3rem + .6vw)}@media (min-width:1200px){h3{font-size:1.75rem}}h4{font-size:calc(1.275rem + .3vw)}@media (min-width:1200px){h4{font-size:1.5rem}}h5{font-size:1.25rem}h6{font-size:1rem}p{margin-top:0;margin-bottom:1rem}abbr[data-bs-original-title],abbr[title]{-webkit-text-decoration:underline dotted;text-decoration:underline dotted;cursor:help;-webkit-text-decoration-skip-ink:none;text-decoration-skip-ink:none}address{margin-bottom:1rem;font-style:normal;line-height:inherit}ol,ul{padding-left:2rem}dl,ol,ul{margin-top:0;margin-bottom:1rem}ol ol,ol ul,ul ol,ul ul{margin-bottom:0}dt{font-weight:700}dd{margin-bottom:.5rem;margin-left:0}blockquote{margin:0 0 1rem}b,strong{font-weight:bolder}small{font-size:.875em}mark{padding:.2em;background-color:#fcf8e3}sub,sup{position:relative;font-size:.75em;line-height:0;vertical-align:baseline}sub{bottom:-.25em}sup{top:-.5em}a{color:#0d6efd;text-decoration:underline}a:hover{color:#0a58ca}a:not([href]):not([class]),a:not([href]):not([class]):hover{color:inherit;text-decoration:none}code,kbd,pre,samp{font-family:SFMono-Regular,Menlo,Monaco,Consolas,"Liberation Mono","Courier New",monospace;font-size:1em;direction:ltr;unicode-bidi:bidi-override}pre{display:block;margin-top:0;margin-bottom:1rem;overflow:auto;font-size:.875em}pre code{font-size:inherit;color:inherit;word-break:normal}code{font-size:.875em;color:#d63384;word-wrap:break-word}a>code{color:inherit}kbd{padding:.2rem .4rem;font-size:.875em;color:#fff;background-color:#212529;border-radius:.2rem}kbd kbd{padding:0;font-size:1em;font-weight:700}figure{margin:0 0 1rem}img,svg{vertical-align:middle}table{caption-side:bottom;border-collapse:collapse}caption{padding-top:.5rem;padding-bottom:.5rem;color:#6c757d;text-align:left}th{text-align:inherit;text-align:-webkit-match-parent}tbody,td,tfoot,th,thead,tr{border-color:inherit;border-style:solid;border-width:0}label{display:inline-block}button{border-radius:0}button:focus:not(:focus-visible){outline:0}button,input,optgroup,select,textarea{margin:0;font-family:inherit;font-size:inherit;line-height:inherit}button,select{text-transform:none}[role=button]{cursor:pointer}select{word-wrap:normal}select:disabled{opacity:1}[list]::-webkit-calendar-picker-indicator{display:none}[type=button],[type=reset],[type=submit],button{-webkit-appearance:button}[type=button]:not(:disabled),[type=reset]:not(:disabled),[type=submit]:not(:disabled),button:not(:disabled){cursor:pointer}::-moz-focus-inner{padding:0;border-style:none}textarea{resize:vertical}fieldset{min-width:0;padding:0;margin:0;border:0}legend{float:left;width:100%;padding:0;margin-bottom:.5rem;font-size:calc(1.275rem + .3vw);line-height:inherit}@media (min-width:1200px){legend{font-size:1.5rem}}legend+*{clear:left}::-webkit-datetime-edit-day-field,::-webkit-datetime-edit-fields-wrapper,::-webkit-datetime-edit-hour-field,::-webkit-datetime-edit-minute,::-webkit-datetime-edit-month-field,::-webkit-datetime-edit-text,::-webkit-datetime-edit-year-field{padding:0}::-webkit-inner-spin-button{height:auto}[type=search]{outline-offset:-2px;-webkit-appearance:textfield}::-webkit-search-decoration{-webkit-appearance:none}::-webkit-color-swatch-wrapper{padding:0}::file-selector-button{font:inherit}::-webkit-file-upload-button{font:inherit;-webkit-appearance:button}output{display:inline-block}iframe{border:0}summary{display:list-item;cursor:pointer}progress{vertical-align:baseline}[hidden]{display:none!important}</style>
    <style>/*! syntax-highlighting.css */pre{line-height:125%;}span.linenos{color:inherit; background-color:transparent; padding-left:5px; padding-right:20px;}.pdoc-code .hll{background-color:#ffffcc}.pdoc-code{background:#f8f8f8;}.pdoc-code .c{color:#3D7B7B; font-style:italic}.pdoc-code .err{border:1px solid #FF0000}.pdoc-code .k{color:#008000; font-weight:bold}.pdoc-code .o{color:#666666}.pdoc-code .ch{color:#3D7B7B; font-style:italic}.pdoc-code .cm{color:#3D7B7B; font-style:italic}.pdoc-code .cp{color:#9C6500}.pdoc-code .cpf{color:#3D7B7B; font-style:italic}.pdoc-code .c1{color:#3D7B7B; font-style:italic}.pdoc-code .cs{color:#3D7B7B; font-style:italic}.pdoc-code .gd{color:#A00000}.pdoc-code .ge{font-style:italic}.pdoc-code .gr{color:#E40000}.pdoc-code .gh{color:#000080; font-weight:bold}.pdoc-code .gi{color:#008400}.pdoc-code .go{color:#717171}.pdoc-code .gp{color:#000080; font-weight:bold}.pdoc-code .gs{font-weight:bold}.pdoc-code .gu{color:#800080; font-weight:bold}.pdoc-code .gt{color:#0044DD}.pdoc-code .kc{color:#008000; font-weight:bold}.pdoc-code .kd{color:#008000; font-weight:bold}.pdoc-code .kn{color:#008000; font-weight:bold}.pdoc-code .kp{color:#008000}.pdoc-code .kr{color:#008000; font-weight:bold}.pdoc-code .kt{color:#B00040}.pdoc-code .m{color:#666666}.pdoc-code .s{color:#BA2121}.pdoc-code .na{color:#687822}.pdoc-code .nb{color:#008000}.pdoc-code .nc{color:#0000FF; font-weight:bold}.pdoc-code .no{color:#880000}.pdoc-code .nd{color:#AA22FF}.pdoc-code .ni{color:#717171; font-weight:bold}.pdoc-code .ne{color:#CB3F38; font-weight:bold}.pdoc-code .nf{color:#0000FF}.pdoc-code .nl{color:#767600}.pdoc-code .nn{color:#0000FF; font-weight:bold}.pdoc-code .nt{color:#008000; font-weight:bold}.pdoc-code .nv{color:#19177C}.pdoc-code .ow{color:#AA22FF; font-weight:bold}.pdoc-code .w{color:#bbbbbb}.pdoc-code .mb{color:#666666}.pdoc-code .mf{color:#666666}.pdoc-code .mh{color:#666666}.pdoc-code .mi{color:#666666}.pdoc-code .mo{color:#666666}.pdoc-code .sa{color:#BA2121}.pdoc-code .sb{color:#BA2121}.pdoc-code .sc{color:#BA2121}.pdoc-code .dl{color:#BA2121}.pdoc-code .sd{color:#BA2121; font-style:italic}.pdoc-code .s2{color:#BA2121}.pdoc-code .se{color:#AA5D1F; font-weight:bold}.pdoc-code .sh{color:#BA2121}.pdoc-code .si{color:#A45A77; font-weight:bold}.pdoc-code .sx{color:#008000}.pdoc-code .sr{color:#A45A77}.pdoc-code .s1{color:#BA2121}.pdoc-code .ss{color:#19177C}.pdoc-code .bp{color:#008000}.pdoc-code .fm{color:#0000FF}.pdoc-code .vc{color:#19177C}.pdoc-code .vg{color:#19177C}.pdoc-code .vi{color:#19177C}.pdoc-code .vm{color:#19177C}.pdoc-code .il{color:#666666}</style>
    <style>/*! theme.css */:root{--pdoc-background:#fff;}.pdoc{--text:#212529;--muted:#6c757d;--link:#3660a5;--link-hover:#1659c5;--code:#f8f8f8;--active:#fff598;--accent:#eee;--accent2:#c1c1c1;--nav-hover:rgba(255, 255, 255, 0.5);--name:#0066BB;--def:#008800;--annotation:#007020;}</style>
    <style>/*! layout.css */html, body{width:100%;height:100%;}html, main{scroll-behavior:smooth;}body{background-color:var(--pdoc-background);}@media (max-width:769px){#navtoggle{cursor:pointer;position:absolute;width:50px;height:40px;top:1rem;right:1rem;border-color:var(--text);color:var(--text);display:flex;opacity:0.8;z-index:999;}#navtoggle:hover{opacity:1;}#togglestate + div{display:none;}#togglestate:checked + div{display:inherit;}main, header{padding:2rem 3vw;}header + main{margin-top:-3rem;}.git-button{display:none !important;}nav input[type="search"]{max-width:77%;}nav input[type="search"]:first-child{margin-top:-6px;}nav input[type="search"]:valid ~ *{display:none !important;}}@media (min-width:770px){:root{--sidebar-width:clamp(12.5rem, 28vw, 22rem);}nav{position:fixed;overflow:auto;height:100vh;width:var(--sidebar-width);}main, header{padding:3rem 2rem 3rem calc(var(--sidebar-width) + 3rem);width:calc(54rem + var(--sidebar-width));max-width:100%;}header + main{margin-top:-4rem;}#navtoggle{display:none;}}#togglestate{position:absolute;height:0;opacity:0;}nav.pdoc{--pad:clamp(0.5rem, 2vw, 1.75rem);--indent:1.5rem;background-color:var(--accent);border-right:1px solid var(--accent2);box-shadow:0 0 20px rgba(50, 50, 50, .2) inset;padding:0 0 0 var(--pad);overflow-wrap:anywhere;scrollbar-width:thin; scrollbar-color:var(--accent2) transparent; z-index:1}nav.pdoc::-webkit-scrollbar{width:.4rem; }nav.pdoc::-webkit-scrollbar-thumb{background-color:var(--accent2); }nav.pdoc > div{padding:var(--pad) 0;}nav.pdoc .module-list-button{display:inline-flex;align-items:center;color:var(--text);border-color:var(--muted);margin-bottom:1rem;}nav.pdoc .module-list-button:hover{border-color:var(--text);}nav.pdoc input[type=search]{display:block;outline-offset:0;width:calc(100% - var(--pad));}nav.pdoc .logo{max-width:calc(100% - var(--pad));max-height:35vh;display:block;margin:0 auto 1rem;transform:translate(calc(-.5 * var(--pad)), 0);}nav.pdoc ul{list-style:none;padding-left:0;}nav.pdoc > div > ul{margin-left:calc(0px - var(--pad));}nav.pdoc li a{padding:.2rem 0 .2rem calc(var(--pad) + var(--indent));}nav.pdoc > div > ul > li > a{padding-left:var(--pad);}nav.pdoc li{transition:all 100ms;}nav.pdoc li:hover{background-color:var(--nav-hover);}nav.pdoc a, nav.pdoc a:hover{color:var(--text);}nav.pdoc a{display:block;}nav.pdoc > h2:first-of-type{margin-top:1.5rem;}nav.pdoc .class:before{content:"class ";color:var(--muted);}nav.pdoc .function:after{content:"()";color:var(--muted);}nav.pdoc footer:before{content:"";display:block;width:calc(100% - var(--pad));border-top:solid var(--accent2) 1px;margin-top:1.5rem;padding-top:.5rem;}nav.pdoc footer{font-size:small;}</style>
    <style>/*! content.css */.pdoc{color:var(--text);box-sizing:border-box;line-height:1.5;background:none;}.pdoc .pdoc-button{cursor:pointer;display:inline-block;border:solid black 1px;border-radius:2px;font-size:.75rem;padding:calc(0.5em - 1px) 1em;transition:100ms all;}.pdoc .alert{padding:1rem 1rem 1rem calc(1.5rem + 24px);border:1px solid transparent;border-radius:.25rem;background-repeat:no-repeat;background-position:.75rem center;margin-bottom:1rem;}.pdoc .alert > em{display:none;}.pdoc .alert > *:last-child{margin-bottom:0;}.pdoc .alert.note{color:#084298;background-color:#cfe2ff;border-color:#b6d4fe;background-image:url("data:image/svg+xml,%3Csvg%20xmlns%3D%22http%3A//www.w3.org/2000/svg%22%20width%3D%2224%22%20height%3D%2224%22%20fill%3D%22%23084298%22%20viewBox%3D%220%200%2016%2016%22%3E%3Cpath%20d%3D%22M8%2016A8%208%200%201%200%208%200a8%208%200%200%200%200%2016zm.93-9.412-1%204.705c-.07.34.029.533.304.533.194%200%20.487-.07.686-.246l-.088.416c-.287.346-.92.598-1.465.598-.703%200-1.002-.422-.808-1.319l.738-3.468c.064-.293.006-.399-.287-.47l-.451-.081.082-.381%202.29-.287zM8%205.5a1%201%200%201%201%200-2%201%201%200%200%201%200%202z%22/%3E%3C/svg%3E");}.pdoc .alert.tip{color:#0a3622;background-color:#d1e7dd;border-color:#a3cfbb;background-image:url("data:image/svg+xml,%3Csvg%20xmlns%3D%22http%3A//www.w3.org/2000/svg%22%20width%3D%2224%22%20height%3D%2224%22%20fill%3D%22%230a3622%22%20viewBox%3D%220%200%2016%2016%22%3E%3Cpath%20d%3D%22M2%206a6%206%200%201%201%2010.174%204.31c-.203.196-.359.4-.453.619l-.762%201.769A.5.5%200%200%201%2010.5%2013a.5.5%200%200%201%200%201%20.5.5%200%200%201%200%201l-.224.447a1%201%200%200%201-.894.553H6.618a1%201%200%200%201-.894-.553L5.5%2015a.5.5%200%200%201%200-1%20.5.5%200%200%201%200-1%20.5.5%200%200%201-.46-.302l-.761-1.77a2%202%200%200%200-.453-.618A5.98%205.98%200%200%201%202%206m6-5a5%205%200%200%200-3.479%208.592c.263.254.514.564.676.941L5.83%2012h4.342l.632-1.467c.162-.377.413-.687.676-.941A5%205%200%200%200%208%201%22/%3E%3C/svg%3E");}.pdoc .alert.important{color:#055160;background-color:#cff4fc;border-color:#9eeaf9;background-image:url("data:image/svg+xml,%3Csvg%20xmlns%3D%22http%3A//www.w3.org/2000/svg%22%20width%3D%2224%22%20height%3D%2224%22%20fill%3D%22%23055160%22%20viewBox%3D%220%200%2016%2016%22%3E%3Cpath%20d%3D%22M2%200a2%202%200%200%200-2%202v12a2%202%200%200%200%202%202h12a2%202%200%200%200%202-2V2a2%202%200%200%200-2-2zm6%204c.535%200%20.954.462.9.995l-.35%203.507a.552.552%200%200%201-1.1%200L7.1%204.995A.905.905%200%200%201%208%204m.002%206a1%201%200%201%201%200%202%201%201%200%200%201%200-2%22/%3E%3C/svg%3E");}.pdoc .alert.warning{color:#664d03;background-color:#fff3cd;border-color:#ffecb5;background-image:url("data:image/svg+xml,%3Csvg%20xmlns%3D%22http%3A//www.w3.org/2000/svg%22%20width%3D%2224%22%20height%3D%2224%22%20fill%3D%22%23664d03%22%20viewBox%3D%220%200%2016%2016%22%3E%3Cpath%20d%3D%22M8.982%201.566a1.13%201.13%200%200%200-1.96%200L.165%2013.233c-.457.778.091%201.767.98%201.767h13.713c.889%200%201.438-.99.98-1.767L8.982%201.566zM8%205c.535%200%20.954.462.9.995l-.35%203.507a.552.552%200%200%201-1.1%200L7.1%205.995A.905.905%200%200%201%208%205zm.002%206a1%201%200%201%201%200%202%201%201%200%200%201%200-2z%22/%3E%3C/svg%3E");}.pdoc .alert.caution{color:#842029;background-color:#f8d7da;border-color:#f5c2c7;background-image:url("data:image/svg+xml,%3Csvg%20xmlns%3D%22http%3A//www.w3.org/2000/svg%22%20width%3D%2224%22%20height%3D%2224%22%20fill%3D%22%23842029%22%20viewBox%3D%220%200%2016%2016%22%3E%3Cpath%20d%3D%22M11.46.146A.5.5%200%200%200%2011.107%200H4.893a.5.5%200%200%200-.353.146L.146%204.54A.5.5%200%200%200%200%204.893v6.214a.5.5%200%200%200%20.146.353l4.394%204.394a.5.5%200%200%200%20.353.146h6.214a.5.5%200%200%200%20.353-.146l4.394-4.394a.5.5%200%200%200%20.146-.353V4.893a.5.5%200%200%200-.146-.353zM8%204c.535%200%20.954.462.9.995l-.35%203.507a.552.552%200%200%201-1.1%200L7.1%204.995A.905.905%200%200%201%208%204m.002%206a1%201%200%201%201%200%202%201%201%200%200%201%200-2%22/%3E%3C/svg%3E");}.pdoc .alert.danger{color:#842029;background-color:#f8d7da;border-color:#f5c2c7;background-image:url("data:image/svg+xml,%3Csvg%20xmlns%3D%22http%3A//www.w3.org/2000/svg%22%20width%3D%2224%22%20height%3D%2224%22%20fill%3D%22%23842029%22%20viewBox%3D%220%200%2016%2016%22%3E%3Cpath%20d%3D%22M5.52.359A.5.5%200%200%201%206%200h4a.5.5%200%200%201%20.474.658L8.694%206H12.5a.5.5%200%200%201%20.395.807l-7%209a.5.5%200%200%201-.873-.454L6.823%209.5H3.5a.5.5%200%200%201-.48-.641l2.5-8.5z%22/%3E%3C/svg%3E");}.pdoc .visually-hidden{position:absolute !important;width:1px !important;height:1px !important;padding:0 !important;margin:-1px !important;overflow:hidden !important;clip:rect(0, 0, 0, 0) !important;white-space:nowrap !important;border:0 !important;}.pdoc h1, .pdoc h2, .pdoc h3{font-weight:300;margin:.3em 0;padding:.2em 0;}.pdoc > section:not(.module-info) h1{font-size:1.5rem;font-weight:500;}.pdoc > section:not(.module-info) h2{font-size:1.4rem;font-weight:500;}.pdoc > section:not(.module-info) h3{font-size:1.3rem;font-weight:500;}.pdoc > section:not(.module-info) h4{font-size:1.2rem;}.pdoc > section:not(.module-info) h5{font-size:1.1rem;}.pdoc a{text-decoration:none;color:var(--link);}.pdoc a:hover{color:var(--link-hover);}.pdoc blockquote{margin-left:2rem;}.pdoc pre{border-top:1px solid var(--accent2);border-bottom:1px solid var(--accent2);margin-top:0;margin-bottom:1em;padding:.5rem 0 .5rem .5rem;overflow-x:auto;background-color:var(--code);}.pdoc code{color:var(--text);padding:.2em .4em;margin:0;font-size:85%;background-color:var(--accent);border-radius:6px;}.pdoc a > code{color:inherit;}.pdoc pre > code{display:inline-block;font-size:inherit;background:none;border:none;padding:0;}.pdoc > section:not(.module-info){margin-bottom:1.5rem;}.pdoc .modulename{margin-top:0;font-weight:bold;}.pdoc .modulename a{color:var(--link);transition:100ms all;}.pdoc .git-button{float:right;border:solid var(--link) 1px;}.pdoc .git-button:hover{background-color:var(--link);color:var(--pdoc-background);}.view-source-toggle-state,.view-source-toggle-state ~ .pdoc-code{display:none;}.view-source-toggle-state:checked ~ .pdoc-code{display:block;}.view-source-button{display:inline-block;float:right;font-size:.75rem;line-height:1.5rem;color:var(--muted);padding:0 .4rem 0 1.3rem;cursor:pointer;text-indent:-2px;}.view-source-button > span{visibility:hidden;}.module-info .view-source-button{float:none;display:flex;justify-content:flex-end;margin:-1.2rem .4rem -.2rem 0;}.view-source-button::before{position:absolute;content:"View Source";display:list-item;list-style-type:disclosure-closed;}.view-source-toggle-state:checked ~ .attr .view-source-button::before,.view-source-toggle-state:checked ~ .view-source-button::before{list-style-type:disclosure-open;}.pdoc .docstring{margin-bottom:1.5rem;}.pdoc section:not(.module-info) .docstring{margin-left:clamp(0rem, 5vw - 2rem, 1rem);}.pdoc .docstring .pdoc-code{margin-left:1em;margin-right:1em;}.pdoc h1:target,.pdoc h2:target,.pdoc h3:target,.pdoc h4:target,.pdoc h5:target,.pdoc h6:target,.pdoc .pdoc-code > pre > span:target{background-color:var(--active);box-shadow:-1rem 0 0 0 var(--active);}.pdoc .pdoc-code > pre > span:target{display:block;}.pdoc div:target > .attr,.pdoc section:target > .attr,.pdoc dd:target > a{background-color:var(--active);}.pdoc *{scroll-margin:2rem;}.pdoc .pdoc-code .linenos{user-select:none;}.pdoc .attr:hover{filter:contrast(0.95);}.pdoc section, .pdoc .classattr{position:relative;}.pdoc .headerlink{--width:clamp(1rem, 3vw, 2rem);position:absolute;top:0;left:calc(0rem - var(--width));transition:all 100ms ease-in-out;opacity:0;}.pdoc .headerlink::before{content:"#";display:block;text-align:center;width:var(--width);height:2.3rem;line-height:2.3rem;font-size:1.5rem;}.pdoc .attr:hover ~ .headerlink,.pdoc *:target > .headerlink,.pdoc .headerlink:hover{opacity:1;}.pdoc .attr{display:block;margin:.5rem 0 .5rem;padding:.4rem .4rem .4rem 1rem;background-color:var(--accent);overflow-x:auto;}.pdoc .classattr{margin-left:2rem;}.pdoc .decorator-deprecated{color:#842029;}.pdoc .decorator-deprecated ~ span{filter:grayscale(1) opacity(0.8);}.pdoc .name{color:var(--name);font-weight:bold;}.pdoc .def{color:var(--def);font-weight:bold;}.pdoc .signature{background-color:transparent;}.pdoc .param, .pdoc .return-annotation{white-space:pre;}.pdoc .signature.multiline .param{display:block;}.pdoc .signature.condensed .param{display:inline-block;}.pdoc .annotation{color:var(--annotation);}.pdoc .view-value-toggle-state,.pdoc .view-value-toggle-state ~ .default_value{display:none;}.pdoc .view-value-toggle-state:checked ~ .default_value{display:inherit;}.pdoc .view-value-button{font-size:.5rem;vertical-align:middle;border-style:dashed;margin-top:-0.1rem;}.pdoc .view-value-button:hover{background:white;}.pdoc .view-value-button::before{content:"show";text-align:center;width:2.2em;display:inline-block;}.pdoc .view-value-toggle-state:checked ~ .view-value-button::before{content:"hide";}.pdoc .inherited{margin-left:2rem;}.pdoc .inherited dt{font-weight:700;}.pdoc .inherited dt, .pdoc .inherited dd{display:inline;margin-left:0;margin-bottom:.5rem;}.pdoc .inherited dd:not(:last-child):after{content:", ";}.pdoc .inherited .class:before{content:"class ";}.pdoc .inherited .function a:after{content:"()";}.pdoc .search-result .docstring{overflow:auto;max-height:25vh;}.pdoc .search-result.focused > .attr{background-color:var(--active);}.pdoc .attribution{margin-top:2rem;display:block;opacity:0.5;transition:all 200ms;filter:grayscale(100%);}.pdoc .attribution:hover{opacity:1;filter:grayscale(0%);}.pdoc .attribution img{margin-left:5px;height:27px;vertical-align:bottom;width:50px;transition:all 200ms;}.pdoc table{display:block;width:max-content;max-width:100%;overflow:auto;margin-bottom:1rem;}.pdoc table th{font-weight:600;}.pdoc table th, .pdoc table td{padding:6px 13px;border:1px solid var(--accent2);}</style>
    <style>/*! custom.css */</style></head>
<body>
    <nav class="pdoc">
        <label id="navtoggle" for="togglestate" class="pdoc-button"><svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 30 30'><path stroke-linecap='round' stroke="currentColor" stroke-miterlimit='10' stroke-width='2' d='M4 7h22M4 15h22M4 23h22'/></svg></label>
        <input id="togglestate" type="checkbox" aria-hidden="true" tabindex="-1">
        <div>

            <input type="search" placeholder="Search..." role="searchbox" aria-label="search"
                   pattern=".+" required>


            <h2>Submodules</h2>
            <ul>
                    <li><a href="subsequence/chord_graphs.html">chord_graphs</a></li>
                    <li><a href="subsequence/chords.html">chords</a></li>
                    <li><a href="subsequence/composition.html">composition</a></li>
                    <li><a href="subsequence/constants.html">constants</a></li>
                    <li><a href="subsequence/display.html">display</a></li>
                    <li><a href="subsequence/event_emitter.html">event_emitter</a></li>
                    <li><a href="subsequence/harmonic_state.html">harmonic_state</a></li>
                    <li><a href="subsequence/harmony.html">harmony</a></li>
                    <li><a href="subsequence/intervals.html">intervals</a></li>
                    <li><a href="subsequence/live_client.html">live_client</a></li>
                    <li><a href="subsequence/live_server.html">live_server</a></li>
                    <li><a href="subsequence/markov_chain.html">markov_chain</a></li>
                    <li><a href="subsequence/motif.html">motif</a></li>
                    <li><a href="subsequence/pattern.html">pattern</a></li>
                    <li><a href="subsequence/pattern_builder.html">pattern_builder</a></li>
                    <li><a href="subsequence/sequence_utils.html">sequence_utils</a></li>
                    <li><a href="subsequence/sequencer.html">sequencer</a></li>
                    <li><a href="subsequence/swing.html">swing</a></li>
                    <li><a href="subsequence/voicings.html">voicings</a></li>
                    <li><a href="subsequence/weighted_graph.html">weighted_graph</a></li>
            </ul>

            <h2>API Documentation</h2>
                <ul class="memberlist">
            <li>
                    <a class="class" href="#Composition">Composition</a>
                            <ul class="memberlist">
                        <li>
                                <a class="function" href="#Composition.__init__">Composition</a>
                        </li>
                        <li>
                                <a class="variable" href="#Composition.output_device">output_device</a>
                        </li>
                        <li>
                                <a class="variable" href="#Composition.bpm">bpm</a>
                        </li>
                        <li>
                                <a class="variable" href="#Composition.key">key</a>
                        </li>
                        <li>
                                <a class="variable" href="#Composition.data">data</a>
                        </li>
                        <li>
                                <a class="function" href="#Composition.harmony">harmony</a>
                        </li>
                        <li>
                                <a class="function" href="#Composition.on_event">on_event</a>
                        </li>
                        <li>
                                <a class="function" href="#Composition.seed">seed</a>
                        </li>
                        <li>
                                <a class="function" href="#Composition.display">display</a>
                        </li>
                        <li>
                                <a class="function" href="#Composition.midi_input">midi_input</a>
                        </li>
                        <li>
                                <a class="function" href="#Composition.live">live</a>
                        </li>
                        <li>
                                <a class="function" href="#Composition.set_bpm">set_bpm</a>
                        </li>
                        <li>
                                <a class="function" href="#Composition.live_info">live_info</a>
                        </li>
                        <li>
                                <a class="function" href="#Composition.mute">mute</a>
                        </li>
                        <li>
                                <a class="function" href="#Composition.unmute">unmute</a>
                        </li>
                        <li>
                                <a class="function" href="#Composition.schedule">schedule</a>
                        </li>
                        <li>
                                <a class="function" href="#Composition.form">form</a>
                        </li>
                        <li>
                                <a class="function" href="#Composition.pattern">pattern</a>
                        </li>
                        <li>
                                <a class="function" href="#Composition.layer">layer</a>
                        </li>
                        <li>
                                <a class="function" href="#Composition.play">play</a>
                        </li>
                </ul>

            </li>
    </ul>



        <a class="attribution" title="pdoc: Python API documentation generator" href="https://pdoc.dev" target="_blank">
            built with <span class="visually-hidden">pdoc</span><img
                alt="pdoc logo"
                src="data:image/svg+xml,%3Csvg%20xmlns%3D%22http%3A//www.w3.org/2000/svg%22%20role%3D%22img%22%20aria-label%3D%22pdoc%20logo%22%20width%3D%22300%22%20height%3D%22160%22%20viewBox%3D%220%200%20150%2080%22%3E%3Ctitle%3Epdoc%3C/title%3E%3Cpath%20d%3D%22M132.316%2048.886c.276-4.679%202.342-6.698%204.409-7.982s4.27-1.165%206.751-1.055c1.586.07%203.044.156%204.222-.482%201.142-.619%202.026-1.932%202.162-3.739.268-3.576-1.929-5.368-5.006-5.551s-7.599.524-10.517%201.606c-4.455%201.652-8.588%206.606-9.552%208.992s-2.342%206.193-1.745%2010.873%202.664%209.221%205.878%2011.79%205.878%203.808%2010.103%204.312%203.444.229%206.062.229%205.006-2.202%204.914-4.909-2.296-5.001-4.501-4.863-3.077.505-5.281.229-7.715-2.064-7.899-9.451z%22%20fill%3D%22%23198754%22/%3E%3Ccircle%20cx%3D%22101.504%22%20cy%3D%2248.943%22%20r%3D%2214.208%22%20fill%3D%22none%22%20stroke%3D%22%23198754%22%20stroke-width%3D%229.354%22/%3E%3Cpath%20d%3D%22M87.81.002c-3.637.065-5.001.454-7.014%201.232s-3.443%201.363-6.3%204.282c-1.723%201.76-3.148%205.019-3.776%207.329-.413%201.521-.316%202.63-.316%202.63l-.195%2034.612c.065%205.774-6.755%208.305-9.612%208.37s-9.678-1.038-9.743-9.408%207.128-9.521%208.362-9.521c1.413-.13%202.526-.021%203.718-.016%202.071.009%204.157-.778%204.092-4.671s-4.157-4.736-4.157-4.736c-6.3-.843-11.43%202.206-11.43%202.206S40.917%2038.15%2041.372%2049.634%2051.568%2068.19%2061.311%2068.125s18.316-7.007%2018.445-17.193l.13-22.772c.046-2.291%202.683-3.644%204.476-4.203.745-.232%201.694-.274%201.694-.274l10.457-.13s4.871-.324%207.729-3.114%204.352-6.294%204.352-6.294.974-3.049.13-4.606-.195-1.233-2.792-3.309-8.573-4.477-8.573-4.477S91.447-.063%2087.81.002zM0%2047.169l.065%2028.417S0%2080.127%204.481%2079.997s5.072-3.866%205.049-4.152l-.113-28.482s1.624-7.656%209.937-7.721%2010.002%206.942%2010.002%208.499-.909%2010.51-9.093%2010.51c-.948%200-2.99-.567-4.145-.272-3.919%201-3.194%204.554-3.194%204.554s.065%205.061%207.404%204.996%2018.575-6.034%2018.575-19.074S26.953%2030.04%2019.549%2029.91%201.234%2035.296%200%2047.169z%22%20fill%3D%22%23198754%22/%3E%3Cg%20transform%3D%22matrix%28.325601%200%200%20.325256%20-10.32669%20-45.802786%29%22%3E%3Ccircle%20cx%3D%22297.554%22%20cy%3D%22172.286%22%20r%3D%2216.5%22%20fill%3D%22%23fff%22/%3E%3Cellipse%20cx%3D%22297.709%22%20cy%3D%22172.642%22%20rx%3D%2211.071%22%20ry%3D%2210.871%22%20fill%3D%22%23105a48%22/%3E%3Ccircle%20cx%3D%22304.104%22%20cy%3D%22167.667%22%20r%3D%224.5%22%20fill%3D%22%23fff%22/%3E%3C/g%3E%3Cpath%20d%3D%22M94.661%2017.032l.893-1.476s.99.714%201.916.925%201.575.114%202.955.114l14.565-.162c1.283-.032%203.085-.762%203.02-3.293s-.373-3.503-.373-3.503l1.283-.487s.52.503.877%201.573.309%201.995.292%202.66-.227%201.541-.227%201.541%201.564-.308%202.359-1.038.823-.779%201.489-1.508.812-.86.812-.86.552-.13.877.26.341.957.065%201.46-1.672%202.206-3.247%203.066-2.76%201.427-3.929%201.768-3.848.73-7.063.714l-10.944-.114s-2.143-.081-3.02-.373-2.241-.973-2.598-1.265z%22%20fill%3D%22%23d36d49%22/%3E%3Cg%20fill%3D%22%23105a48%22%3E%3Cellipse%20cx%3D%2293.052%22%20cy%3D%2243.567%22%20rx%3D%22.869%22%20ry%3D%221.014%22%20transform%3D%22rotate%28341.022%29%22/%3E%3Cellipse%20cx%3D%22104.3%22%20cy%3D%22-16.184%22%20rx%3D%22.865%22%20ry%3D%221.009%22%20transform%3D%22rotate%2814.786%29%22/%3E%3C/g%3E%3C/svg%3E"/>
        </a>
</div>
    </nav>
    <main class="pdoc">
            <section class="module-info">
                    <h1 class="modulename">
subsequence    </h1>

                
                        <input id="mod-subsequence-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">

                        <label class="view-source-button" for="mod-subsequence-view-source"><span>View Source</span></label>

                        <div class="pdoc-code codehilite"><pre><span></span><span id="L-1"><a href="#L-1"><span class="linenos">1</span></a><span class="kn">import</span><span class="w"> </span><span class="nn">subsequence.composition</span>
</span><span id="L-2"><a href="#L-2"><span class="linenos">2</span></a>
</span><span id="L-3"><a href="#L-3"><span class="linenos">3</span></a>
</span><span id="L-4"><a href="#L-4"><span class="linenos">4</span></a><span class="n">Composition</span> <span class="o">=</span> <span class="n">subsequence</span><span class="o">.</span><span class="n">composition</span><span class="o">.</span><span class="n">Composition</span>
</span></pre></div>


            </section>
                <section id="Composition">
                            <input id="Composition-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr class">
            
    <span class="def">class</span>
    <span class="name">Composition</span>:

                <label class="view-source-button" for="Composition-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#Composition"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="Composition-491"><a href="#Composition-491"><span class="linenos"> 491</span></a><span class="k">class</span><span class="w"> </span><span class="nc">Composition</span><span class="p">:</span>
</span><span id="Composition-492"><a href="#Composition-492"><span class="linenos"> 492</span></a>
</span><span id="Composition-493"><a href="#Composition-493"><span class="linenos"> 493</span></a><span class="w">	</span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="Composition-494"><a href="#Composition-494"><span class="linenos"> 494</span></a><span class="sd">	Top-level composition object that owns the sequencer, harmonic state, and pattern registry.</span>
</span><span id="Composition-495"><a href="#Composition-495"><span class="linenos"> 495</span></a><span class="sd">	&quot;&quot;&quot;</span>
</span><span id="Composition-496"><a href="#Composition-496"><span class="linenos"> 496</span></a>
</span><span id="Composition-497"><a href="#Composition-497"><span class="linenos"> 497</span></a>	<span class="k">def</span><span class="w"> </span><span class="fm">__init__</span> <span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">output_device</span><span class="p">:</span> <span class="n">typing</span><span class="o">.</span><span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">bpm</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">120</span><span class="p">,</span> <span class="n">key</span><span class="p">:</span> <span class="n">typing</span><span class="o">.</span><span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">seed</span><span class="p">:</span> <span class="n">typing</span><span class="o">.</span><span class="n">Optional</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="Composition-498"><a href="#Composition-498"><span class="linenos"> 498</span></a>
</span><span id="Composition-499"><a href="#Composition-499"><span class="linenos"> 499</span></a><span class="w">		</span><span class="sd">&quot;&quot;&quot;Initialize a composition with MIDI output device, tempo, and optional key.</span>
</span><span id="Composition-500"><a href="#Composition-500"><span class="linenos"> 500</span></a>
</span><span id="Composition-501"><a href="#Composition-501"><span class="linenos"> 501</span></a><span class="sd">		Parameters:</span>
</span><span id="Composition-502"><a href="#Composition-502"><span class="linenos"> 502</span></a><span class="sd">			output_device: MIDI output device name (e.g., `&quot;Device Name:Port 1 16:0&quot;`).</span>
</span><span id="Composition-503"><a href="#Composition-503"><span class="linenos"> 503</span></a><span class="sd">				When omitted, auto-discovers available devices - uses the only device</span>
</span><span id="Composition-504"><a href="#Composition-504"><span class="linenos"> 504</span></a><span class="sd">				if one is found, or prompts the user to choose if multiple are available.</span>
</span><span id="Composition-505"><a href="#Composition-505"><span class="linenos"> 505</span></a><span class="sd">			bpm: Tempo in beats per minute (default 120)</span>
</span><span id="Composition-506"><a href="#Composition-506"><span class="linenos"> 506</span></a><span class="sd">			key: Root key name (e.g., `&quot;C&quot;`, `&quot;F#&quot;`, `&quot;Bb&quot;`). Required if using `harmony()`.</span>
</span><span id="Composition-507"><a href="#Composition-507"><span class="linenos"> 507</span></a><span class="sd">			seed: Optional random seed. When set, all randomness (chord progressions, form</span>
</span><span id="Composition-508"><a href="#Composition-508"><span class="linenos"> 508</span></a><span class="sd">				transitions, pattern builder functions) becomes deterministic and repeatable.</span>
</span><span id="Composition-509"><a href="#Composition-509"><span class="linenos"> 509</span></a>
</span><span id="Composition-510"><a href="#Composition-510"><span class="linenos"> 510</span></a><span class="sd">		Example:</span>
</span><span id="Composition-511"><a href="#Composition-511"><span class="linenos"> 511</span></a><span class="sd">			```python</span>
</span><span id="Composition-512"><a href="#Composition-512"><span class="linenos"> 512</span></a><span class="sd">			composition = subsequence.Composition(</span>
</span><span id="Composition-513"><a href="#Composition-513"><span class="linenos"> 513</span></a><span class="sd">				output_device=&quot;Scarlett 2i4 USB:Scarlett 2i4 USB MIDI 1 16:0&quot;,</span>
</span><span id="Composition-514"><a href="#Composition-514"><span class="linenos"> 514</span></a><span class="sd">				bpm=125,</span>
</span><span id="Composition-515"><a href="#Composition-515"><span class="linenos"> 515</span></a><span class="sd">				key=&quot;E&quot;,</span>
</span><span id="Composition-516"><a href="#Composition-516"><span class="linenos"> 516</span></a><span class="sd">				seed=42</span>
</span><span id="Composition-517"><a href="#Composition-517"><span class="linenos"> 517</span></a><span class="sd">			)</span>
</span><span id="Composition-518"><a href="#Composition-518"><span class="linenos"> 518</span></a><span class="sd">			```</span>
</span><span id="Composition-519"><a href="#Composition-519"><span class="linenos"> 519</span></a><span class="sd">		&quot;&quot;&quot;</span>
</span><span id="Composition-520"><a href="#Composition-520"><span class="linenos"> 520</span></a>
</span><span id="Composition-521"><a href="#Composition-521"><span class="linenos"> 521</span></a>		<span class="bp">self</span><span class="o">.</span><span class="n">output_device</span> <span class="o">=</span> <span class="n">output_device</span>
</span><span id="Composition-522"><a href="#Composition-522"><span class="linenos"> 522</span></a>		<span class="bp">self</span><span class="o">.</span><span class="n">bpm</span> <span class="o">=</span> <span class="n">bpm</span>
</span><span id="Composition-523"><a href="#Composition-523"><span class="linenos"> 523</span></a>		<span class="bp">self</span><span class="o">.</span><span class="n">key</span> <span class="o">=</span> <span class="n">key</span>
</span><span id="Composition-524"><a href="#Composition-524"><span class="linenos"> 524</span></a>		<span class="bp">self</span><span class="o">.</span><span class="n">_seed</span><span class="p">:</span> <span class="n">typing</span><span class="o">.</span><span class="n">Optional</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="n">seed</span>
</span><span id="Composition-525"><a href="#Composition-525"><span class="linenos"> 525</span></a>
</span><span id="Composition-526"><a href="#Composition-526"><span class="linenos"> 526</span></a>		<span class="bp">self</span><span class="o">.</span><span class="n">_sequencer</span> <span class="o">=</span> <span class="n">subsequence</span><span class="o">.</span><span class="n">sequencer</span><span class="o">.</span><span class="n">Sequencer</span><span class="p">(</span>
</span><span id="Composition-527"><a href="#Composition-527"><span class="linenos"> 527</span></a>			<span class="n">output_device_name</span> <span class="o">=</span> <span class="n">output_device</span><span class="p">,</span>
</span><span id="Composition-528"><a href="#Composition-528"><span class="linenos"> 528</span></a>			<span class="n">initial_bpm</span> <span class="o">=</span> <span class="n">bpm</span>
</span><span id="Composition-529"><a href="#Composition-529"><span class="linenos"> 529</span></a>		<span class="p">)</span>
</span><span id="Composition-530"><a href="#Composition-530"><span class="linenos"> 530</span></a>
</span><span id="Composition-531"><a href="#Composition-531"><span class="linenos"> 531</span></a>		<span class="bp">self</span><span class="o">.</span><span class="n">_harmonic_state</span><span class="p">:</span> <span class="n">typing</span><span class="o">.</span><span class="n">Optional</span><span class="p">[</span><span class="n">subsequence</span><span class="o">.</span><span class="n">harmonic_state</span><span class="o">.</span><span class="n">HarmonicState</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="Composition-532"><a href="#Composition-532"><span class="linenos"> 532</span></a>		<span class="bp">self</span><span class="o">.</span><span class="n">_harmony_cycle_beats</span><span class="p">:</span> <span class="n">typing</span><span class="o">.</span><span class="n">Optional</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="Composition-533"><a href="#Composition-533"><span class="linenos"> 533</span></a>		<span class="bp">self</span><span class="o">.</span><span class="n">_harmony_reschedule_lookahead</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mi">1</span>
</span><span id="Composition-534"><a href="#Composition-534"><span class="linenos"> 534</span></a>		<span class="bp">self</span><span class="o">.</span><span class="n">_pending_patterns</span><span class="p">:</span> <span class="n">typing</span><span class="o">.</span><span class="n">List</span><span class="p">[</span><span class="n">_PendingPattern</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="Composition-535"><a href="#Composition-535"><span class="linenos"> 535</span></a>		<span class="bp">self</span><span class="o">.</span><span class="n">_pending_scheduled</span><span class="p">:</span> <span class="n">typing</span><span class="o">.</span><span class="n">List</span><span class="p">[</span><span class="n">_PendingScheduled</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="Composition-536"><a href="#Composition-536"><span class="linenos"> 536</span></a>		<span class="bp">self</span><span class="o">.</span><span class="n">_form_state</span><span class="p">:</span> <span class="n">typing</span><span class="o">.</span><span class="n">Optional</span><span class="p">[</span><span class="n">FormState</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="Composition-537"><a href="#Composition-537"><span class="linenos"> 537</span></a>		<span class="bp">self</span><span class="o">.</span><span class="n">_builder_bar</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">0</span>
</span><span id="Composition-538"><a href="#Composition-538"><span class="linenos"> 538</span></a>		<span class="bp">self</span><span class="o">.</span><span class="n">_display</span><span class="p">:</span> <span class="n">typing</span><span class="o">.</span><span class="n">Optional</span><span class="p">[</span><span class="n">subsequence</span><span class="o">.</span><span class="n">display</span><span class="o">.</span><span class="n">Display</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="Composition-539"><a href="#Composition-539"><span class="linenos"> 539</span></a>		<span class="bp">self</span><span class="o">.</span><span class="n">_live_server</span><span class="p">:</span> <span class="n">typing</span><span class="o">.</span><span class="n">Optional</span><span class="p">[</span><span class="n">subsequence</span><span class="o">.</span><span class="n">live_server</span><span class="o">.</span><span class="n">LiveServer</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="Composition-540"><a href="#Composition-540"><span class="linenos"> 540</span></a>		<span class="bp">self</span><span class="o">.</span><span class="n">_is_live</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span>
</span><span id="Composition-541"><a href="#Composition-541"><span class="linenos"> 541</span></a>		<span class="bp">self</span><span class="o">.</span><span class="n">_running_patterns</span><span class="p">:</span> <span class="n">typing</span><span class="o">.</span><span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">typing</span><span class="o">.</span><span class="n">Any</span><span class="p">]</span> <span class="o">=</span> <span class="p">{}</span>
</span><span id="Composition-542"><a href="#Composition-542"><span class="linenos"> 542</span></a>		<span class="bp">self</span><span class="o">.</span><span class="n">_input_device</span><span class="p">:</span> <span class="n">typing</span><span class="o">.</span><span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="Composition-543"><a href="#Composition-543"><span class="linenos"> 543</span></a>		<span class="bp">self</span><span class="o">.</span><span class="n">_clock_follow</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span>
</span><span id="Composition-544"><a href="#Composition-544"><span class="linenos"> 544</span></a>		<span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">:</span> <span class="n">typing</span><span class="o">.</span><span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">typing</span><span class="o">.</span><span class="n">Any</span><span class="p">]</span> <span class="o">=</span> <span class="p">{}</span>
</span><span id="Composition-545"><a href="#Composition-545"><span class="linenos"> 545</span></a>
</span><span id="Composition-546"><a href="#Composition-546"><span class="linenos"> 546</span></a>	<span class="k">def</span><span class="w"> </span><span class="nf">harmony</span> <span class="p">(</span>
</span><span id="Composition-547"><a href="#Composition-547"><span class="linenos"> 547</span></a>		<span class="bp">self</span><span class="p">,</span>
</span><span id="Composition-548"><a href="#Composition-548"><span class="linenos"> 548</span></a>		<span class="n">style</span><span class="p">:</span> <span class="n">typing</span><span class="o">.</span><span class="n">Union</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">subsequence</span><span class="o">.</span><span class="n">chord_graphs</span><span class="o">.</span><span class="n">ChordGraph</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;functional_major&quot;</span><span class="p">,</span>
</span><span id="Composition-549"><a href="#Composition-549"><span class="linenos"> 549</span></a>		<span class="n">cycle_beats</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">4</span><span class="p">,</span>
</span><span id="Composition-550"><a href="#Composition-550"><span class="linenos"> 550</span></a>		<span class="n">dominant_7th</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
</span><span id="Composition-551"><a href="#Composition-551"><span class="linenos"> 551</span></a>		<span class="n">gravity</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">1.0</span><span class="p">,</span>
</span><span id="Composition-552"><a href="#Composition-552"><span class="linenos"> 552</span></a>		<span class="n">minor_weight</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">0.0</span><span class="p">,</span>
</span><span id="Composition-553"><a href="#Composition-553"><span class="linenos"> 553</span></a>		<span class="n">reschedule_lookahead</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mi">1</span>
</span><span id="Composition-554"><a href="#Composition-554"><span class="linenos"> 554</span></a>	<span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="Composition-555"><a href="#Composition-555"><span class="linenos"> 555</span></a>
</span><span id="Composition-556"><a href="#Composition-556"><span class="linenos"> 556</span></a><span class="w">		</span><span class="sd">&quot;&quot;&quot;Configure the harmonic state and chord change cycle for this composition.</span>
</span><span id="Composition-557"><a href="#Composition-557"><span class="linenos"> 557</span></a>
</span><span id="Composition-558"><a href="#Composition-558"><span class="linenos"> 558</span></a><span class="sd">		Parameters:</span>
</span><span id="Composition-559"><a href="#Composition-559"><span class="linenos"> 559</span></a><span class="sd">			style: Chord graph style - `&quot;diatonic_major&quot;`, `&quot;turnaround&quot;`, `&quot;dark_minor&quot;`, or a `ChordGraph` instance</span>
</span><span id="Composition-560"><a href="#Composition-560"><span class="linenos"> 560</span></a><span class="sd">			cycle_beats: How often chords change (in beats, default 4)</span>
</span><span id="Composition-561"><a href="#Composition-561"><span class="linenos"> 561</span></a><span class="sd">			dominant_7th: Include dominant seventh chords (default True)</span>
</span><span id="Composition-562"><a href="#Composition-562"><span class="linenos"> 562</span></a><span class="sd">			gravity: Key gravity blend 0.0-1.0 (default 1.0). Higher values favor chords closer to the tonic.</span>
</span><span id="Composition-563"><a href="#Composition-563"><span class="linenos"> 563</span></a><span class="sd">			minor_weight: Weight for minor vs major turnarounds 0.0-1.0 (default 0.0, turnaround graph only)</span>
</span><span id="Composition-564"><a href="#Composition-564"><span class="linenos"> 564</span></a><span class="sd">			reschedule_lookahead: Reschedule lookahead in beats (default 1)</span>
</span><span id="Composition-565"><a href="#Composition-565"><span class="linenos"> 565</span></a>
</span><span id="Composition-566"><a href="#Composition-566"><span class="linenos"> 566</span></a><span class="sd">		Example:</span>
</span><span id="Composition-567"><a href="#Composition-567"><span class="linenos"> 567</span></a><span class="sd">			```python</span>
</span><span id="Composition-568"><a href="#Composition-568"><span class="linenos"> 568</span></a><span class="sd">			composition.harmony(</span>
</span><span id="Composition-569"><a href="#Composition-569"><span class="linenos"> 569</span></a><span class="sd">				style=&quot;dark_minor&quot;,</span>
</span><span id="Composition-570"><a href="#Composition-570"><span class="linenos"> 570</span></a><span class="sd">				cycle_beats=4,</span>
</span><span id="Composition-571"><a href="#Composition-571"><span class="linenos"> 571</span></a><span class="sd">				dominant_7th=True,</span>
</span><span id="Composition-572"><a href="#Composition-572"><span class="linenos"> 572</span></a><span class="sd">				gravity=0.8</span>
</span><span id="Composition-573"><a href="#Composition-573"><span class="linenos"> 573</span></a><span class="sd">			)</span>
</span><span id="Composition-574"><a href="#Composition-574"><span class="linenos"> 574</span></a><span class="sd">			```</span>
</span><span id="Composition-575"><a href="#Composition-575"><span class="linenos"> 575</span></a><span class="sd">		&quot;&quot;&quot;</span>
</span><span id="Composition-576"><a href="#Composition-576"><span class="linenos"> 576</span></a>
</span><span id="Composition-577"><a href="#Composition-577"><span class="linenos"> 577</span></a>		<span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">key</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="Composition-578"><a href="#Composition-578"><span class="linenos"> 578</span></a>			<span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Cannot configure harmony without a key - set key in the Composition constructor&quot;</span><span class="p">)</span>
</span><span id="Composition-579"><a href="#Composition-579"><span class="linenos"> 579</span></a>
</span><span id="Composition-580"><a href="#Composition-580"><span class="linenos"> 580</span></a>		<span class="bp">self</span><span class="o">.</span><span class="n">_harmonic_state</span> <span class="o">=</span> <span class="n">subsequence</span><span class="o">.</span><span class="n">harmonic_state</span><span class="o">.</span><span class="n">HarmonicState</span><span class="p">(</span>
</span><span id="Composition-581"><a href="#Composition-581"><span class="linenos"> 581</span></a>			<span class="n">key_name</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">key</span><span class="p">,</span>
</span><span id="Composition-582"><a href="#Composition-582"><span class="linenos"> 582</span></a>			<span class="n">graph_style</span> <span class="o">=</span> <span class="n">style</span><span class="p">,</span>
</span><span id="Composition-583"><a href="#Composition-583"><span class="linenos"> 583</span></a>			<span class="n">include_dominant_7th</span> <span class="o">=</span> <span class="n">dominant_7th</span><span class="p">,</span>
</span><span id="Composition-584"><a href="#Composition-584"><span class="linenos"> 584</span></a>			<span class="n">key_gravity_blend</span> <span class="o">=</span> <span class="n">gravity</span><span class="p">,</span>
</span><span id="Composition-585"><a href="#Composition-585"><span class="linenos"> 585</span></a>			<span class="n">minor_turnaround_weight</span> <span class="o">=</span> <span class="n">minor_weight</span>
</span><span id="Composition-586"><a href="#Composition-586"><span class="linenos"> 586</span></a>		<span class="p">)</span>
</span><span id="Composition-587"><a href="#Composition-587"><span class="linenos"> 587</span></a>
</span><span id="Composition-588"><a href="#Composition-588"><span class="linenos"> 588</span></a>		<span class="bp">self</span><span class="o">.</span><span class="n">_harmony_cycle_beats</span> <span class="o">=</span> <span class="n">cycle_beats</span>
</span><span id="Composition-589"><a href="#Composition-589"><span class="linenos"> 589</span></a>		<span class="bp">self</span><span class="o">.</span><span class="n">_harmony_reschedule_lookahead</span> <span class="o">=</span> <span class="n">reschedule_lookahead</span>
</span><span id="Composition-590"><a href="#Composition-590"><span class="linenos"> 590</span></a>
</span><span id="Composition-591"><a href="#Composition-591"><span class="linenos"> 591</span></a>	<span class="k">def</span><span class="w"> </span><span class="nf">on_event</span> <span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">event_name</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">callback</span><span class="p">:</span> <span class="n">typing</span><span class="o">.</span><span class="n">Callable</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="n">typing</span><span class="o">.</span><span class="n">Any</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="Composition-592"><a href="#Composition-592"><span class="linenos"> 592</span></a>
</span><span id="Composition-593"><a href="#Composition-593"><span class="linenos"> 593</span></a><span class="w">		</span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="Composition-594"><a href="#Composition-594"><span class="linenos"> 594</span></a><span class="sd">		Register a callback for a sequencer event (e.g., &quot;bar&quot;, &quot;start&quot;, &quot;stop&quot;).</span>
</span><span id="Composition-595"><a href="#Composition-595"><span class="linenos"> 595</span></a><span class="sd">		&quot;&quot;&quot;</span>
</span><span id="Composition-596"><a href="#Composition-596"><span class="linenos"> 596</span></a>
</span><span id="Composition-597"><a href="#Composition-597"><span class="linenos"> 597</span></a>		<span class="bp">self</span><span class="o">.</span><span class="n">_sequencer</span><span class="o">.</span><span class="n">on_event</span><span class="p">(</span><span class="n">event_name</span><span class="p">,</span> <span class="n">callback</span><span class="p">)</span>
</span><span id="Composition-598"><a href="#Composition-598"><span class="linenos"> 598</span></a>
</span><span id="Composition-599"><a href="#Composition-599"><span class="linenos"> 599</span></a>	<span class="k">def</span><span class="w"> </span><span class="nf">seed</span> <span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">:</span> <span class="nb">int</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="Composition-600"><a href="#Composition-600"><span class="linenos"> 600</span></a>
</span><span id="Composition-601"><a href="#Composition-601"><span class="linenos"> 601</span></a><span class="w">		</span><span class="sd">&quot;&quot;&quot;Set a random seed for deterministic, repeatable output.</span>
</span><span id="Composition-602"><a href="#Composition-602"><span class="linenos"> 602</span></a>
</span><span id="Composition-603"><a href="#Composition-603"><span class="linenos"> 603</span></a><span class="sd">		When set, all randomness - chord progressions, form transitions, and pattern</span>
</span><span id="Composition-604"><a href="#Composition-604"><span class="linenos"> 604</span></a><span class="sd">		builder functions - produces the same results on every run. Pattern builders</span>
</span><span id="Composition-605"><a href="#Composition-605"><span class="linenos"> 605</span></a><span class="sd">		access the seeded RNG via ``p.rng``.</span>
</span><span id="Composition-606"><a href="#Composition-606"><span class="linenos"> 606</span></a>
</span><span id="Composition-607"><a href="#Composition-607"><span class="linenos"> 607</span></a><span class="sd">		Parameters:</span>
</span><span id="Composition-608"><a href="#Composition-608"><span class="linenos"> 608</span></a><span class="sd">			value: Integer seed value</span>
</span><span id="Composition-609"><a href="#Composition-609"><span class="linenos"> 609</span></a>
</span><span id="Composition-610"><a href="#Composition-610"><span class="linenos"> 610</span></a><span class="sd">		Example:</span>
</span><span id="Composition-611"><a href="#Composition-611"><span class="linenos"> 611</span></a><span class="sd">			```python</span>
</span><span id="Composition-612"><a href="#Composition-612"><span class="linenos"> 612</span></a><span class="sd">			composition.seed(42)</span>
</span><span id="Composition-613"><a href="#Composition-613"><span class="linenos"> 613</span></a><span class="sd">			composition.play()  # same output every time</span>
</span><span id="Composition-614"><a href="#Composition-614"><span class="linenos"> 614</span></a><span class="sd">			```</span>
</span><span id="Composition-615"><a href="#Composition-615"><span class="linenos"> 615</span></a><span class="sd">		&quot;&quot;&quot;</span>
</span><span id="Composition-616"><a href="#Composition-616"><span class="linenos"> 616</span></a>
</span><span id="Composition-617"><a href="#Composition-617"><span class="linenos"> 617</span></a>		<span class="bp">self</span><span class="o">.</span><span class="n">_seed</span> <span class="o">=</span> <span class="n">value</span>
</span><span id="Composition-618"><a href="#Composition-618"><span class="linenos"> 618</span></a>
</span><span id="Composition-619"><a href="#Composition-619"><span class="linenos"> 619</span></a>	<span class="k">def</span><span class="w"> </span><span class="nf">display</span> <span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">enabled</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="Composition-620"><a href="#Composition-620"><span class="linenos"> 620</span></a>
</span><span id="Composition-621"><a href="#Composition-621"><span class="linenos"> 621</span></a><span class="w">		</span><span class="sd">&quot;&quot;&quot;Enable or disable the live terminal status line.</span>
</span><span id="Composition-622"><a href="#Composition-622"><span class="linenos"> 622</span></a>
</span><span id="Composition-623"><a href="#Composition-623"><span class="linenos"> 623</span></a><span class="sd">		When enabled, a persistent status line shows the current bar, section,</span>
</span><span id="Composition-624"><a href="#Composition-624"><span class="linenos"> 624</span></a><span class="sd">		chord, BPM, and key. Log messages scroll above it without disruption.</span>
</span><span id="Composition-625"><a href="#Composition-625"><span class="linenos"> 625</span></a>
</span><span id="Composition-626"><a href="#Composition-626"><span class="linenos"> 626</span></a><span class="sd">		Parameters:</span>
</span><span id="Composition-627"><a href="#Composition-627"><span class="linenos"> 627</span></a><span class="sd">			enabled: Turn the display on (True) or off (False)</span>
</span><span id="Composition-628"><a href="#Composition-628"><span class="linenos"> 628</span></a>
</span><span id="Composition-629"><a href="#Composition-629"><span class="linenos"> 629</span></a><span class="sd">		Example:</span>
</span><span id="Composition-630"><a href="#Composition-630"><span class="linenos"> 630</span></a><span class="sd">			```python</span>
</span><span id="Composition-631"><a href="#Composition-631"><span class="linenos"> 631</span></a><span class="sd">			composition.display()  # enable before play()</span>
</span><span id="Composition-632"><a href="#Composition-632"><span class="linenos"> 632</span></a><span class="sd">			composition.play()</span>
</span><span id="Composition-633"><a href="#Composition-633"><span class="linenos"> 633</span></a><span class="sd">			```</span>
</span><span id="Composition-634"><a href="#Composition-634"><span class="linenos"> 634</span></a><span class="sd">		&quot;&quot;&quot;</span>
</span><span id="Composition-635"><a href="#Composition-635"><span class="linenos"> 635</span></a>
</span><span id="Composition-636"><a href="#Composition-636"><span class="linenos"> 636</span></a>		<span class="k">if</span> <span class="n">enabled</span><span class="p">:</span>
</span><span id="Composition-637"><a href="#Composition-637"><span class="linenos"> 637</span></a>			<span class="bp">self</span><span class="o">.</span><span class="n">_display</span> <span class="o">=</span> <span class="n">subsequence</span><span class="o">.</span><span class="n">display</span><span class="o">.</span><span class="n">Display</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
</span><span id="Composition-638"><a href="#Composition-638"><span class="linenos"> 638</span></a>		<span class="k">else</span><span class="p">:</span>
</span><span id="Composition-639"><a href="#Composition-639"><span class="linenos"> 639</span></a>			<span class="bp">self</span><span class="o">.</span><span class="n">_display</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="Composition-640"><a href="#Composition-640"><span class="linenos"> 640</span></a>
</span><span id="Composition-641"><a href="#Composition-641"><span class="linenos"> 641</span></a>	<span class="k">def</span><span class="w"> </span><span class="nf">midi_input</span> <span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">device</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">clock_follow</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="Composition-642"><a href="#Composition-642"><span class="linenos"> 642</span></a>
</span><span id="Composition-643"><a href="#Composition-643"><span class="linenos"> 643</span></a><span class="w">		</span><span class="sd">&quot;&quot;&quot;Configure MIDI input for receiving external clock and transport control.</span>
</span><span id="Composition-644"><a href="#Composition-644"><span class="linenos"> 644</span></a>
</span><span id="Composition-645"><a href="#Composition-645"><span class="linenos"> 645</span></a><span class="sd">		When ``clock_follow`` is enabled, the sequencer follows incoming MIDI</span>
</span><span id="Composition-646"><a href="#Composition-646"><span class="linenos"> 646</span></a><span class="sd">		clock ticks instead of using its own internal clock. The BPM set in</span>
</span><span id="Composition-647"><a href="#Composition-647"><span class="linenos"> 647</span></a><span class="sd">		the constructor is ignored - tempo is determined by the external</span>
</span><span id="Composition-648"><a href="#Composition-648"><span class="linenos"> 648</span></a><span class="sd">		source. MIDI start, stop, and continue messages control transport.</span>
</span><span id="Composition-649"><a href="#Composition-649"><span class="linenos"> 649</span></a>
</span><span id="Composition-650"><a href="#Composition-650"><span class="linenos"> 650</span></a><span class="sd">		When ``clock_follow`` is disabled (default), the input port is opened</span>
</span><span id="Composition-651"><a href="#Composition-651"><span class="linenos"> 651</span></a><span class="sd">		but no clock or transport messages are acted on.</span>
</span><span id="Composition-652"><a href="#Composition-652"><span class="linenos"> 652</span></a>
</span><span id="Composition-653"><a href="#Composition-653"><span class="linenos"> 653</span></a><span class="sd">		Parameters:</span>
</span><span id="Composition-654"><a href="#Composition-654"><span class="linenos"> 654</span></a><span class="sd">			device: MIDI input device name (e.g., ``&quot;Device Name:Port 1 16:0&quot;``)</span>
</span><span id="Composition-655"><a href="#Composition-655"><span class="linenos"> 655</span></a><span class="sd">			clock_follow: Follow external MIDI clock for timing (default False)</span>
</span><span id="Composition-656"><a href="#Composition-656"><span class="linenos"> 656</span></a>
</span><span id="Composition-657"><a href="#Composition-657"><span class="linenos"> 657</span></a><span class="sd">		Example:</span>
</span><span id="Composition-658"><a href="#Composition-658"><span class="linenos"> 658</span></a><span class="sd">			```python</span>
</span><span id="Composition-659"><a href="#Composition-659"><span class="linenos"> 659</span></a><span class="sd">			composition.midi_input(</span>
</span><span id="Composition-660"><a href="#Composition-660"><span class="linenos"> 660</span></a><span class="sd">				device=&quot;Scarlett 2i4 USB:Scarlett 2i4 USB MIDI 1 16:0&quot;,</span>
</span><span id="Composition-661"><a href="#Composition-661"><span class="linenos"> 661</span></a><span class="sd">				clock_follow=True</span>
</span><span id="Composition-662"><a href="#Composition-662"><span class="linenos"> 662</span></a><span class="sd">			)</span>
</span><span id="Composition-663"><a href="#Composition-663"><span class="linenos"> 663</span></a><span class="sd">			```</span>
</span><span id="Composition-664"><a href="#Composition-664"><span class="linenos"> 664</span></a><span class="sd">		&quot;&quot;&quot;</span>
</span><span id="Composition-665"><a href="#Composition-665"><span class="linenos"> 665</span></a>
</span><span id="Composition-666"><a href="#Composition-666"><span class="linenos"> 666</span></a>		<span class="bp">self</span><span class="o">.</span><span class="n">_input_device</span> <span class="o">=</span> <span class="n">device</span>
</span><span id="Composition-667"><a href="#Composition-667"><span class="linenos"> 667</span></a>		<span class="bp">self</span><span class="o">.</span><span class="n">_clock_follow</span> <span class="o">=</span> <span class="n">clock_follow</span>
</span><span id="Composition-668"><a href="#Composition-668"><span class="linenos"> 668</span></a>
</span><span id="Composition-669"><a href="#Composition-669"><span class="linenos"> 669</span></a>	<span class="k">def</span><span class="w"> </span><span class="nf">live</span> <span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">port</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">5555</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="Composition-670"><a href="#Composition-670"><span class="linenos"> 670</span></a>
</span><span id="Composition-671"><a href="#Composition-671"><span class="linenos"> 671</span></a><span class="w">		</span><span class="sd">&quot;&quot;&quot;Enable the live coding server for runtime interaction.</span>
</span><span id="Composition-672"><a href="#Composition-672"><span class="linenos"> 672</span></a>
</span><span id="Composition-673"><a href="#Composition-673"><span class="linenos"> 673</span></a><span class="sd">		Starts a TCP eval server on ``localhost`` that accepts Python code from</span>
</span><span id="Composition-674"><a href="#Composition-674"><span class="linenos"> 674</span></a><span class="sd">		any source - the bundled REPL client, an editor plugin, or a raw socket.</span>
</span><span id="Composition-675"><a href="#Composition-675"><span class="linenos"> 675</span></a><span class="sd">		The server launches when ``play()`` is called and stops when playback ends.</span>
</span><span id="Composition-676"><a href="#Composition-676"><span class="linenos"> 676</span></a>
</span><span id="Composition-677"><a href="#Composition-677"><span class="linenos"> 677</span></a><span class="sd">		Parameters:</span>
</span><span id="Composition-678"><a href="#Composition-678"><span class="linenos"> 678</span></a><span class="sd">			port: TCP port to listen on (default 5555)</span>
</span><span id="Composition-679"><a href="#Composition-679"><span class="linenos"> 679</span></a>
</span><span id="Composition-680"><a href="#Composition-680"><span class="linenos"> 680</span></a><span class="sd">		Example:</span>
</span><span id="Composition-681"><a href="#Composition-681"><span class="linenos"> 681</span></a><span class="sd">			```python</span>
</span><span id="Composition-682"><a href="#Composition-682"><span class="linenos"> 682</span></a><span class="sd">			composition.live()      # enable before play()</span>
</span><span id="Composition-683"><a href="#Composition-683"><span class="linenos"> 683</span></a><span class="sd">			composition.display()</span>
</span><span id="Composition-684"><a href="#Composition-684"><span class="linenos"> 684</span></a><span class="sd">			composition.play()</span>
</span><span id="Composition-685"><a href="#Composition-685"><span class="linenos"> 685</span></a><span class="sd">			```</span>
</span><span id="Composition-686"><a href="#Composition-686"><span class="linenos"> 686</span></a>
</span><span id="Composition-687"><a href="#Composition-687"><span class="linenos"> 687</span></a><span class="sd">			Then in another terminal::</span>
</span><span id="Composition-688"><a href="#Composition-688"><span class="linenos"> 688</span></a>
</span><span id="Composition-689"><a href="#Composition-689"><span class="linenos"> 689</span></a><span class="sd">				python -m subsequence.live_client</span>
</span><span id="Composition-690"><a href="#Composition-690"><span class="linenos"> 690</span></a><span class="sd">		&quot;&quot;&quot;</span>
</span><span id="Composition-691"><a href="#Composition-691"><span class="linenos"> 691</span></a>
</span><span id="Composition-692"><a href="#Composition-692"><span class="linenos"> 692</span></a>		<span class="bp">self</span><span class="o">.</span><span class="n">_live_server</span> <span class="o">=</span> <span class="n">subsequence</span><span class="o">.</span><span class="n">live_server</span><span class="o">.</span><span class="n">LiveServer</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">port</span><span class="o">=</span><span class="n">port</span><span class="p">)</span>
</span><span id="Composition-693"><a href="#Composition-693"><span class="linenos"> 693</span></a>		<span class="bp">self</span><span class="o">.</span><span class="n">_is_live</span> <span class="o">=</span> <span class="kc">True</span>
</span><span id="Composition-694"><a href="#Composition-694"><span class="linenos"> 694</span></a>
</span><span id="Composition-695"><a href="#Composition-695"><span class="linenos"> 695</span></a>	<span class="k">def</span><span class="w"> </span><span class="nf">set_bpm</span> <span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">bpm</span><span class="p">:</span> <span class="nb">int</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="Composition-696"><a href="#Composition-696"><span class="linenos"> 696</span></a>
</span><span id="Composition-697"><a href="#Composition-697"><span class="linenos"> 697</span></a><span class="w">		</span><span class="sd">&quot;&quot;&quot;Change the tempo while the composition is playing.</span>
</span><span id="Composition-698"><a href="#Composition-698"><span class="linenos"> 698</span></a>
</span><span id="Composition-699"><a href="#Composition-699"><span class="linenos"> 699</span></a><span class="sd">		When ``clock_follow`` is enabled, BPM is controlled by the external clock</span>
</span><span id="Composition-700"><a href="#Composition-700"><span class="linenos"> 700</span></a><span class="sd">		source and this method has no effect.</span>
</span><span id="Composition-701"><a href="#Composition-701"><span class="linenos"> 701</span></a>
</span><span id="Composition-702"><a href="#Composition-702"><span class="linenos"> 702</span></a><span class="sd">		Parameters:</span>
</span><span id="Composition-703"><a href="#Composition-703"><span class="linenos"> 703</span></a><span class="sd">			bpm: New tempo in beats per minute</span>
</span><span id="Composition-704"><a href="#Composition-704"><span class="linenos"> 704</span></a>
</span><span id="Composition-705"><a href="#Composition-705"><span class="linenos"> 705</span></a><span class="sd">		Example:</span>
</span><span id="Composition-706"><a href="#Composition-706"><span class="linenos"> 706</span></a><span class="sd">			```python</span>
</span><span id="Composition-707"><a href="#Composition-707"><span class="linenos"> 707</span></a><span class="sd">			composition.set_bpm(140)</span>
</span><span id="Composition-708"><a href="#Composition-708"><span class="linenos"> 708</span></a><span class="sd">			```</span>
</span><span id="Composition-709"><a href="#Composition-709"><span class="linenos"> 709</span></a><span class="sd">		&quot;&quot;&quot;</span>
</span><span id="Composition-710"><a href="#Composition-710"><span class="linenos"> 710</span></a>
</span><span id="Composition-711"><a href="#Composition-711"><span class="linenos"> 711</span></a>		<span class="bp">self</span><span class="o">.</span><span class="n">_sequencer</span><span class="o">.</span><span class="n">set_bpm</span><span class="p">(</span><span class="n">bpm</span><span class="p">)</span>
</span><span id="Composition-712"><a href="#Composition-712"><span class="linenos"> 712</span></a>
</span><span id="Composition-713"><a href="#Composition-713"><span class="linenos"> 713</span></a>		<span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">_clock_follow</span><span class="p">:</span>
</span><span id="Composition-714"><a href="#Composition-714"><span class="linenos"> 714</span></a>			<span class="bp">self</span><span class="o">.</span><span class="n">bpm</span> <span class="o">=</span> <span class="n">bpm</span>
</span><span id="Composition-715"><a href="#Composition-715"><span class="linenos"> 715</span></a>
</span><span id="Composition-716"><a href="#Composition-716"><span class="linenos"> 716</span></a>	<span class="k">def</span><span class="w"> </span><span class="nf">live_info</span> <span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">typing</span><span class="o">.</span><span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">typing</span><span class="o">.</span><span class="n">Any</span><span class="p">]:</span>
</span><span id="Composition-717"><a href="#Composition-717"><span class="linenos"> 717</span></a>
</span><span id="Composition-718"><a href="#Composition-718"><span class="linenos"> 718</span></a><span class="w">		</span><span class="sd">&quot;&quot;&quot;Return a snapshot of the running composition state.</span>
</span><span id="Composition-719"><a href="#Composition-719"><span class="linenos"> 719</span></a>
</span><span id="Composition-720"><a href="#Composition-720"><span class="linenos"> 720</span></a><span class="sd">		Returns a dict with: ``bpm``, ``key``, ``bar``, ``section``, ``chord``,</span>
</span><span id="Composition-721"><a href="#Composition-721"><span class="linenos"> 721</span></a><span class="sd">		``patterns`` (list of dicts), and ``data``.</span>
</span><span id="Composition-722"><a href="#Composition-722"><span class="linenos"> 722</span></a>
</span><span id="Composition-723"><a href="#Composition-723"><span class="linenos"> 723</span></a><span class="sd">		Example:</span>
</span><span id="Composition-724"><a href="#Composition-724"><span class="linenos"> 724</span></a><span class="sd">			```python</span>
</span><span id="Composition-725"><a href="#Composition-725"><span class="linenos"> 725</span></a><span class="sd">			info = composition.live_info()</span>
</span><span id="Composition-726"><a href="#Composition-726"><span class="linenos"> 726</span></a><span class="sd">			print(info[&quot;bpm&quot;], info[&quot;chord&quot;])</span>
</span><span id="Composition-727"><a href="#Composition-727"><span class="linenos"> 727</span></a><span class="sd">			```</span>
</span><span id="Composition-728"><a href="#Composition-728"><span class="linenos"> 728</span></a><span class="sd">		&quot;&quot;&quot;</span>
</span><span id="Composition-729"><a href="#Composition-729"><span class="linenos"> 729</span></a>
</span><span id="Composition-730"><a href="#Composition-730"><span class="linenos"> 730</span></a>		<span class="n">section_info</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="Composition-731"><a href="#Composition-731"><span class="linenos"> 731</span></a>		<span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_form_state</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="Composition-732"><a href="#Composition-732"><span class="linenos"> 732</span></a>			<span class="n">section</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_form_state</span><span class="o">.</span><span class="n">get_section_info</span><span class="p">()</span>
</span><span id="Composition-733"><a href="#Composition-733"><span class="linenos"> 733</span></a>			<span class="k">if</span> <span class="n">section</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="Composition-734"><a href="#Composition-734"><span class="linenos"> 734</span></a>				<span class="n">section_info</span> <span class="o">=</span> <span class="p">{</span>
</span><span id="Composition-735"><a href="#Composition-735"><span class="linenos"> 735</span></a>					<span class="s2">&quot;name&quot;</span><span class="p">:</span> <span class="n">section</span><span class="o">.</span><span class="n">name</span><span class="p">,</span>
</span><span id="Composition-736"><a href="#Composition-736"><span class="linenos"> 736</span></a>					<span class="s2">&quot;bar&quot;</span><span class="p">:</span> <span class="n">section</span><span class="o">.</span><span class="n">bar</span><span class="p">,</span>
</span><span id="Composition-737"><a href="#Composition-737"><span class="linenos"> 737</span></a>					<span class="s2">&quot;bars&quot;</span><span class="p">:</span> <span class="n">section</span><span class="o">.</span><span class="n">bars</span><span class="p">,</span>
</span><span id="Composition-738"><a href="#Composition-738"><span class="linenos"> 738</span></a>					<span class="s2">&quot;progress&quot;</span><span class="p">:</span> <span class="n">section</span><span class="o">.</span><span class="n">progress</span>
</span><span id="Composition-739"><a href="#Composition-739"><span class="linenos"> 739</span></a>				<span class="p">}</span>
</span><span id="Composition-740"><a href="#Composition-740"><span class="linenos"> 740</span></a>
</span><span id="Composition-741"><a href="#Composition-741"><span class="linenos"> 741</span></a>		<span class="n">chord_name</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="Composition-742"><a href="#Composition-742"><span class="linenos"> 742</span></a>		<span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_harmonic_state</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="Composition-743"><a href="#Composition-743"><span class="linenos"> 743</span></a>			<span class="n">chord</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_harmonic_state</span><span class="o">.</span><span class="n">get_current_chord</span><span class="p">()</span>
</span><span id="Composition-744"><a href="#Composition-744"><span class="linenos"> 744</span></a>			<span class="k">if</span> <span class="n">chord</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="Composition-745"><a href="#Composition-745"><span class="linenos"> 745</span></a>				<span class="n">chord_name</span> <span class="o">=</span> <span class="n">chord</span><span class="o">.</span><span class="n">name</span><span class="p">()</span>
</span><span id="Composition-746"><a href="#Composition-746"><span class="linenos"> 746</span></a>
</span><span id="Composition-747"><a href="#Composition-747"><span class="linenos"> 747</span></a>		<span class="n">pattern_list</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="Composition-748"><a href="#Composition-748"><span class="linenos"> 748</span></a>		<span class="k">for</span> <span class="n">name</span><span class="p">,</span> <span class="n">pat</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_running_patterns</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
</span><span id="Composition-749"><a href="#Composition-749"><span class="linenos"> 749</span></a>			<span class="n">pattern_list</span><span class="o">.</span><span class="n">append</span><span class="p">({</span>
</span><span id="Composition-750"><a href="#Composition-750"><span class="linenos"> 750</span></a>				<span class="s2">&quot;name&quot;</span><span class="p">:</span> <span class="n">name</span><span class="p">,</span>
</span><span id="Composition-751"><a href="#Composition-751"><span class="linenos"> 751</span></a>				<span class="s2">&quot;channel&quot;</span><span class="p">:</span> <span class="n">pat</span><span class="o">.</span><span class="n">channel</span><span class="p">,</span>
</span><span id="Composition-752"><a href="#Composition-752"><span class="linenos"> 752</span></a>				<span class="s2">&quot;length&quot;</span><span class="p">:</span> <span class="n">pat</span><span class="o">.</span><span class="n">length</span><span class="p">,</span>
</span><span id="Composition-753"><a href="#Composition-753"><span class="linenos"> 753</span></a>				<span class="s2">&quot;cycle&quot;</span><span class="p">:</span> <span class="n">pat</span><span class="o">.</span><span class="n">_cycle_count</span><span class="p">,</span>
</span><span id="Composition-754"><a href="#Composition-754"><span class="linenos"> 754</span></a>				<span class="s2">&quot;muted&quot;</span><span class="p">:</span> <span class="n">pat</span><span class="o">.</span><span class="n">_muted</span>
</span><span id="Composition-755"><a href="#Composition-755"><span class="linenos"> 755</span></a>			<span class="p">})</span>
</span><span id="Composition-756"><a href="#Composition-756"><span class="linenos"> 756</span></a>
</span><span id="Composition-757"><a href="#Composition-757"><span class="linenos"> 757</span></a>		<span class="k">return</span> <span class="p">{</span>
</span><span id="Composition-758"><a href="#Composition-758"><span class="linenos"> 758</span></a>			<span class="s2">&quot;bpm&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">_sequencer</span><span class="o">.</span><span class="n">current_bpm</span> <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_clock_follow</span> <span class="k">else</span> <span class="bp">self</span><span class="o">.</span><span class="n">bpm</span><span class="p">,</span>
</span><span id="Composition-759"><a href="#Composition-759"><span class="linenos"> 759</span></a>			<span class="s2">&quot;key&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">key</span><span class="p">,</span>
</span><span id="Composition-760"><a href="#Composition-760"><span class="linenos"> 760</span></a>			<span class="s2">&quot;bar&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">_builder_bar</span><span class="p">,</span>
</span><span id="Composition-761"><a href="#Composition-761"><span class="linenos"> 761</span></a>			<span class="s2">&quot;section&quot;</span><span class="p">:</span> <span class="n">section_info</span><span class="p">,</span>
</span><span id="Composition-762"><a href="#Composition-762"><span class="linenos"> 762</span></a>			<span class="s2">&quot;chord&quot;</span><span class="p">:</span> <span class="n">chord_name</span><span class="p">,</span>
</span><span id="Composition-763"><a href="#Composition-763"><span class="linenos"> 763</span></a>			<span class="s2">&quot;patterns&quot;</span><span class="p">:</span> <span class="n">pattern_list</span><span class="p">,</span>
</span><span id="Composition-764"><a href="#Composition-764"><span class="linenos"> 764</span></a>			<span class="s2">&quot;input_device&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">_input_device</span><span class="p">,</span>
</span><span id="Composition-765"><a href="#Composition-765"><span class="linenos"> 765</span></a>			<span class="s2">&quot;clock_follow&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">_clock_follow</span><span class="p">,</span>
</span><span id="Composition-766"><a href="#Composition-766"><span class="linenos"> 766</span></a>			<span class="s2">&quot;data&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span>
</span><span id="Composition-767"><a href="#Composition-767"><span class="linenos"> 767</span></a>		<span class="p">}</span>
</span><span id="Composition-768"><a href="#Composition-768"><span class="linenos"> 768</span></a>
</span><span id="Composition-769"><a href="#Composition-769"><span class="linenos"> 769</span></a>	<span class="k">def</span><span class="w"> </span><span class="nf">mute</span> <span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="Composition-770"><a href="#Composition-770"><span class="linenos"> 770</span></a>
</span><span id="Composition-771"><a href="#Composition-771"><span class="linenos"> 771</span></a><span class="w">		</span><span class="sd">&quot;&quot;&quot;Mute a running pattern by name. The pattern keeps scheduling but produces no notes.</span>
</span><span id="Composition-772"><a href="#Composition-772"><span class="linenos"> 772</span></a>
</span><span id="Composition-773"><a href="#Composition-773"><span class="linenos"> 773</span></a><span class="sd">		Parameters:</span>
</span><span id="Composition-774"><a href="#Composition-774"><span class="linenos"> 774</span></a><span class="sd">			name: The function name of the pattern to mute</span>
</span><span id="Composition-775"><a href="#Composition-775"><span class="linenos"> 775</span></a>
</span><span id="Composition-776"><a href="#Composition-776"><span class="linenos"> 776</span></a><span class="sd">		Example:</span>
</span><span id="Composition-777"><a href="#Composition-777"><span class="linenos"> 777</span></a><span class="sd">			```python</span>
</span><span id="Composition-778"><a href="#Composition-778"><span class="linenos"> 778</span></a><span class="sd">			composition.mute(&quot;hats&quot;)</span>
</span><span id="Composition-779"><a href="#Composition-779"><span class="linenos"> 779</span></a><span class="sd">			```</span>
</span><span id="Composition-780"><a href="#Composition-780"><span class="linenos"> 780</span></a><span class="sd">		&quot;&quot;&quot;</span>
</span><span id="Composition-781"><a href="#Composition-781"><span class="linenos"> 781</span></a>
</span><span id="Composition-782"><a href="#Composition-782"><span class="linenos"> 782</span></a>		<span class="k">if</span> <span class="n">name</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_running_patterns</span><span class="p">:</span>
</span><span id="Composition-783"><a href="#Composition-783"><span class="linenos"> 783</span></a>			<span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Pattern &#39;</span><span class="si">{</span><span class="n">name</span><span class="si">}</span><span class="s2">&#39; not found. Available: </span><span class="si">{</span><span class="nb">list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_running_patterns</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="Composition-784"><a href="#Composition-784"><span class="linenos"> 784</span></a>
</span><span id="Composition-785"><a href="#Composition-785"><span class="linenos"> 785</span></a>		<span class="bp">self</span><span class="o">.</span><span class="n">_running_patterns</span><span class="p">[</span><span class="n">name</span><span class="p">]</span><span class="o">.</span><span class="n">_muted</span> <span class="o">=</span> <span class="kc">True</span>
</span><span id="Composition-786"><a href="#Composition-786"><span class="linenos"> 786</span></a>		<span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Muted pattern: </span><span class="si">{</span><span class="n">name</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="Composition-787"><a href="#Composition-787"><span class="linenos"> 787</span></a>
</span><span id="Composition-788"><a href="#Composition-788"><span class="linenos"> 788</span></a>	<span class="k">def</span><span class="w"> </span><span class="nf">unmute</span> <span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="Composition-789"><a href="#Composition-789"><span class="linenos"> 789</span></a>
</span><span id="Composition-790"><a href="#Composition-790"><span class="linenos"> 790</span></a><span class="w">		</span><span class="sd">&quot;&quot;&quot;Unmute a previously muted pattern.</span>
</span><span id="Composition-791"><a href="#Composition-791"><span class="linenos"> 791</span></a>
</span><span id="Composition-792"><a href="#Composition-792"><span class="linenos"> 792</span></a><span class="sd">		Parameters:</span>
</span><span id="Composition-793"><a href="#Composition-793"><span class="linenos"> 793</span></a><span class="sd">			name: The function name of the pattern to unmute</span>
</span><span id="Composition-794"><a href="#Composition-794"><span class="linenos"> 794</span></a>
</span><span id="Composition-795"><a href="#Composition-795"><span class="linenos"> 795</span></a><span class="sd">		Example:</span>
</span><span id="Composition-796"><a href="#Composition-796"><span class="linenos"> 796</span></a><span class="sd">			```python</span>
</span><span id="Composition-797"><a href="#Composition-797"><span class="linenos"> 797</span></a><span class="sd">			composition.unmute(&quot;hats&quot;)</span>
</span><span id="Composition-798"><a href="#Composition-798"><span class="linenos"> 798</span></a><span class="sd">			```</span>
</span><span id="Composition-799"><a href="#Composition-799"><span class="linenos"> 799</span></a><span class="sd">		&quot;&quot;&quot;</span>
</span><span id="Composition-800"><a href="#Composition-800"><span class="linenos"> 800</span></a>
</span><span id="Composition-801"><a href="#Composition-801"><span class="linenos"> 801</span></a>		<span class="k">if</span> <span class="n">name</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_running_patterns</span><span class="p">:</span>
</span><span id="Composition-802"><a href="#Composition-802"><span class="linenos"> 802</span></a>			<span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Pattern &#39;</span><span class="si">{</span><span class="n">name</span><span class="si">}</span><span class="s2">&#39; not found. Available: </span><span class="si">{</span><span class="nb">list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_running_patterns</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="Composition-803"><a href="#Composition-803"><span class="linenos"> 803</span></a>
</span><span id="Composition-804"><a href="#Composition-804"><span class="linenos"> 804</span></a>		<span class="bp">self</span><span class="o">.</span><span class="n">_running_patterns</span><span class="p">[</span><span class="n">name</span><span class="p">]</span><span class="o">.</span><span class="n">_muted</span> <span class="o">=</span> <span class="kc">False</span>
</span><span id="Composition-805"><a href="#Composition-805"><span class="linenos"> 805</span></a>		<span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Unmuted pattern: </span><span class="si">{</span><span class="n">name</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="Composition-806"><a href="#Composition-806"><span class="linenos"> 806</span></a>
</span><span id="Composition-807"><a href="#Composition-807"><span class="linenos"> 807</span></a>	<span class="k">def</span><span class="w"> </span><span class="nf">schedule</span> <span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">fn</span><span class="p">:</span> <span class="n">typing</span><span class="o">.</span><span class="n">Callable</span><span class="p">,</span> <span class="n">cycle_beats</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="n">reschedule_lookahead</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">1</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="Composition-808"><a href="#Composition-808"><span class="linenos"> 808</span></a>
</span><span id="Composition-809"><a href="#Composition-809"><span class="linenos"> 809</span></a><span class="w">		</span><span class="sd">&quot;&quot;&quot;Register a function to run on a repeating beat-based cycle.</span>
</span><span id="Composition-810"><a href="#Composition-810"><span class="linenos"> 810</span></a>
</span><span id="Composition-811"><a href="#Composition-811"><span class="linenos"> 811</span></a><span class="sd">		Sync functions automatically run in a thread pool so they never block the MIDI clock.</span>
</span><span id="Composition-812"><a href="#Composition-812"><span class="linenos"> 812</span></a><span class="sd">		Async functions run directly on the event loop.</span>
</span><span id="Composition-813"><a href="#Composition-813"><span class="linenos"> 813</span></a>
</span><span id="Composition-814"><a href="#Composition-814"><span class="linenos"> 814</span></a><span class="sd">		Parameters:</span>
</span><span id="Composition-815"><a href="#Composition-815"><span class="linenos"> 815</span></a><span class="sd">			fn: Function to call on each cycle (sync or async)</span>
</span><span id="Composition-816"><a href="#Composition-816"><span class="linenos"> 816</span></a><span class="sd">			cycle_beats: How often to call the function (in beats)</span>
</span><span id="Composition-817"><a href="#Composition-817"><span class="linenos"> 817</span></a><span class="sd">			reschedule_lookahead: Reschedule lookahead in beats (default 1)</span>
</span><span id="Composition-818"><a href="#Composition-818"><span class="linenos"> 818</span></a>
</span><span id="Composition-819"><a href="#Composition-819"><span class="linenos"> 819</span></a><span class="sd">		Example:</span>
</span><span id="Composition-820"><a href="#Composition-820"><span class="linenos"> 820</span></a><span class="sd">			```python</span>
</span><span id="Composition-821"><a href="#Composition-821"><span class="linenos"> 821</span></a><span class="sd">			# Sync function (runs in thread pool automatically)</span>
</span><span id="Composition-822"><a href="#Composition-822"><span class="linenos"> 822</span></a><span class="sd">			def fetch_data():</span>
</span><span id="Composition-823"><a href="#Composition-823"><span class="linenos"> 823</span></a><span class="sd">				composition.data[&quot;value&quot;] = some_external_api()</span>
</span><span id="Composition-824"><a href="#Composition-824"><span class="linenos"> 824</span></a>
</span><span id="Composition-825"><a href="#Composition-825"><span class="linenos"> 825</span></a><span class="sd">			composition.schedule(fetch_data, cycle_beats=32)  # Every 8 bars</span>
</span><span id="Composition-826"><a href="#Composition-826"><span class="linenos"> 826</span></a>
</span><span id="Composition-827"><a href="#Composition-827"><span class="linenos"> 827</span></a><span class="sd">			# Async function (runs directly)</span>
</span><span id="Composition-828"><a href="#Composition-828"><span class="linenos"> 828</span></a><span class="sd">			async def async_task():</span>
</span><span id="Composition-829"><a href="#Composition-829"><span class="linenos"> 829</span></a><span class="sd">				composition.data[&quot;value&quot;] = await some_async_api()</span>
</span><span id="Composition-830"><a href="#Composition-830"><span class="linenos"> 830</span></a>
</span><span id="Composition-831"><a href="#Composition-831"><span class="linenos"> 831</span></a><span class="sd">			composition.schedule(async_task, cycle_beats=16)</span>
</span><span id="Composition-832"><a href="#Composition-832"><span class="linenos"> 832</span></a><span class="sd">			```</span>
</span><span id="Composition-833"><a href="#Composition-833"><span class="linenos"> 833</span></a><span class="sd">		&quot;&quot;&quot;</span>
</span><span id="Composition-834"><a href="#Composition-834"><span class="linenos"> 834</span></a>
</span><span id="Composition-835"><a href="#Composition-835"><span class="linenos"> 835</span></a>		<span class="bp">self</span><span class="o">.</span><span class="n">_pending_scheduled</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">_PendingScheduled</span><span class="p">(</span><span class="n">fn</span><span class="p">,</span> <span class="n">cycle_beats</span><span class="p">,</span> <span class="n">reschedule_lookahead</span><span class="p">))</span>
</span><span id="Composition-836"><a href="#Composition-836"><span class="linenos"> 836</span></a>
</span><span id="Composition-837"><a href="#Composition-837"><span class="linenos"> 837</span></a>	<span class="k">def</span><span class="w"> </span><span class="nf">form</span> <span class="p">(</span>
</span><span id="Composition-838"><a href="#Composition-838"><span class="linenos"> 838</span></a>		<span class="bp">self</span><span class="p">,</span>
</span><span id="Composition-839"><a href="#Composition-839"><span class="linenos"> 839</span></a>		<span class="n">sections</span><span class="p">:</span> <span class="n">typing</span><span class="o">.</span><span class="n">Union</span><span class="p">[</span>
</span><span id="Composition-840"><a href="#Composition-840"><span class="linenos"> 840</span></a>			<span class="n">typing</span><span class="o">.</span><span class="n">List</span><span class="p">[</span><span class="n">typing</span><span class="o">.</span><span class="n">Tuple</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">int</span><span class="p">]],</span>
</span><span id="Composition-841"><a href="#Composition-841"><span class="linenos"> 841</span></a>			<span class="n">typing</span><span class="o">.</span><span class="n">Iterator</span><span class="p">[</span><span class="n">typing</span><span class="o">.</span><span class="n">Tuple</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">int</span><span class="p">]],</span>
</span><span id="Composition-842"><a href="#Composition-842"><span class="linenos"> 842</span></a>			<span class="n">typing</span><span class="o">.</span><span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">typing</span><span class="o">.</span><span class="n">Tuple</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="n">typing</span><span class="o">.</span><span class="n">Optional</span><span class="p">[</span><span class="n">typing</span><span class="o">.</span><span class="n">List</span><span class="p">[</span><span class="n">typing</span><span class="o">.</span><span class="n">Tuple</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">int</span><span class="p">]]]]]</span>
</span><span id="Composition-843"><a href="#Composition-843"><span class="linenos"> 843</span></a>		<span class="p">],</span>
</span><span id="Composition-844"><a href="#Composition-844"><span class="linenos"> 844</span></a>		<span class="n">loop</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
</span><span id="Composition-845"><a href="#Composition-845"><span class="linenos"> 845</span></a>		<span class="n">start</span><span class="p">:</span> <span class="n">typing</span><span class="o">.</span><span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="Composition-846"><a href="#Composition-846"><span class="linenos"> 846</span></a>	<span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="Composition-847"><a href="#Composition-847"><span class="linenos"> 847</span></a>
</span><span id="Composition-848"><a href="#Composition-848"><span class="linenos"> 848</span></a><span class="w">		</span><span class="sd">&quot;&quot;&quot;Define the compositional form as a sequence of sections or a weighted section graph.</span>
</span><span id="Composition-849"><a href="#Composition-849"><span class="linenos"> 849</span></a>
</span><span id="Composition-850"><a href="#Composition-850"><span class="linenos"> 850</span></a><span class="sd">		Three modes:</span>
</span><span id="Composition-851"><a href="#Composition-851"><span class="linenos"> 851</span></a><span class="sd">		- **Dict** (graph): Weighted section transitions. Format: `{section_name: (bars, [(next_section, weight), ...])}`</span>
</span><span id="Composition-852"><a href="#Composition-852"><span class="linenos"> 852</span></a><span class="sd">		- **List**: Linear sequence. With `loop=True`, cycles back to the start.</span>
</span><span id="Composition-853"><a href="#Composition-853"><span class="linenos"> 853</span></a><span class="sd">		- **Generator**: Yields `(name, bars)` tuples for stochastic structures.</span>
</span><span id="Composition-854"><a href="#Composition-854"><span class="linenos"> 854</span></a>
</span><span id="Composition-855"><a href="#Composition-855"><span class="linenos"> 855</span></a><span class="sd">		Parameters:</span>
</span><span id="Composition-856"><a href="#Composition-856"><span class="linenos"> 856</span></a><span class="sd">			sections: Dict (graph), list, or generator of `(name, bars)` tuples</span>
</span><span id="Composition-857"><a href="#Composition-857"><span class="linenos"> 857</span></a><span class="sd">			loop: For lists only - cycle back to start after the last section (default False)</span>
</span><span id="Composition-858"><a href="#Composition-858"><span class="linenos"> 858</span></a><span class="sd">			start: For dicts only - initial section name (default: first dict key)</span>
</span><span id="Composition-859"><a href="#Composition-859"><span class="linenos"> 859</span></a>
</span><span id="Composition-860"><a href="#Composition-860"><span class="linenos"> 860</span></a><span class="sd">		Example:</span>
</span><span id="Composition-861"><a href="#Composition-861"><span class="linenos"> 861</span></a><span class="sd">			```python</span>
</span><span id="Composition-862"><a href="#Composition-862"><span class="linenos"> 862</span></a><span class="sd">			# Graph-based form - intro plays once, then never returns</span>
</span><span id="Composition-863"><a href="#Composition-863"><span class="linenos"> 863</span></a><span class="sd">			composition.form({</span>
</span><span id="Composition-864"><a href="#Composition-864"><span class="linenos"> 864</span></a><span class="sd">				&quot;intro&quot;:     (4, [(&quot;verse&quot;, 1)]),</span>
</span><span id="Composition-865"><a href="#Composition-865"><span class="linenos"> 865</span></a><span class="sd">				&quot;verse&quot;:     (8, [(&quot;chorus&quot;, 3), (&quot;bridge&quot;, 1)]),</span>
</span><span id="Composition-866"><a href="#Composition-866"><span class="linenos"> 866</span></a><span class="sd">				&quot;chorus&quot;:    (8, [(&quot;breakdown&quot;, 2), (&quot;verse&quot;, 1)]),</span>
</span><span id="Composition-867"><a href="#Composition-867"><span class="linenos"> 867</span></a><span class="sd">				&quot;bridge&quot;:    (4, [(&quot;chorus&quot;, 1)]),</span>
</span><span id="Composition-868"><a href="#Composition-868"><span class="linenos"> 868</span></a><span class="sd">				&quot;breakdown&quot;: (4, [(&quot;verse&quot;, 1)]),</span>
</span><span id="Composition-869"><a href="#Composition-869"><span class="linenos"> 869</span></a><span class="sd">			}, start=&quot;intro&quot;)</span>
</span><span id="Composition-870"><a href="#Composition-870"><span class="linenos"> 870</span></a>
</span><span id="Composition-871"><a href="#Composition-871"><span class="linenos"> 871</span></a><span class="sd">			# List-based form with loop</span>
</span><span id="Composition-872"><a href="#Composition-872"><span class="linenos"> 872</span></a><span class="sd">			composition.form([(&quot;intro&quot;, 4), (&quot;verse&quot;, 8), (&quot;chorus&quot;, 8)], loop=True)</span>
</span><span id="Composition-873"><a href="#Composition-873"><span class="linenos"> 873</span></a>
</span><span id="Composition-874"><a href="#Composition-874"><span class="linenos"> 874</span></a><span class="sd">			# Generator form</span>
</span><span id="Composition-875"><a href="#Composition-875"><span class="linenos"> 875</span></a><span class="sd">			def my_form():</span>
</span><span id="Composition-876"><a href="#Composition-876"><span class="linenos"> 876</span></a><span class="sd">				yield (&quot;intro&quot;, 4)</span>
</span><span id="Composition-877"><a href="#Composition-877"><span class="linenos"> 877</span></a><span class="sd">				while True:</span>
</span><span id="Composition-878"><a href="#Composition-878"><span class="linenos"> 878</span></a><span class="sd">					yield (&quot;verse&quot;, random.choice([8, 16]))</span>
</span><span id="Composition-879"><a href="#Composition-879"><span class="linenos"> 879</span></a><span class="sd">					yield (&quot;chorus&quot;, 8)</span>
</span><span id="Composition-880"><a href="#Composition-880"><span class="linenos"> 880</span></a>
</span><span id="Composition-881"><a href="#Composition-881"><span class="linenos"> 881</span></a><span class="sd">			composition.form(my_form())</span>
</span><span id="Composition-882"><a href="#Composition-882"><span class="linenos"> 882</span></a><span class="sd">			```</span>
</span><span id="Composition-883"><a href="#Composition-883"><span class="linenos"> 883</span></a><span class="sd">		&quot;&quot;&quot;</span>
</span><span id="Composition-884"><a href="#Composition-884"><span class="linenos"> 884</span></a>
</span><span id="Composition-885"><a href="#Composition-885"><span class="linenos"> 885</span></a>		<span class="bp">self</span><span class="o">.</span><span class="n">_form_state</span> <span class="o">=</span> <span class="n">FormState</span><span class="p">(</span><span class="n">sections</span><span class="p">,</span> <span class="n">loop</span><span class="o">=</span><span class="n">loop</span><span class="p">,</span> <span class="n">start</span><span class="o">=</span><span class="n">start</span><span class="p">)</span>
</span><span id="Composition-886"><a href="#Composition-886"><span class="linenos"> 886</span></a>
</span><span id="Composition-887"><a href="#Composition-887"><span class="linenos"> 887</span></a>	<span class="k">def</span><span class="w"> </span><span class="nf">pattern</span> <span class="p">(</span>
</span><span id="Composition-888"><a href="#Composition-888"><span class="linenos"> 888</span></a>		<span class="bp">self</span><span class="p">,</span>
</span><span id="Composition-889"><a href="#Composition-889"><span class="linenos"> 889</span></a>		<span class="n">channel</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
</span><span id="Composition-890"><a href="#Composition-890"><span class="linenos"> 890</span></a>		<span class="n">length</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mi">4</span><span class="p">,</span>
</span><span id="Composition-891"><a href="#Composition-891"><span class="linenos"> 891</span></a>		<span class="n">drum_note_map</span><span class="p">:</span> <span class="n">typing</span><span class="o">.</span><span class="n">Optional</span><span class="p">[</span><span class="n">typing</span><span class="o">.</span><span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">int</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="Composition-892"><a href="#Composition-892"><span class="linenos"> 892</span></a>		<span class="n">reschedule_lookahead</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span>
</span><span id="Composition-893"><a href="#Composition-893"><span class="linenos"> 893</span></a>		<span class="n">voice_leading</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span>
</span><span id="Composition-894"><a href="#Composition-894"><span class="linenos"> 894</span></a>	<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">typing</span><span class="o">.</span><span class="n">Callable</span><span class="p">:</span>
</span><span id="Composition-895"><a href="#Composition-895"><span class="linenos"> 895</span></a>
</span><span id="Composition-896"><a href="#Composition-896"><span class="linenos"> 896</span></a><span class="w">		</span><span class="sd">&quot;&quot;&quot;Decorator that registers a builder function as a repeating pattern.</span>
</span><span id="Composition-897"><a href="#Composition-897"><span class="linenos"> 897</span></a>
</span><span id="Composition-898"><a href="#Composition-898"><span class="linenos"> 898</span></a><span class="sd">		The builder function receives a `PatternBuilder` (`p`) and optionally a `chord` parameter</span>
</span><span id="Composition-899"><a href="#Composition-899"><span class="linenos"> 899</span></a><span class="sd">		(automatically injected if present and harmony is configured).</span>
</span><span id="Composition-900"><a href="#Composition-900"><span class="linenos"> 900</span></a>
</span><span id="Composition-901"><a href="#Composition-901"><span class="linenos"> 901</span></a><span class="sd">		Parameters:</span>
</span><span id="Composition-902"><a href="#Composition-902"><span class="linenos"> 902</span></a><span class="sd">			channel: MIDI channel (0-15)</span>
</span><span id="Composition-903"><a href="#Composition-903"><span class="linenos"> 903</span></a><span class="sd">			length: Pattern length in beats (default 4)</span>
</span><span id="Composition-904"><a href="#Composition-904"><span class="linenos"> 904</span></a><span class="sd">			drum_note_map: Optional dict mapping string names to MIDI note numbers (e.g., `{&quot;kick&quot;: 36}`)</span>
</span><span id="Composition-905"><a href="#Composition-905"><span class="linenos"> 905</span></a><span class="sd">			reschedule_lookahead: Reschedule lookahead in beats (default 1)</span>
</span><span id="Composition-906"><a href="#Composition-906"><span class="linenos"> 906</span></a><span class="sd">			voice_leading: When True, the injected chord automatically picks the</span>
</span><span id="Composition-907"><a href="#Composition-907"><span class="linenos"> 907</span></a><span class="sd">				inversion closest to the previous chord so that voices move smoothly.</span>
</span><span id="Composition-908"><a href="#Composition-908"><span class="linenos"> 908</span></a><span class="sd">				Each pattern tracks its own voice leading state independently.</span>
</span><span id="Composition-909"><a href="#Composition-909"><span class="linenos"> 909</span></a>
</span><span id="Composition-910"><a href="#Composition-910"><span class="linenos"> 910</span></a><span class="sd">		Example:</span>
</span><span id="Composition-911"><a href="#Composition-911"><span class="linenos"> 911</span></a><span class="sd">			```python</span>
</span><span id="Composition-912"><a href="#Composition-912"><span class="linenos"> 912</span></a><span class="sd">			@composition.pattern(channel=9, length=4, drum_note_map={&quot;kick&quot;: 36, &quot;snare&quot;: 38})</span>
</span><span id="Composition-913"><a href="#Composition-913"><span class="linenos"> 913</span></a><span class="sd">			def drums(p):</span>
</span><span id="Composition-914"><a href="#Composition-914"><span class="linenos"> 914</span></a><span class="sd">				p.hit_steps(&quot;kick&quot;, [0, 4, 8, 12], velocity=127)</span>
</span><span id="Composition-915"><a href="#Composition-915"><span class="linenos"> 915</span></a><span class="sd">				p.hit_steps(&quot;snare&quot;, [4, 12], velocity=100)</span>
</span><span id="Composition-916"><a href="#Composition-916"><span class="linenos"> 916</span></a>
</span><span id="Composition-917"><a href="#Composition-917"><span class="linenos"> 917</span></a><span class="sd">			@composition.pattern(channel=0, length=4, voice_leading=True)</span>
</span><span id="Composition-918"><a href="#Composition-918"><span class="linenos"> 918</span></a><span class="sd">			def chords(p, chord):</span>
</span><span id="Composition-919"><a href="#Composition-919"><span class="linenos"> 919</span></a><span class="sd">				# chord is automatically injected with voice leading</span>
</span><span id="Composition-920"><a href="#Composition-920"><span class="linenos"> 920</span></a><span class="sd">				p.chord(chord, root=52, velocity=90, sustain=True)</span>
</span><span id="Composition-921"><a href="#Composition-921"><span class="linenos"> 921</span></a><span class="sd">			```</span>
</span><span id="Composition-922"><a href="#Composition-922"><span class="linenos"> 922</span></a><span class="sd">		&quot;&quot;&quot;</span>
</span><span id="Composition-923"><a href="#Composition-923"><span class="linenos"> 923</span></a>
</span><span id="Composition-924"><a href="#Composition-924"><span class="linenos"> 924</span></a>		<span class="k">def</span><span class="w"> </span><span class="nf">decorator</span> <span class="p">(</span><span class="n">fn</span><span class="p">:</span> <span class="n">typing</span><span class="o">.</span><span class="n">Callable</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">typing</span><span class="o">.</span><span class="n">Callable</span><span class="p">:</span>
</span><span id="Composition-925"><a href="#Composition-925"><span class="linenos"> 925</span></a>
</span><span id="Composition-926"><a href="#Composition-926"><span class="linenos"> 926</span></a><span class="w">			</span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="Composition-927"><a href="#Composition-927"><span class="linenos"> 927</span></a><span class="sd">			Wrap the builder function and register it as a pending pattern.</span>
</span><span id="Composition-928"><a href="#Composition-928"><span class="linenos"> 928</span></a><span class="sd">			During live sessions, hot-swap an existing pattern&#39;s builder instead.</span>
</span><span id="Composition-929"><a href="#Composition-929"><span class="linenos"> 929</span></a><span class="sd">			&quot;&quot;&quot;</span>
</span><span id="Composition-930"><a href="#Composition-930"><span class="linenos"> 930</span></a>
</span><span id="Composition-931"><a href="#Composition-931"><span class="linenos"> 931</span></a>			<span class="c1"># Hot-swap: if we&#39;re live and a pattern with this name exists, replace its builder.</span>
</span><span id="Composition-932"><a href="#Composition-932"><span class="linenos"> 932</span></a>			<span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_is_live</span> <span class="ow">and</span> <span class="n">fn</span><span class="o">.</span><span class="vm">__name__</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_running_patterns</span><span class="p">:</span>
</span><span id="Composition-933"><a href="#Composition-933"><span class="linenos"> 933</span></a>				<span class="n">running</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_running_patterns</span><span class="p">[</span><span class="n">fn</span><span class="o">.</span><span class="vm">__name__</span><span class="p">]</span>
</span><span id="Composition-934"><a href="#Composition-934"><span class="linenos"> 934</span></a>				<span class="n">running</span><span class="o">.</span><span class="n">_builder_fn</span> <span class="o">=</span> <span class="n">fn</span>
</span><span id="Composition-935"><a href="#Composition-935"><span class="linenos"> 935</span></a>				<span class="n">running</span><span class="o">.</span><span class="n">_wants_chord</span> <span class="o">=</span> <span class="n">_fn_has_parameter</span><span class="p">(</span><span class="n">fn</span><span class="p">,</span> <span class="s2">&quot;chord&quot;</span><span class="p">)</span>
</span><span id="Composition-936"><a href="#Composition-936"><span class="linenos"> 936</span></a>				<span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Hot-swapped pattern: </span><span class="si">{</span><span class="n">fn</span><span class="o">.</span><span class="vm">__name__</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="Composition-937"><a href="#Composition-937"><span class="linenos"> 937</span></a>				<span class="k">return</span> <span class="n">fn</span>
</span><span id="Composition-938"><a href="#Composition-938"><span class="linenos"> 938</span></a>
</span><span id="Composition-939"><a href="#Composition-939"><span class="linenos"> 939</span></a>			<span class="n">pending</span> <span class="o">=</span> <span class="n">_PendingPattern</span><span class="p">(</span>
</span><span id="Composition-940"><a href="#Composition-940"><span class="linenos"> 940</span></a>				<span class="n">builder_fn</span> <span class="o">=</span> <span class="n">fn</span><span class="p">,</span>
</span><span id="Composition-941"><a href="#Composition-941"><span class="linenos"> 941</span></a>				<span class="n">channel</span> <span class="o">=</span> <span class="n">channel</span><span class="p">,</span>
</span><span id="Composition-942"><a href="#Composition-942"><span class="linenos"> 942</span></a>				<span class="n">length</span> <span class="o">=</span> <span class="n">length</span><span class="p">,</span>
</span><span id="Composition-943"><a href="#Composition-943"><span class="linenos"> 943</span></a>				<span class="n">drum_note_map</span> <span class="o">=</span> <span class="n">drum_note_map</span><span class="p">,</span>
</span><span id="Composition-944"><a href="#Composition-944"><span class="linenos"> 944</span></a>				<span class="n">reschedule_lookahead</span> <span class="o">=</span> <span class="n">reschedule_lookahead</span><span class="p">,</span>
</span><span id="Composition-945"><a href="#Composition-945"><span class="linenos"> 945</span></a>				<span class="n">voice_leading</span> <span class="o">=</span> <span class="n">voice_leading</span>
</span><span id="Composition-946"><a href="#Composition-946"><span class="linenos"> 946</span></a>			<span class="p">)</span>
</span><span id="Composition-947"><a href="#Composition-947"><span class="linenos"> 947</span></a>
</span><span id="Composition-948"><a href="#Composition-948"><span class="linenos"> 948</span></a>			<span class="bp">self</span><span class="o">.</span><span class="n">_pending_patterns</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">pending</span><span class="p">)</span>
</span><span id="Composition-949"><a href="#Composition-949"><span class="linenos"> 949</span></a>
</span><span id="Composition-950"><a href="#Composition-950"><span class="linenos"> 950</span></a>			<span class="k">return</span> <span class="n">fn</span>
</span><span id="Composition-951"><a href="#Composition-951"><span class="linenos"> 951</span></a>
</span><span id="Composition-952"><a href="#Composition-952"><span class="linenos"> 952</span></a>		<span class="k">return</span> <span class="n">decorator</span>
</span><span id="Composition-953"><a href="#Composition-953"><span class="linenos"> 953</span></a>
</span><span id="Composition-954"><a href="#Composition-954"><span class="linenos"> 954</span></a>	<span class="k">def</span><span class="w"> </span><span class="nf">layer</span> <span class="p">(</span>
</span><span id="Composition-955"><a href="#Composition-955"><span class="linenos"> 955</span></a>		<span class="bp">self</span><span class="p">,</span>
</span><span id="Composition-956"><a href="#Composition-956"><span class="linenos"> 956</span></a>		<span class="o">*</span><span class="n">builder_fns</span><span class="p">:</span> <span class="n">typing</span><span class="o">.</span><span class="n">Callable</span><span class="p">,</span>
</span><span id="Composition-957"><a href="#Composition-957"><span class="linenos"> 957</span></a>		<span class="n">channel</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
</span><span id="Composition-958"><a href="#Composition-958"><span class="linenos"> 958</span></a>		<span class="n">length</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mi">4</span><span class="p">,</span>
</span><span id="Composition-959"><a href="#Composition-959"><span class="linenos"> 959</span></a>		<span class="n">drum_note_map</span><span class="p">:</span> <span class="n">typing</span><span class="o">.</span><span class="n">Optional</span><span class="p">[</span><span class="n">typing</span><span class="o">.</span><span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">int</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="Composition-960"><a href="#Composition-960"><span class="linenos"> 960</span></a>		<span class="n">reschedule_lookahead</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span>
</span><span id="Composition-961"><a href="#Composition-961"><span class="linenos"> 961</span></a>		<span class="n">voice_leading</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span>
</span><span id="Composition-962"><a href="#Composition-962"><span class="linenos"> 962</span></a>	<span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="Composition-963"><a href="#Composition-963"><span class="linenos"> 963</span></a>
</span><span id="Composition-964"><a href="#Composition-964"><span class="linenos"> 964</span></a><span class="w">		</span><span class="sd">&quot;&quot;&quot;Register multiple builder functions as a single layered pattern.</span>
</span><span id="Composition-965"><a href="#Composition-965"><span class="linenos"> 965</span></a>
</span><span id="Composition-966"><a href="#Composition-966"><span class="linenos"> 966</span></a><span class="sd">		Each builder function runs sequentially on the same PatternBuilder, so their notes</span>
</span><span id="Composition-967"><a href="#Composition-967"><span class="linenos"> 967</span></a><span class="sd">		merge into one pattern. This is useful for composing reusable rhythm or melody</span>
</span><span id="Composition-968"><a href="#Composition-968"><span class="linenos"> 968</span></a><span class="sd">		fragments without creating separate MIDI patterns.</span>
</span><span id="Composition-969"><a href="#Composition-969"><span class="linenos"> 969</span></a>
</span><span id="Composition-970"><a href="#Composition-970"><span class="linenos"> 970</span></a><span class="sd">		Transforms like ``dropout()`` or ``swing()`` called in any builder affect the</span>
</span><span id="Composition-971"><a href="#Composition-971"><span class="linenos"> 971</span></a><span class="sd">		combined result. If you need transforms to apply to only one layer, use separate</span>
</span><span id="Composition-972"><a href="#Composition-972"><span class="linenos"> 972</span></a><span class="sd">		patterns instead.</span>
</span><span id="Composition-973"><a href="#Composition-973"><span class="linenos"> 973</span></a>
</span><span id="Composition-974"><a href="#Composition-974"><span class="linenos"> 974</span></a><span class="sd">		Parameters:</span>
</span><span id="Composition-975"><a href="#Composition-975"><span class="linenos"> 975</span></a><span class="sd">			*builder_fns: Two or more builder functions (each takes a PatternBuilder, and optionally a chord)</span>
</span><span id="Composition-976"><a href="#Composition-976"><span class="linenos"> 976</span></a><span class="sd">			channel: MIDI channel (0-15)</span>
</span><span id="Composition-977"><a href="#Composition-977"><span class="linenos"> 977</span></a><span class="sd">			length: Pattern length in beats (default 4)</span>
</span><span id="Composition-978"><a href="#Composition-978"><span class="linenos"> 978</span></a><span class="sd">			drum_note_map: Optional dict mapping string names to MIDI note numbers</span>
</span><span id="Composition-979"><a href="#Composition-979"><span class="linenos"> 979</span></a><span class="sd">			reschedule_lookahead: Reschedule lookahead in beats (default 1)</span>
</span><span id="Composition-980"><a href="#Composition-980"><span class="linenos"> 980</span></a>
</span><span id="Composition-981"><a href="#Composition-981"><span class="linenos"> 981</span></a><span class="sd">		Example:</span>
</span><span id="Composition-982"><a href="#Composition-982"><span class="linenos"> 982</span></a><span class="sd">			```python</span>
</span><span id="Composition-983"><a href="#Composition-983"><span class="linenos"> 983</span></a><span class="sd">			def kick (p):</span>
</span><span id="Composition-984"><a href="#Composition-984"><span class="linenos"> 984</span></a><span class="sd">				p.hit_steps(&quot;kick&quot;, [0, 4, 8, 12], velocity=127)</span>
</span><span id="Composition-985"><a href="#Composition-985"><span class="linenos"> 985</span></a>
</span><span id="Composition-986"><a href="#Composition-986"><span class="linenos"> 986</span></a><span class="sd">			def hats (p):</span>
</span><span id="Composition-987"><a href="#Composition-987"><span class="linenos"> 987</span></a><span class="sd">				p.hit_steps(&quot;hh_closed&quot;, list(range(16)), velocity=80)</span>
</span><span id="Composition-988"><a href="#Composition-988"><span class="linenos"> 988</span></a><span class="sd">				p.velocity_shape(low=60, high=100)</span>
</span><span id="Composition-989"><a href="#Composition-989"><span class="linenos"> 989</span></a>
</span><span id="Composition-990"><a href="#Composition-990"><span class="linenos"> 990</span></a><span class="sd">			composition.layer(kick, hats, channel=9, length=4, drum_note_map=DRUM_NOTE_MAP)</span>
</span><span id="Composition-991"><a href="#Composition-991"><span class="linenos"> 991</span></a><span class="sd">			```</span>
</span><span id="Composition-992"><a href="#Composition-992"><span class="linenos"> 992</span></a><span class="sd">		&quot;&quot;&quot;</span>
</span><span id="Composition-993"><a href="#Composition-993"><span class="linenos"> 993</span></a>
</span><span id="Composition-994"><a href="#Composition-994"><span class="linenos"> 994</span></a>		<span class="n">wants_chord</span> <span class="o">=</span> <span class="nb">any</span><span class="p">(</span><span class="n">_fn_has_parameter</span><span class="p">(</span><span class="n">fn</span><span class="p">,</span> <span class="s2">&quot;chord&quot;</span><span class="p">)</span> <span class="k">for</span> <span class="n">fn</span> <span class="ow">in</span> <span class="n">builder_fns</span><span class="p">)</span>
</span><span id="Composition-995"><a href="#Composition-995"><span class="linenos"> 995</span></a>
</span><span id="Composition-996"><a href="#Composition-996"><span class="linenos"> 996</span></a>		<span class="k">if</span> <span class="n">wants_chord</span><span class="p">:</span>
</span><span id="Composition-997"><a href="#Composition-997"><span class="linenos"> 997</span></a>
</span><span id="Composition-998"><a href="#Composition-998"><span class="linenos"> 998</span></a>			<span class="k">def</span><span class="w"> </span><span class="nf">merged_builder</span> <span class="p">(</span><span class="n">p</span><span class="p">:</span> <span class="n">subsequence</span><span class="o">.</span><span class="n">pattern_builder</span><span class="o">.</span><span class="n">PatternBuilder</span><span class="p">,</span> <span class="n">chord</span><span class="p">:</span> <span class="n">_InjectedChord</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="Composition-999"><a href="#Composition-999"><span class="linenos"> 999</span></a>
</span><span id="Composition-1000"><a href="#Composition-1000"><span class="linenos">1000</span></a>				<span class="k">for</span> <span class="n">fn</span> <span class="ow">in</span> <span class="n">builder_fns</span><span class="p">:</span>
</span><span id="Composition-1001"><a href="#Composition-1001"><span class="linenos">1001</span></a>					<span class="k">if</span> <span class="n">_fn_has_parameter</span><span class="p">(</span><span class="n">fn</span><span class="p">,</span> <span class="s2">&quot;chord&quot;</span><span class="p">):</span>
</span><span id="Composition-1002"><a href="#Composition-1002"><span class="linenos">1002</span></a>						<span class="n">fn</span><span class="p">(</span><span class="n">p</span><span class="p">,</span> <span class="n">chord</span><span class="p">)</span>
</span><span id="Composition-1003"><a href="#Composition-1003"><span class="linenos">1003</span></a>					<span class="k">else</span><span class="p">:</span>
</span><span id="Composition-1004"><a href="#Composition-1004"><span class="linenos">1004</span></a>						<span class="n">fn</span><span class="p">(</span><span class="n">p</span><span class="p">)</span>
</span><span id="Composition-1005"><a href="#Composition-1005"><span class="linenos">1005</span></a>
</span><span id="Composition-1006"><a href="#Composition-1006"><span class="linenos">1006</span></a>		<span class="k">else</span><span class="p">:</span>
</span><span id="Composition-1007"><a href="#Composition-1007"><span class="linenos">1007</span></a>
</span><span id="Composition-1008"><a href="#Composition-1008"><span class="linenos">1008</span></a>			<span class="k">def</span><span class="w"> </span><span class="nf">merged_builder</span> <span class="p">(</span><span class="n">p</span><span class="p">:</span> <span class="n">subsequence</span><span class="o">.</span><span class="n">pattern_builder</span><span class="o">.</span><span class="n">PatternBuilder</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>  <span class="c1"># type: ignore[misc]</span>
</span><span id="Composition-1009"><a href="#Composition-1009"><span class="linenos">1009</span></a>
</span><span id="Composition-1010"><a href="#Composition-1010"><span class="linenos">1010</span></a>				<span class="k">for</span> <span class="n">fn</span> <span class="ow">in</span> <span class="n">builder_fns</span><span class="p">:</span>
</span><span id="Composition-1011"><a href="#Composition-1011"><span class="linenos">1011</span></a>					<span class="n">fn</span><span class="p">(</span><span class="n">p</span><span class="p">)</span>
</span><span id="Composition-1012"><a href="#Composition-1012"><span class="linenos">1012</span></a>
</span><span id="Composition-1013"><a href="#Composition-1013"><span class="linenos">1013</span></a>		<span class="n">pending</span> <span class="o">=</span> <span class="n">_PendingPattern</span><span class="p">(</span>
</span><span id="Composition-1014"><a href="#Composition-1014"><span class="linenos">1014</span></a>			<span class="n">builder_fn</span> <span class="o">=</span> <span class="n">merged_builder</span><span class="p">,</span>
</span><span id="Composition-1015"><a href="#Composition-1015"><span class="linenos">1015</span></a>			<span class="n">channel</span> <span class="o">=</span> <span class="n">channel</span><span class="p">,</span>
</span><span id="Composition-1016"><a href="#Composition-1016"><span class="linenos">1016</span></a>			<span class="n">length</span> <span class="o">=</span> <span class="n">length</span><span class="p">,</span>
</span><span id="Composition-1017"><a href="#Composition-1017"><span class="linenos">1017</span></a>			<span class="n">drum_note_map</span> <span class="o">=</span> <span class="n">drum_note_map</span><span class="p">,</span>
</span><span id="Composition-1018"><a href="#Composition-1018"><span class="linenos">1018</span></a>			<span class="n">reschedule_lookahead</span> <span class="o">=</span> <span class="n">reschedule_lookahead</span><span class="p">,</span>
</span><span id="Composition-1019"><a href="#Composition-1019"><span class="linenos">1019</span></a>			<span class="n">voice_leading</span> <span class="o">=</span> <span class="n">voice_leading</span>
</span><span id="Composition-1020"><a href="#Composition-1020"><span class="linenos">1020</span></a>		<span class="p">)</span>
</span><span id="Composition-1021"><a href="#Composition-1021"><span class="linenos">1021</span></a>
</span><span id="Composition-1022"><a href="#Composition-1022"><span class="linenos">1022</span></a>		<span class="bp">self</span><span class="o">.</span><span class="n">_pending_patterns</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">pending</span><span class="p">)</span>
</span><span id="Composition-1023"><a href="#Composition-1023"><span class="linenos">1023</span></a>
</span><span id="Composition-1024"><a href="#Composition-1024"><span class="linenos">1024</span></a>	<span class="k">def</span><span class="w"> </span><span class="nf">play</span> <span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="Composition-1025"><a href="#Composition-1025"><span class="linenos">1025</span></a>
</span><span id="Composition-1026"><a href="#Composition-1026"><span class="linenos">1026</span></a><span class="w">		</span><span class="sd">&quot;&quot;&quot;Start playback, blocking until stopped via Ctrl+C or signal.</span>
</span><span id="Composition-1027"><a href="#Composition-1027"><span class="linenos">1027</span></a>
</span><span id="Composition-1028"><a href="#Composition-1028"><span class="linenos">1028</span></a><span class="sd">		Schedules all registered patterns, harmonic state (if configured), form state (if configured),</span>
</span><span id="Composition-1029"><a href="#Composition-1029"><span class="linenos">1029</span></a><span class="sd">		and scheduled tasks. Runs the sequencer loop until interrupted.</span>
</span><span id="Composition-1030"><a href="#Composition-1030"><span class="linenos">1030</span></a>
</span><span id="Composition-1031"><a href="#Composition-1031"><span class="linenos">1031</span></a><span class="sd">		Example:</span>
</span><span id="Composition-1032"><a href="#Composition-1032"><span class="linenos">1032</span></a><span class="sd">			```python</span>
</span><span id="Composition-1033"><a href="#Composition-1033"><span class="linenos">1033</span></a><span class="sd">			if __name__ == &quot;__main__&quot;:</span>
</span><span id="Composition-1034"><a href="#Composition-1034"><span class="linenos">1034</span></a><span class="sd">				composition.play()  # Press Ctrl+C to stop</span>
</span><span id="Composition-1035"><a href="#Composition-1035"><span class="linenos">1035</span></a><span class="sd">			```</span>
</span><span id="Composition-1036"><a href="#Composition-1036"><span class="linenos">1036</span></a><span class="sd">		&quot;&quot;&quot;</span>
</span><span id="Composition-1037"><a href="#Composition-1037"><span class="linenos">1037</span></a>
</span><span id="Composition-1038"><a href="#Composition-1038"><span class="linenos">1038</span></a>		<span class="k">try</span><span class="p">:</span>
</span><span id="Composition-1039"><a href="#Composition-1039"><span class="linenos">1039</span></a>			<span class="n">asyncio</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_run</span><span class="p">())</span>
</span><span id="Composition-1040"><a href="#Composition-1040"><span class="linenos">1040</span></a>
</span><span id="Composition-1041"><a href="#Composition-1041"><span class="linenos">1041</span></a>		<span class="k">except</span> <span class="ne">KeyboardInterrupt</span><span class="p">:</span>
</span><span id="Composition-1042"><a href="#Composition-1042"><span class="linenos">1042</span></a>			<span class="k">pass</span>
</span><span id="Composition-1043"><a href="#Composition-1043"><span class="linenos">1043</span></a>
</span><span id="Composition-1044"><a href="#Composition-1044"><span class="linenos">1044</span></a>	<span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">_run</span> <span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="Composition-1045"><a href="#Composition-1045"><span class="linenos">1045</span></a>
</span><span id="Composition-1046"><a href="#Composition-1046"><span class="linenos">1046</span></a><span class="w">		</span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="Composition-1047"><a href="#Composition-1047"><span class="linenos">1047</span></a><span class="sd">		Async entry point that schedules all patterns and runs the sequencer.</span>
</span><span id="Composition-1048"><a href="#Composition-1048"><span class="linenos">1048</span></a><span class="sd">		&quot;&quot;&quot;</span>
</span><span id="Composition-1049"><a href="#Composition-1049"><span class="linenos">1049</span></a>
</span><span id="Composition-1050"><a href="#Composition-1050"><span class="linenos">1050</span></a>		<span class="c1"># Pass MIDI input configuration to the sequencer before start.</span>
</span><span id="Composition-1051"><a href="#Composition-1051"><span class="linenos">1051</span></a>		<span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_input_device</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="Composition-1052"><a href="#Composition-1052"><span class="linenos">1052</span></a>			<span class="bp">self</span><span class="o">.</span><span class="n">_sequencer</span><span class="o">.</span><span class="n">input_device_name</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_input_device</span>
</span><span id="Composition-1053"><a href="#Composition-1053"><span class="linenos">1053</span></a>			<span class="bp">self</span><span class="o">.</span><span class="n">_sequencer</span><span class="o">.</span><span class="n">clock_follow</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_clock_follow</span>
</span><span id="Composition-1054"><a href="#Composition-1054"><span class="linenos">1054</span></a>
</span><span id="Composition-1055"><a href="#Composition-1055"><span class="linenos">1055</span></a>		<span class="c1"># Derive child RNGs from the master seed so each component gets</span>
</span><span id="Composition-1056"><a href="#Composition-1056"><span class="linenos">1056</span></a>		<span class="c1"># an independent, deterministic stream.  When no seed is set,</span>
</span><span id="Composition-1057"><a href="#Composition-1057"><span class="linenos">1057</span></a>		<span class="c1"># each component creates its own unseeded RNG (existing behaviour).</span>
</span><span id="Composition-1058"><a href="#Composition-1058"><span class="linenos">1058</span></a>		<span class="bp">self</span><span class="o">.</span><span class="n">_pattern_rngs</span><span class="p">:</span> <span class="n">typing</span><span class="o">.</span><span class="n">List</span><span class="p">[</span><span class="n">random</span><span class="o">.</span><span class="n">Random</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="Composition-1059"><a href="#Composition-1059"><span class="linenos">1059</span></a>
</span><span id="Composition-1060"><a href="#Composition-1060"><span class="linenos">1060</span></a>		<span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_seed</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="Composition-1061"><a href="#Composition-1061"><span class="linenos">1061</span></a>			<span class="n">master</span> <span class="o">=</span> <span class="n">random</span><span class="o">.</span><span class="n">Random</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_seed</span><span class="p">)</span>
</span><span id="Composition-1062"><a href="#Composition-1062"><span class="linenos">1062</span></a>
</span><span id="Composition-1063"><a href="#Composition-1063"><span class="linenos">1063</span></a>			<span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_harmonic_state</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="Composition-1064"><a href="#Composition-1064"><span class="linenos">1064</span></a>				<span class="bp">self</span><span class="o">.</span><span class="n">_harmonic_state</span><span class="o">.</span><span class="n">rng</span> <span class="o">=</span> <span class="n">random</span><span class="o">.</span><span class="n">Random</span><span class="p">(</span><span class="n">master</span><span class="o">.</span><span class="n">randint</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">2</span> <span class="o">**</span> <span class="mi">63</span><span class="p">))</span>
</span><span id="Composition-1065"><a href="#Composition-1065"><span class="linenos">1065</span></a>
</span><span id="Composition-1066"><a href="#Composition-1066"><span class="linenos">1066</span></a>			<span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_form_state</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="Composition-1067"><a href="#Composition-1067"><span class="linenos">1067</span></a>				<span class="bp">self</span><span class="o">.</span><span class="n">_form_state</span><span class="o">.</span><span class="n">_rng</span> <span class="o">=</span> <span class="n">random</span><span class="o">.</span><span class="n">Random</span><span class="p">(</span><span class="n">master</span><span class="o">.</span><span class="n">randint</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">2</span> <span class="o">**</span> <span class="mi">63</span><span class="p">))</span>
</span><span id="Composition-1068"><a href="#Composition-1068"><span class="linenos">1068</span></a>
</span><span id="Composition-1069"><a href="#Composition-1069"><span class="linenos">1069</span></a>			<span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_pending_patterns</span><span class="p">:</span>
</span><span id="Composition-1070"><a href="#Composition-1070"><span class="linenos">1070</span></a>				<span class="bp">self</span><span class="o">.</span><span class="n">_pattern_rngs</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">random</span><span class="o">.</span><span class="n">Random</span><span class="p">(</span><span class="n">master</span><span class="o">.</span><span class="n">randint</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">2</span> <span class="o">**</span> <span class="mi">63</span><span class="p">)))</span>
</span><span id="Composition-1071"><a href="#Composition-1071"><span class="linenos">1071</span></a>
</span><span id="Composition-1072"><a href="#Composition-1072"><span class="linenos">1072</span></a>		<span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_harmonic_state</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">_harmony_cycle_beats</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="Composition-1073"><a href="#Composition-1073"><span class="linenos">1073</span></a>
</span><span id="Composition-1074"><a href="#Composition-1074"><span class="linenos">1074</span></a>			<span class="k">await</span> <span class="n">schedule_harmonic_clock</span><span class="p">(</span>
</span><span id="Composition-1075"><a href="#Composition-1075"><span class="linenos">1075</span></a>				<span class="n">sequencer</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_sequencer</span><span class="p">,</span>
</span><span id="Composition-1076"><a href="#Composition-1076"><span class="linenos">1076</span></a>				<span class="n">harmonic_state</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_harmonic_state</span><span class="p">,</span>
</span><span id="Composition-1077"><a href="#Composition-1077"><span class="linenos">1077</span></a>				<span class="n">cycle_beats</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_harmony_cycle_beats</span><span class="p">,</span>
</span><span id="Composition-1078"><a href="#Composition-1078"><span class="linenos">1078</span></a>				<span class="n">reschedule_lookahead</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_harmony_reschedule_lookahead</span>
</span><span id="Composition-1079"><a href="#Composition-1079"><span class="linenos">1079</span></a>			<span class="p">)</span>
</span><span id="Composition-1080"><a href="#Composition-1080"><span class="linenos">1080</span></a>
</span><span id="Composition-1081"><a href="#Composition-1081"><span class="linenos">1081</span></a>		<span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_form_state</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="Composition-1082"><a href="#Composition-1082"><span class="linenos">1082</span></a>
</span><span id="Composition-1083"><a href="#Composition-1083"><span class="linenos">1083</span></a>			<span class="k">await</span> <span class="n">schedule_form</span><span class="p">(</span>
</span><span id="Composition-1084"><a href="#Composition-1084"><span class="linenos">1084</span></a>				<span class="n">sequencer</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_sequencer</span><span class="p">,</span>
</span><span id="Composition-1085"><a href="#Composition-1085"><span class="linenos">1085</span></a>				<span class="n">form_state</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_form_state</span><span class="p">,</span>
</span><span id="Composition-1086"><a href="#Composition-1086"><span class="linenos">1086</span></a>				<span class="n">reschedule_lookahead</span> <span class="o">=</span> <span class="mi">1</span>
</span><span id="Composition-1087"><a href="#Composition-1087"><span class="linenos">1087</span></a>			<span class="p">)</span>
</span><span id="Composition-1088"><a href="#Composition-1088"><span class="linenos">1088</span></a>
</span><span id="Composition-1089"><a href="#Composition-1089"><span class="linenos">1089</span></a>		<span class="c1"># Bar counter - always active so p.bar is available to all builders.</span>
</span><span id="Composition-1090"><a href="#Composition-1090"><span class="linenos">1090</span></a>		<span class="k">def</span><span class="w"> </span><span class="nf">_advance_builder_bar</span> <span class="p">(</span><span class="n">pulse</span><span class="p">:</span> <span class="nb">int</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="Composition-1091"><a href="#Composition-1091"><span class="linenos">1091</span></a>			<span class="bp">self</span><span class="o">.</span><span class="n">_builder_bar</span> <span class="o">+=</span> <span class="mi">1</span>
</span><span id="Composition-1092"><a href="#Composition-1092"><span class="linenos">1092</span></a>
</span><span id="Composition-1093"><a href="#Composition-1093"><span class="linenos">1093</span></a>		<span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">_sequencer</span><span class="o">.</span><span class="n">schedule_callback_repeating</span><span class="p">(</span>
</span><span id="Composition-1094"><a href="#Composition-1094"><span class="linenos">1094</span></a>			<span class="n">callback</span> <span class="o">=</span> <span class="n">_advance_builder_bar</span><span class="p">,</span>
</span><span id="Composition-1095"><a href="#Composition-1095"><span class="linenos">1095</span></a>			<span class="n">interval_beats</span> <span class="o">=</span> <span class="mi">4</span><span class="p">,</span>
</span><span id="Composition-1096"><a href="#Composition-1096"><span class="linenos">1096</span></a>			<span class="n">start_pulse</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span>
</span><span id="Composition-1097"><a href="#Composition-1097"><span class="linenos">1097</span></a>			<span class="n">reschedule_lookahead</span> <span class="o">=</span> <span class="mi">1</span>
</span><span id="Composition-1098"><a href="#Composition-1098"><span class="linenos">1098</span></a>		<span class="p">)</span>
</span><span id="Composition-1099"><a href="#Composition-1099"><span class="linenos">1099</span></a>
</span><span id="Composition-1100"><a href="#Composition-1100"><span class="linenos">1100</span></a>		<span class="k">for</span> <span class="n">pending_task</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_pending_scheduled</span><span class="p">:</span>
</span><span id="Composition-1101"><a href="#Composition-1101"><span class="linenos">1101</span></a>
</span><span id="Composition-1102"><a href="#Composition-1102"><span class="linenos">1102</span></a>			<span class="n">wrapped</span> <span class="o">=</span> <span class="n">_make_safe_callback</span><span class="p">(</span><span class="n">pending_task</span><span class="o">.</span><span class="n">fn</span><span class="p">)</span>
</span><span id="Composition-1103"><a href="#Composition-1103"><span class="linenos">1103</span></a>
</span><span id="Composition-1104"><a href="#Composition-1104"><span class="linenos">1104</span></a>			<span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">_sequencer</span><span class="o">.</span><span class="n">schedule_callback_repeating</span><span class="p">(</span>
</span><span id="Composition-1105"><a href="#Composition-1105"><span class="linenos">1105</span></a>				<span class="n">callback</span> <span class="o">=</span> <span class="n">wrapped</span><span class="p">,</span>
</span><span id="Composition-1106"><a href="#Composition-1106"><span class="linenos">1106</span></a>				<span class="n">interval_beats</span> <span class="o">=</span> <span class="n">pending_task</span><span class="o">.</span><span class="n">cycle_beats</span><span class="p">,</span>
</span><span id="Composition-1107"><a href="#Composition-1107"><span class="linenos">1107</span></a>				<span class="n">start_pulse</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span>
</span><span id="Composition-1108"><a href="#Composition-1108"><span class="linenos">1108</span></a>				<span class="n">reschedule_lookahead</span> <span class="o">=</span> <span class="n">pending_task</span><span class="o">.</span><span class="n">reschedule_lookahead</span>
</span><span id="Composition-1109"><a href="#Composition-1109"><span class="linenos">1109</span></a>			<span class="p">)</span>
</span><span id="Composition-1110"><a href="#Composition-1110"><span class="linenos">1110</span></a>
</span><span id="Composition-1111"><a href="#Composition-1111"><span class="linenos">1111</span></a>		<span class="c1"># Build Pattern objects from pending registrations.</span>
</span><span id="Composition-1112"><a href="#Composition-1112"><span class="linenos">1112</span></a>		<span class="n">patterns</span><span class="p">:</span> <span class="n">typing</span><span class="o">.</span><span class="n">List</span><span class="p">[</span><span class="n">subsequence</span><span class="o">.</span><span class="n">pattern</span><span class="o">.</span><span class="n">Pattern</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="Composition-1113"><a href="#Composition-1113"><span class="linenos">1113</span></a>
</span><span id="Composition-1114"><a href="#Composition-1114"><span class="linenos">1114</span></a>		<span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">pending</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_pending_patterns</span><span class="p">):</span>
</span><span id="Composition-1115"><a href="#Composition-1115"><span class="linenos">1115</span></a>
</span><span id="Composition-1116"><a href="#Composition-1116"><span class="linenos">1116</span></a>			<span class="n">pattern_rng</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_pattern_rngs</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="k">if</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_pattern_rngs</span><span class="p">)</span> <span class="k">else</span> <span class="kc">None</span>
</span><span id="Composition-1117"><a href="#Composition-1117"><span class="linenos">1117</span></a>			<span class="n">pattern</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_build_pattern_from_pending</span><span class="p">(</span><span class="n">pending</span><span class="p">,</span> <span class="n">pattern_rng</span><span class="p">)</span>
</span><span id="Composition-1118"><a href="#Composition-1118"><span class="linenos">1118</span></a>			<span class="n">patterns</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">pattern</span><span class="p">)</span>
</span><span id="Composition-1119"><a href="#Composition-1119"><span class="linenos">1119</span></a>
</span><span id="Composition-1120"><a href="#Composition-1120"><span class="linenos">1120</span></a>		<span class="k">await</span> <span class="n">schedule_patterns</span><span class="p">(</span>
</span><span id="Composition-1121"><a href="#Composition-1121"><span class="linenos">1121</span></a>			<span class="n">sequencer</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_sequencer</span><span class="p">,</span>
</span><span id="Composition-1122"><a href="#Composition-1122"><span class="linenos">1122</span></a>			<span class="n">patterns</span> <span class="o">=</span> <span class="n">patterns</span><span class="p">,</span>
</span><span id="Composition-1123"><a href="#Composition-1123"><span class="linenos">1123</span></a>			<span class="n">start_pulse</span> <span class="o">=</span> <span class="mi">0</span>
</span><span id="Composition-1124"><a href="#Composition-1124"><span class="linenos">1124</span></a>		<span class="p">)</span>
</span><span id="Composition-1125"><a href="#Composition-1125"><span class="linenos">1125</span></a>
</span><span id="Composition-1126"><a href="#Composition-1126"><span class="linenos">1126</span></a>		<span class="c1"># Populate the running patterns dict for live hot-swap and mute/unmute.</span>
</span><span id="Composition-1127"><a href="#Composition-1127"><span class="linenos">1127</span></a>		<span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">pending</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_pending_patterns</span><span class="p">):</span>
</span><span id="Composition-1128"><a href="#Composition-1128"><span class="linenos">1128</span></a>			<span class="n">name</span> <span class="o">=</span> <span class="n">pending</span><span class="o">.</span><span class="n">builder_fn</span><span class="o">.</span><span class="vm">__name__</span>
</span><span id="Composition-1129"><a href="#Composition-1129"><span class="linenos">1129</span></a>			<span class="bp">self</span><span class="o">.</span><span class="n">_running_patterns</span><span class="p">[</span><span class="n">name</span><span class="p">]</span> <span class="o">=</span> <span class="n">patterns</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
</span><span id="Composition-1130"><a href="#Composition-1130"><span class="linenos">1130</span></a>
</span><span id="Composition-1131"><a href="#Composition-1131"><span class="linenos">1131</span></a>		<span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_display</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="Composition-1132"><a href="#Composition-1132"><span class="linenos">1132</span></a>			<span class="bp">self</span><span class="o">.</span><span class="n">_display</span><span class="o">.</span><span class="n">start</span><span class="p">()</span>
</span><span id="Composition-1133"><a href="#Composition-1133"><span class="linenos">1133</span></a>			<span class="bp">self</span><span class="o">.</span><span class="n">_sequencer</span><span class="o">.</span><span class="n">on_event</span><span class="p">(</span><span class="s2">&quot;bar&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_display</span><span class="o">.</span><span class="n">update</span><span class="p">)</span>
</span><span id="Composition-1134"><a href="#Composition-1134"><span class="linenos">1134</span></a>
</span><span id="Composition-1135"><a href="#Composition-1135"><span class="linenos">1135</span></a>		<span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_live_server</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="Composition-1136"><a href="#Composition-1136"><span class="linenos">1136</span></a>			<span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">_live_server</span><span class="o">.</span><span class="n">start</span><span class="p">()</span>
</span><span id="Composition-1137"><a href="#Composition-1137"><span class="linenos">1137</span></a>
</span><span id="Composition-1138"><a href="#Composition-1138"><span class="linenos">1138</span></a>		<span class="k">await</span> <span class="n">run_until_stopped</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_sequencer</span><span class="p">)</span>
</span><span id="Composition-1139"><a href="#Composition-1139"><span class="linenos">1139</span></a>
</span><span id="Composition-1140"><a href="#Composition-1140"><span class="linenos">1140</span></a>		<span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_live_server</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="Composition-1141"><a href="#Composition-1141"><span class="linenos">1141</span></a>			<span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">_live_server</span><span class="o">.</span><span class="n">stop</span><span class="p">()</span>
</span><span id="Composition-1142"><a href="#Composition-1142"><span class="linenos">1142</span></a>
</span><span id="Composition-1143"><a href="#Composition-1143"><span class="linenos">1143</span></a>		<span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_display</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="Composition-1144"><a href="#Composition-1144"><span class="linenos">1144</span></a>			<span class="bp">self</span><span class="o">.</span><span class="n">_display</span><span class="o">.</span><span class="n">stop</span><span class="p">()</span>
</span><span id="Composition-1145"><a href="#Composition-1145"><span class="linenos">1145</span></a>
</span><span id="Composition-1146"><a href="#Composition-1146"><span class="linenos">1146</span></a>	<span class="k">def</span><span class="w"> </span><span class="nf">_build_pattern_from_pending</span> <span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">pending</span><span class="p">:</span> <span class="n">_PendingPattern</span><span class="p">,</span> <span class="n">rng</span><span class="p">:</span> <span class="n">typing</span><span class="o">.</span><span class="n">Optional</span><span class="p">[</span><span class="n">random</span><span class="o">.</span><span class="n">Random</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">subsequence</span><span class="o">.</span><span class="n">pattern</span><span class="o">.</span><span class="n">Pattern</span><span class="p">:</span>
</span><span id="Composition-1147"><a href="#Composition-1147"><span class="linenos">1147</span></a>
</span><span id="Composition-1148"><a href="#Composition-1148"><span class="linenos">1148</span></a><span class="w">		</span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="Composition-1149"><a href="#Composition-1149"><span class="linenos">1149</span></a><span class="sd">		Create a Pattern from a pending registration using a temporary subclass.</span>
</span><span id="Composition-1150"><a href="#Composition-1150"><span class="linenos">1150</span></a><span class="sd">		&quot;&quot;&quot;</span>
</span><span id="Composition-1151"><a href="#Composition-1151"><span class="linenos">1151</span></a>
</span><span id="Composition-1152"><a href="#Composition-1152"><span class="linenos">1152</span></a>		<span class="n">composition_ref</span> <span class="o">=</span> <span class="bp">self</span>
</span><span id="Composition-1153"><a href="#Composition-1153"><span class="linenos">1153</span></a>
</span><span id="Composition-1154"><a href="#Composition-1154"><span class="linenos">1154</span></a>		<span class="k">class</span><span class="w"> </span><span class="nc">_DecoratorPattern</span> <span class="p">(</span><span class="n">subsequence</span><span class="o">.</span><span class="n">pattern</span><span class="o">.</span><span class="n">Pattern</span><span class="p">):</span>
</span><span id="Composition-1155"><a href="#Composition-1155"><span class="linenos">1155</span></a>
</span><span id="Composition-1156"><a href="#Composition-1156"><span class="linenos">1156</span></a><span class="w">			</span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="Composition-1157"><a href="#Composition-1157"><span class="linenos">1157</span></a><span class="sd">			Pattern subclass that delegates to a builder function on each reschedule.</span>
</span><span id="Composition-1158"><a href="#Composition-1158"><span class="linenos">1158</span></a><span class="sd">			&quot;&quot;&quot;</span>
</span><span id="Composition-1159"><a href="#Composition-1159"><span class="linenos">1159</span></a>
</span><span id="Composition-1160"><a href="#Composition-1160"><span class="linenos">1160</span></a>			<span class="k">def</span><span class="w"> </span><span class="fm">__init__</span> <span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">pending</span><span class="p">:</span> <span class="n">_PendingPattern</span><span class="p">,</span> <span class="n">pattern_rng</span><span class="p">:</span> <span class="n">typing</span><span class="o">.</span><span class="n">Optional</span><span class="p">[</span><span class="n">random</span><span class="o">.</span><span class="n">Random</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="Composition-1161"><a href="#Composition-1161"><span class="linenos">1161</span></a>
</span><span id="Composition-1162"><a href="#Composition-1162"><span class="linenos">1162</span></a><span class="w">				</span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="Composition-1163"><a href="#Composition-1163"><span class="linenos">1163</span></a><span class="sd">				Initialize the decorator pattern from pending registration details.</span>
</span><span id="Composition-1164"><a href="#Composition-1164"><span class="linenos">1164</span></a><span class="sd">				&quot;&quot;&quot;</span>
</span><span id="Composition-1165"><a href="#Composition-1165"><span class="linenos">1165</span></a>
</span><span id="Composition-1166"><a href="#Composition-1166"><span class="linenos">1166</span></a>				<span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span>
</span><span id="Composition-1167"><a href="#Composition-1167"><span class="linenos">1167</span></a>					<span class="n">channel</span> <span class="o">=</span> <span class="n">pending</span><span class="o">.</span><span class="n">channel</span><span class="p">,</span>
</span><span id="Composition-1168"><a href="#Composition-1168"><span class="linenos">1168</span></a>					<span class="n">length</span> <span class="o">=</span> <span class="n">pending</span><span class="o">.</span><span class="n">length</span><span class="p">,</span>
</span><span id="Composition-1169"><a href="#Composition-1169"><span class="linenos">1169</span></a>					<span class="n">reschedule_lookahead</span> <span class="o">=</span> <span class="n">pending</span><span class="o">.</span><span class="n">reschedule_lookahead</span>
</span><span id="Composition-1170"><a href="#Composition-1170"><span class="linenos">1170</span></a>				<span class="p">)</span>
</span><span id="Composition-1171"><a href="#Composition-1171"><span class="linenos">1171</span></a>
</span><span id="Composition-1172"><a href="#Composition-1172"><span class="linenos">1172</span></a>				<span class="bp">self</span><span class="o">.</span><span class="n">_builder_fn</span> <span class="o">=</span> <span class="n">pending</span><span class="o">.</span><span class="n">builder_fn</span>
</span><span id="Composition-1173"><a href="#Composition-1173"><span class="linenos">1173</span></a>				<span class="bp">self</span><span class="o">.</span><span class="n">_drum_note_map</span> <span class="o">=</span> <span class="n">pending</span><span class="o">.</span><span class="n">drum_note_map</span>
</span><span id="Composition-1174"><a href="#Composition-1174"><span class="linenos">1174</span></a>				<span class="bp">self</span><span class="o">.</span><span class="n">_wants_chord</span> <span class="o">=</span> <span class="n">_fn_has_parameter</span><span class="p">(</span><span class="n">pending</span><span class="o">.</span><span class="n">builder_fn</span><span class="p">,</span> <span class="s2">&quot;chord&quot;</span><span class="p">)</span>
</span><span id="Composition-1175"><a href="#Composition-1175"><span class="linenos">1175</span></a>				<span class="bp">self</span><span class="o">.</span><span class="n">_cycle_count</span> <span class="o">=</span> <span class="mi">0</span>
</span><span id="Composition-1176"><a href="#Composition-1176"><span class="linenos">1176</span></a>				<span class="bp">self</span><span class="o">.</span><span class="n">_rng</span> <span class="o">=</span> <span class="n">pattern_rng</span>
</span><span id="Composition-1177"><a href="#Composition-1177"><span class="linenos">1177</span></a>				<span class="bp">self</span><span class="o">.</span><span class="n">_muted</span> <span class="o">=</span> <span class="kc">False</span>
</span><span id="Composition-1178"><a href="#Composition-1178"><span class="linenos">1178</span></a>				<span class="bp">self</span><span class="o">.</span><span class="n">_voice_leading_state</span><span class="p">:</span> <span class="n">typing</span><span class="o">.</span><span class="n">Optional</span><span class="p">[</span><span class="n">subsequence</span><span class="o">.</span><span class="n">voicings</span><span class="o">.</span><span class="n">VoiceLeadingState</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span>
</span><span id="Composition-1179"><a href="#Composition-1179"><span class="linenos">1179</span></a>					<span class="n">subsequence</span><span class="o">.</span><span class="n">voicings</span><span class="o">.</span><span class="n">VoiceLeadingState</span><span class="p">()</span> <span class="k">if</span> <span class="n">pending</span><span class="o">.</span><span class="n">voice_leading</span> <span class="k">else</span> <span class="kc">None</span>
</span><span id="Composition-1180"><a href="#Composition-1180"><span class="linenos">1180</span></a>				<span class="p">)</span>
</span><span id="Composition-1181"><a href="#Composition-1181"><span class="linenos">1181</span></a>
</span><span id="Composition-1182"><a href="#Composition-1182"><span class="linenos">1182</span></a>				<span class="bp">self</span><span class="o">.</span><span class="n">_rebuild</span><span class="p">()</span>
</span><span id="Composition-1183"><a href="#Composition-1183"><span class="linenos">1183</span></a>
</span><span id="Composition-1184"><a href="#Composition-1184"><span class="linenos">1184</span></a>			<span class="k">def</span><span class="w"> </span><span class="nf">_rebuild</span> <span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="Composition-1185"><a href="#Composition-1185"><span class="linenos">1185</span></a>
</span><span id="Composition-1186"><a href="#Composition-1186"><span class="linenos">1186</span></a><span class="w">				</span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="Composition-1187"><a href="#Composition-1187"><span class="linenos">1187</span></a><span class="sd">				Clear steps and call the builder function to repopulate.</span>
</span><span id="Composition-1188"><a href="#Composition-1188"><span class="linenos">1188</span></a><span class="sd">				&quot;&quot;&quot;</span>
</span><span id="Composition-1189"><a href="#Composition-1189"><span class="linenos">1189</span></a>
</span><span id="Composition-1190"><a href="#Composition-1190"><span class="linenos">1190</span></a>				<span class="bp">self</span><span class="o">.</span><span class="n">steps</span> <span class="o">=</span> <span class="p">{}</span>
</span><span id="Composition-1191"><a href="#Composition-1191"><span class="linenos">1191</span></a>				<span class="n">current_cycle</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_cycle_count</span>
</span><span id="Composition-1192"><a href="#Composition-1192"><span class="linenos">1192</span></a>				<span class="bp">self</span><span class="o">.</span><span class="n">_cycle_count</span> <span class="o">+=</span> <span class="mi">1</span>
</span><span id="Composition-1193"><a href="#Composition-1193"><span class="linenos">1193</span></a>
</span><span id="Composition-1194"><a href="#Composition-1194"><span class="linenos">1194</span></a>				<span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_muted</span><span class="p">:</span>
</span><span id="Composition-1195"><a href="#Composition-1195"><span class="linenos">1195</span></a>					<span class="k">return</span>
</span><span id="Composition-1196"><a href="#Composition-1196"><span class="linenos">1196</span></a>
</span><span id="Composition-1197"><a href="#Composition-1197"><span class="linenos">1197</span></a>				<span class="c1"># Import here to avoid circular import at module level.</span>
</span><span id="Composition-1198"><a href="#Composition-1198"><span class="linenos">1198</span></a>				<span class="kn">import</span><span class="w"> </span><span class="nn">subsequence.pattern_builder</span>
</span><span id="Composition-1199"><a href="#Composition-1199"><span class="linenos">1199</span></a>
</span><span id="Composition-1200"><a href="#Composition-1200"><span class="linenos">1200</span></a>				<span class="n">builder</span> <span class="o">=</span> <span class="n">subsequence</span><span class="o">.</span><span class="n">pattern_builder</span><span class="o">.</span><span class="n">PatternBuilder</span><span class="p">(</span>
</span><span id="Composition-1201"><a href="#Composition-1201"><span class="linenos">1201</span></a>					<span class="n">pattern</span> <span class="o">=</span> <span class="bp">self</span><span class="p">,</span>
</span><span id="Composition-1202"><a href="#Composition-1202"><span class="linenos">1202</span></a>					<span class="n">cycle</span> <span class="o">=</span> <span class="n">current_cycle</span><span class="p">,</span>
</span><span id="Composition-1203"><a href="#Composition-1203"><span class="linenos">1203</span></a>					<span class="n">drum_note_map</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_drum_note_map</span><span class="p">,</span>
</span><span id="Composition-1204"><a href="#Composition-1204"><span class="linenos">1204</span></a>					<span class="n">section</span> <span class="o">=</span> <span class="n">composition_ref</span><span class="o">.</span><span class="n">_form_state</span><span class="o">.</span><span class="n">get_section_info</span><span class="p">()</span> <span class="k">if</span> <span class="n">composition_ref</span><span class="o">.</span><span class="n">_form_state</span> <span class="k">else</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="Composition-1205"><a href="#Composition-1205"><span class="linenos">1205</span></a>					<span class="n">bar</span> <span class="o">=</span> <span class="n">composition_ref</span><span class="o">.</span><span class="n">_builder_bar</span><span class="p">,</span>
</span><span id="Composition-1206"><a href="#Composition-1206"><span class="linenos">1206</span></a>					<span class="n">rng</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_rng</span>
</span><span id="Composition-1207"><a href="#Composition-1207"><span class="linenos">1207</span></a>				<span class="p">)</span>
</span><span id="Composition-1208"><a href="#Composition-1208"><span class="linenos">1208</span></a>
</span><span id="Composition-1209"><a href="#Composition-1209"><span class="linenos">1209</span></a>				<span class="k">try</span><span class="p">:</span>
</span><span id="Composition-1210"><a href="#Composition-1210"><span class="linenos">1210</span></a>
</span><span id="Composition-1211"><a href="#Composition-1211"><span class="linenos">1211</span></a>					<span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_wants_chord</span> <span class="ow">and</span> <span class="n">composition_ref</span><span class="o">.</span><span class="n">_harmonic_state</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="Composition-1212"><a href="#Composition-1212"><span class="linenos">1212</span></a>						<span class="n">chord</span> <span class="o">=</span> <span class="n">composition_ref</span><span class="o">.</span><span class="n">_harmonic_state</span><span class="o">.</span><span class="n">get_current_chord</span><span class="p">()</span>
</span><span id="Composition-1213"><a href="#Composition-1213"><span class="linenos">1213</span></a>						<span class="n">key_root_pc</span> <span class="o">=</span> <span class="n">composition_ref</span><span class="o">.</span><span class="n">_harmonic_state</span><span class="o">.</span><span class="n">key_root_pc</span>
</span><span id="Composition-1214"><a href="#Composition-1214"><span class="linenos">1214</span></a>						<span class="n">injected</span> <span class="o">=</span> <span class="n">_InjectedChord</span><span class="p">(</span><span class="n">chord</span><span class="p">,</span> <span class="n">key_root_pc</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_voice_leading_state</span><span class="p">)</span>
</span><span id="Composition-1215"><a href="#Composition-1215"><span class="linenos">1215</span></a>						<span class="bp">self</span><span class="o">.</span><span class="n">_builder_fn</span><span class="p">(</span><span class="n">builder</span><span class="p">,</span> <span class="n">injected</span><span class="p">)</span>
</span><span id="Composition-1216"><a href="#Composition-1216"><span class="linenos">1216</span></a>
</span><span id="Composition-1217"><a href="#Composition-1217"><span class="linenos">1217</span></a>					<span class="k">else</span><span class="p">:</span>
</span><span id="Composition-1218"><a href="#Composition-1218"><span class="linenos">1218</span></a>						<span class="bp">self</span><span class="o">.</span><span class="n">_builder_fn</span><span class="p">(</span><span class="n">builder</span><span class="p">)</span>
</span><span id="Composition-1219"><a href="#Composition-1219"><span class="linenos">1219</span></a>
</span><span id="Composition-1220"><a href="#Composition-1220"><span class="linenos">1220</span></a>				<span class="k">except</span> <span class="ne">Exception</span><span class="p">:</span>
</span><span id="Composition-1221"><a href="#Composition-1221"><span class="linenos">1221</span></a>					<span class="n">logger</span><span class="o">.</span><span class="n">exception</span><span class="p">(</span><span class="s2">&quot;Error in pattern builder &#39;</span><span class="si">%s</span><span class="s2">&#39; (cycle </span><span class="si">%d</span><span class="s2">) - pattern will be silent this cycle&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_builder_fn</span><span class="o">.</span><span class="vm">__name__</span><span class="p">,</span> <span class="n">current_cycle</span><span class="p">)</span>
</span><span id="Composition-1222"><a href="#Composition-1222"><span class="linenos">1222</span></a>
</span><span id="Composition-1223"><a href="#Composition-1223"><span class="linenos">1223</span></a>			<span class="k">def</span><span class="w"> </span><span class="nf">on_reschedule</span> <span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="Composition-1224"><a href="#Composition-1224"><span class="linenos">1224</span></a>
</span><span id="Composition-1225"><a href="#Composition-1225"><span class="linenos">1225</span></a><span class="w">				</span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="Composition-1226"><a href="#Composition-1226"><span class="linenos">1226</span></a><span class="sd">				Rebuild the pattern from the builder function before the next cycle.</span>
</span><span id="Composition-1227"><a href="#Composition-1227"><span class="linenos">1227</span></a><span class="sd">				&quot;&quot;&quot;</span>
</span><span id="Composition-1228"><a href="#Composition-1228"><span class="linenos">1228</span></a>
</span><span id="Composition-1229"><a href="#Composition-1229"><span class="linenos">1229</span></a>				<span class="bp">self</span><span class="o">.</span><span class="n">_rebuild</span><span class="p">()</span>
</span><span id="Composition-1230"><a href="#Composition-1230"><span class="linenos">1230</span></a>
</span><span id="Composition-1231"><a href="#Composition-1231"><span class="linenos">1231</span></a>		<span class="k">return</span> <span class="n">_DecoratorPattern</span><span class="p">(</span><span class="n">pending</span><span class="p">,</span> <span class="n">rng</span><span class="p">)</span>
</span></pre></div>


            <div class="docstring"><p>Top-level composition object that owns the sequencer, harmonic state, and pattern registry.</p>
</div>


                            <div id="Composition.__init__" class="classattr">
                                        <input id="Composition.__init__-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="name">Composition</span><span class="signature pdoc-code multiline">(<span class="param">	<span class="n">output_device</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>,</span><span class="param">	<span class="n">bpm</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">120</span>,</span><span class="param">	<span class="n">key</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>,</span><span class="param">	<span class="n">seed</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span></span>)</span>

                <label class="view-source-button" for="Composition.__init__-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#Composition.__init__"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="Composition.__init__-497"><a href="#Composition.__init__-497"><span class="linenos">497</span></a>	<span class="k">def</span><span class="w"> </span><span class="fm">__init__</span> <span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">output_device</span><span class="p">:</span> <span class="n">typing</span><span class="o">.</span><span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">bpm</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">120</span><span class="p">,</span> <span class="n">key</span><span class="p">:</span> <span class="n">typing</span><span class="o">.</span><span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">seed</span><span class="p">:</span> <span class="n">typing</span><span class="o">.</span><span class="n">Optional</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="Composition.__init__-498"><a href="#Composition.__init__-498"><span class="linenos">498</span></a>
</span><span id="Composition.__init__-499"><a href="#Composition.__init__-499"><span class="linenos">499</span></a><span class="w">		</span><span class="sd">&quot;&quot;&quot;Initialize a composition with MIDI output device, tempo, and optional key.</span>
</span><span id="Composition.__init__-500"><a href="#Composition.__init__-500"><span class="linenos">500</span></a>
</span><span id="Composition.__init__-501"><a href="#Composition.__init__-501"><span class="linenos">501</span></a><span class="sd">		Parameters:</span>
</span><span id="Composition.__init__-502"><a href="#Composition.__init__-502"><span class="linenos">502</span></a><span class="sd">			output_device: MIDI output device name (e.g., `&quot;Device Name:Port 1 16:0&quot;`).</span>
</span><span id="Composition.__init__-503"><a href="#Composition.__init__-503"><span class="linenos">503</span></a><span class="sd">				When omitted, auto-discovers available devices - uses the only device</span>
</span><span id="Composition.__init__-504"><a href="#Composition.__init__-504"><span class="linenos">504</span></a><span class="sd">				if one is found, or prompts the user to choose if multiple are available.</span>
</span><span id="Composition.__init__-505"><a href="#Composition.__init__-505"><span class="linenos">505</span></a><span class="sd">			bpm: Tempo in beats per minute (default 120)</span>
</span><span id="Composition.__init__-506"><a href="#Composition.__init__-506"><span class="linenos">506</span></a><span class="sd">			key: Root key name (e.g., `&quot;C&quot;`, `&quot;F#&quot;`, `&quot;Bb&quot;`). Required if using `harmony()`.</span>
</span><span id="Composition.__init__-507"><a href="#Composition.__init__-507"><span class="linenos">507</span></a><span class="sd">			seed: Optional random seed. When set, all randomness (chord progressions, form</span>
</span><span id="Composition.__init__-508"><a href="#Composition.__init__-508"><span class="linenos">508</span></a><span class="sd">				transitions, pattern builder functions) becomes deterministic and repeatable.</span>
</span><span id="Composition.__init__-509"><a href="#Composition.__init__-509"><span class="linenos">509</span></a>
</span><span id="Composition.__init__-510"><a href="#Composition.__init__-510"><span class="linenos">510</span></a><span class="sd">		Example:</span>
</span><span id="Composition.__init__-511"><a href="#Composition.__init__-511"><span class="linenos">511</span></a><span class="sd">			```python</span>
</span><span id="Composition.__init__-512"><a href="#Composition.__init__-512"><span class="linenos">512</span></a><span class="sd">			composition = subsequence.Composition(</span>
</span><span id="Composition.__init__-513"><a href="#Composition.__init__-513"><span class="linenos">513</span></a><span class="sd">				output_device=&quot;Scarlett 2i4 USB:Scarlett 2i4 USB MIDI 1 16:0&quot;,</span>
</span><span id="Composition.__init__-514"><a href="#Composition.__init__-514"><span class="linenos">514</span></a><span class="sd">				bpm=125,</span>
</span><span id="Composition.__init__-515"><a href="#Composition.__init__-515"><span class="linenos">515</span></a><span class="sd">				key=&quot;E&quot;,</span>
</span><span id="Composition.__init__-516"><a href="#Composition.__init__-516"><span class="linenos">516</span></a><span class="sd">				seed=42</span>
</span><span id="Composition.__init__-517"><a href="#Composition.__init__-517"><span class="linenos">517</span></a><span class="sd">			)</span>
</span><span id="Composition.__init__-518"><a href="#Composition.__init__-518"><span class="linenos">518</span></a><span class="sd">			```</span>
</span><span id="Composition.__init__-519"><a href="#Composition.__init__-519"><span class="linenos">519</span></a><span class="sd">		&quot;&quot;&quot;</span>
</span><span id="Composition.__init__-520"><a href="#Composition.__init__-520"><span class="linenos">520</span></a>
</span><span id="Composition.__init__-521"><a href="#Composition.__init__-521"><span class="linenos">521</span></a>		<span class="bp">self</span><span class="o">.</span><span class="n">output_device</span> <span class="o">=</span> <span class="n">output_device</span>
</span><span id="Composition.__init__-522"><a href="#Composition.__init__-522"><span class="linenos">522</span></a>		<span class="bp">self</span><span class="o">.</span><span class="n">bpm</span> <span class="o">=</span> <span class="n">bpm</span>
</span><span id="Composition.__init__-523"><a href="#Composition.__init__-523"><span class="linenos">523</span></a>		<span class="bp">self</span><span class="o">.</span><span class="n">key</span> <span class="o">=</span> <span class="n">key</span>
</span><span id="Composition.__init__-524"><a href="#Composition.__init__-524"><span class="linenos">524</span></a>		<span class="bp">self</span><span class="o">.</span><span class="n">_seed</span><span class="p">:</span> <span class="n">typing</span><span class="o">.</span><span class="n">Optional</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="n">seed</span>
</span><span id="Composition.__init__-525"><a href="#Composition.__init__-525"><span class="linenos">525</span></a>
</span><span id="Composition.__init__-526"><a href="#Composition.__init__-526"><span class="linenos">526</span></a>		<span class="bp">self</span><span class="o">.</span><span class="n">_sequencer</span> <span class="o">=</span> <span class="n">subsequence</span><span class="o">.</span><span class="n">sequencer</span><span class="o">.</span><span class="n">Sequencer</span><span class="p">(</span>
</span><span id="Composition.__init__-527"><a href="#Composition.__init__-527"><span class="linenos">527</span></a>			<span class="n">output_device_name</span> <span class="o">=</span> <span class="n">output_device</span><span class="p">,</span>
</span><span id="Composition.__init__-528"><a href="#Composition.__init__-528"><span class="linenos">528</span></a>			<span class="n">initial_bpm</span> <span class="o">=</span> <span class="n">bpm</span>
</span><span id="Composition.__init__-529"><a href="#Composition.__init__-529"><span class="linenos">529</span></a>		<span class="p">)</span>
</span><span id="Composition.__init__-530"><a href="#Composition.__init__-530"><span class="linenos">530</span></a>
</span><span id="Composition.__init__-531"><a href="#Composition.__init__-531"><span class="linenos">531</span></a>		<span class="bp">self</span><span class="o">.</span><span class="n">_harmonic_state</span><span class="p">:</span> <span class="n">typing</span><span class="o">.</span><span class="n">Optional</span><span class="p">[</span><span class="n">subsequence</span><span class="o">.</span><span class="n">harmonic_state</span><span class="o">.</span><span class="n">HarmonicState</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="Composition.__init__-532"><a href="#Composition.__init__-532"><span class="linenos">532</span></a>		<span class="bp">self</span><span class="o">.</span><span class="n">_harmony_cycle_beats</span><span class="p">:</span> <span class="n">typing</span><span class="o">.</span><span class="n">Optional</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="Composition.__init__-533"><a href="#Composition.__init__-533"><span class="linenos">533</span></a>		<span class="bp">self</span><span class="o">.</span><span class="n">_harmony_reschedule_lookahead</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mi">1</span>
</span><span id="Composition.__init__-534"><a href="#Composition.__init__-534"><span class="linenos">534</span></a>		<span class="bp">self</span><span class="o">.</span><span class="n">_pending_patterns</span><span class="p">:</span> <span class="n">typing</span><span class="o">.</span><span class="n">List</span><span class="p">[</span><span class="n">_PendingPattern</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="Composition.__init__-535"><a href="#Composition.__init__-535"><span class="linenos">535</span></a>		<span class="bp">self</span><span class="o">.</span><span class="n">_pending_scheduled</span><span class="p">:</span> <span class="n">typing</span><span class="o">.</span><span class="n">List</span><span class="p">[</span><span class="n">_PendingScheduled</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="Composition.__init__-536"><a href="#Composition.__init__-536"><span class="linenos">536</span></a>		<span class="bp">self</span><span class="o">.</span><span class="n">_form_state</span><span class="p">:</span> <span class="n">typing</span><span class="o">.</span><span class="n">Optional</span><span class="p">[</span><span class="n">FormState</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="Composition.__init__-537"><a href="#Composition.__init__-537"><span class="linenos">537</span></a>		<span class="bp">self</span><span class="o">.</span><span class="n">_builder_bar</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">0</span>
</span><span id="Composition.__init__-538"><a href="#Composition.__init__-538"><span class="linenos">538</span></a>		<span class="bp">self</span><span class="o">.</span><span class="n">_display</span><span class="p">:</span> <span class="n">typing</span><span class="o">.</span><span class="n">Optional</span><span class="p">[</span><span class="n">subsequence</span><span class="o">.</span><span class="n">display</span><span class="o">.</span><span class="n">Display</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="Composition.__init__-539"><a href="#Composition.__init__-539"><span class="linenos">539</span></a>		<span class="bp">self</span><span class="o">.</span><span class="n">_live_server</span><span class="p">:</span> <span class="n">typing</span><span class="o">.</span><span class="n">Optional</span><span class="p">[</span><span class="n">subsequence</span><span class="o">.</span><span class="n">live_server</span><span class="o">.</span><span class="n">LiveServer</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="Composition.__init__-540"><a href="#Composition.__init__-540"><span class="linenos">540</span></a>		<span class="bp">self</span><span class="o">.</span><span class="n">_is_live</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span>
</span><span id="Composition.__init__-541"><a href="#Composition.__init__-541"><span class="linenos">541</span></a>		<span class="bp">self</span><span class="o">.</span><span class="n">_running_patterns</span><span class="p">:</span> <span class="n">typing</span><span class="o">.</span><span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">typing</span><span class="o">.</span><span class="n">Any</span><span class="p">]</span> <span class="o">=</span> <span class="p">{}</span>
</span><span id="Composition.__init__-542"><a href="#Composition.__init__-542"><span class="linenos">542</span></a>		<span class="bp">self</span><span class="o">.</span><span class="n">_input_device</span><span class="p">:</span> <span class="n">typing</span><span class="o">.</span><span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="Composition.__init__-543"><a href="#Composition.__init__-543"><span class="linenos">543</span></a>		<span class="bp">self</span><span class="o">.</span><span class="n">_clock_follow</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span>
</span><span id="Composition.__init__-544"><a href="#Composition.__init__-544"><span class="linenos">544</span></a>		<span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">:</span> <span class="n">typing</span><span class="o">.</span><span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">typing</span><span class="o">.</span><span class="n">Any</span><span class="p">]</span> <span class="o">=</span> <span class="p">{}</span>
</span></pre></div>


            <div class="docstring"><p>Initialize a composition with MIDI output device, tempo, and optional key.</p>

<p>Parameters:
        output_device: MIDI output device name (e.g., <code>"Device Name:Port 1 16:0"</code>).
                When omitted, auto-discovers available devices - uses the only device
                if one is found, or prompts the user to choose if multiple are available.
        bpm: Tempo in beats per minute (default 120)
        key: Root key name (e.g., <code>"C"</code>, <code>"F#"</code>, <code>"Bb"</code>). Required if using <code><a href="#Composition.harmony">harmony()</a></code>.
        seed: Optional random seed. When set, all randomness (chord progressions, form
                transitions, pattern builder functions) becomes deterministic and repeatable.</p>

<p>Example:</p>

<pre><code>    <div class="pdoc-code codehilite">
<pre><span></span><code><span class="n">composition</span> <span class="o">=</span> <span class="n"><a href="#Composition">subsequence.Composition</a></span><span class="p">(</span>
        <span class="n">output_device</span><span class="o">=</span><span class="s2">&quot;Scarlett 2i4 USB:Scarlett 2i4 USB MIDI 1 16:0&quot;</span><span class="p">,</span>
        <span class="n">bpm</span><span class="o">=</span><span class="mi">125</span><span class="p">,</span>
        <span class="n">key</span><span class="o">=</span><span class="s2">&quot;E&quot;</span><span class="p">,</span>
        <span class="n">seed</span><span class="o">=</span><span class="mi">42</span>
<span class="p">)</span>
</code></pre>
</div>
</code></pre>
</div>


                            </div>
                            <div id="Composition.output_device" class="classattr">
                                <div class="attr variable">
            <span class="name">output_device</span>

        
    </div>
    <a class="headerlink" href="#Composition.output_device"></a>
    
    

                            </div>
                            <div id="Composition.bpm" class="classattr">
                                <div class="attr variable">
            <span class="name">bpm</span>

        
    </div>
    <a class="headerlink" href="#Composition.bpm"></a>
    
    

                            </div>
                            <div id="Composition.key" class="classattr">
                                <div class="attr variable">
            <span class="name">key</span>

        
    </div>
    <a class="headerlink" href="#Composition.key"></a>
    
    

                            </div>
                            <div id="Composition.data" class="classattr">
                                <div class="attr variable">
            <span class="name">data</span><span class="annotation">: Dict[str, Any]</span>

        
    </div>
    <a class="headerlink" href="#Composition.data"></a>
    
    

                            </div>
                            <div id="Composition.harmony" class="classattr">
                                        <input id="Composition.harmony-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">harmony</span><span class="signature pdoc-code multiline">(<span class="param">	<span class="bp">self</span>,</span><span class="param">	<span class="n">style</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n"><a href="subsequence/chord_graphs.html#ChordGraph">subsequence.chord_graphs.ChordGraph</a></span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;functional_major&#39;</span>,</span><span class="param">	<span class="n">cycle_beats</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">4</span>,</span><span class="param">	<span class="n">dominant_7th</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span>,</span><span class="param">	<span class="n">gravity</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">1.0</span>,</span><span class="param">	<span class="n">minor_weight</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">0.0</span>,</span><span class="param">	<span class="n">reschedule_lookahead</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mi">1</span></span><span class="return-annotation">) -> <span class="kc">None</span>:</span></span>

                <label class="view-source-button" for="Composition.harmony-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#Composition.harmony"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="Composition.harmony-546"><a href="#Composition.harmony-546"><span class="linenos">546</span></a>	<span class="k">def</span><span class="w"> </span><span class="nf">harmony</span> <span class="p">(</span>
</span><span id="Composition.harmony-547"><a href="#Composition.harmony-547"><span class="linenos">547</span></a>		<span class="bp">self</span><span class="p">,</span>
</span><span id="Composition.harmony-548"><a href="#Composition.harmony-548"><span class="linenos">548</span></a>		<span class="n">style</span><span class="p">:</span> <span class="n">typing</span><span class="o">.</span><span class="n">Union</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">subsequence</span><span class="o">.</span><span class="n">chord_graphs</span><span class="o">.</span><span class="n">ChordGraph</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;functional_major&quot;</span><span class="p">,</span>
</span><span id="Composition.harmony-549"><a href="#Composition.harmony-549"><span class="linenos">549</span></a>		<span class="n">cycle_beats</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">4</span><span class="p">,</span>
</span><span id="Composition.harmony-550"><a href="#Composition.harmony-550"><span class="linenos">550</span></a>		<span class="n">dominant_7th</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
</span><span id="Composition.harmony-551"><a href="#Composition.harmony-551"><span class="linenos">551</span></a>		<span class="n">gravity</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">1.0</span><span class="p">,</span>
</span><span id="Composition.harmony-552"><a href="#Composition.harmony-552"><span class="linenos">552</span></a>		<span class="n">minor_weight</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">0.0</span><span class="p">,</span>
</span><span id="Composition.harmony-553"><a href="#Composition.harmony-553"><span class="linenos">553</span></a>		<span class="n">reschedule_lookahead</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mi">1</span>
</span><span id="Composition.harmony-554"><a href="#Composition.harmony-554"><span class="linenos">554</span></a>	<span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="Composition.harmony-555"><a href="#Composition.harmony-555"><span class="linenos">555</span></a>
</span><span id="Composition.harmony-556"><a href="#Composition.harmony-556"><span class="linenos">556</span></a><span class="w">		</span><span class="sd">&quot;&quot;&quot;Configure the harmonic state and chord change cycle for this composition.</span>
</span><span id="Composition.harmony-557"><a href="#Composition.harmony-557"><span class="linenos">557</span></a>
</span><span id="Composition.harmony-558"><a href="#Composition.harmony-558"><span class="linenos">558</span></a><span class="sd">		Parameters:</span>
</span><span id="Composition.harmony-559"><a href="#Composition.harmony-559"><span class="linenos">559</span></a><span class="sd">			style: Chord graph style - `&quot;diatonic_major&quot;`, `&quot;turnaround&quot;`, `&quot;dark_minor&quot;`, or a `ChordGraph` instance</span>
</span><span id="Composition.harmony-560"><a href="#Composition.harmony-560"><span class="linenos">560</span></a><span class="sd">			cycle_beats: How often chords change (in beats, default 4)</span>
</span><span id="Composition.harmony-561"><a href="#Composition.harmony-561"><span class="linenos">561</span></a><span class="sd">			dominant_7th: Include dominant seventh chords (default True)</span>
</span><span id="Composition.harmony-562"><a href="#Composition.harmony-562"><span class="linenos">562</span></a><span class="sd">			gravity: Key gravity blend 0.0-1.0 (default 1.0). Higher values favor chords closer to the tonic.</span>
</span><span id="Composition.harmony-563"><a href="#Composition.harmony-563"><span class="linenos">563</span></a><span class="sd">			minor_weight: Weight for minor vs major turnarounds 0.0-1.0 (default 0.0, turnaround graph only)</span>
</span><span id="Composition.harmony-564"><a href="#Composition.harmony-564"><span class="linenos">564</span></a><span class="sd">			reschedule_lookahead: Reschedule lookahead in beats (default 1)</span>
</span><span id="Composition.harmony-565"><a href="#Composition.harmony-565"><span class="linenos">565</span></a>
</span><span id="Composition.harmony-566"><a href="#Composition.harmony-566"><span class="linenos">566</span></a><span class="sd">		Example:</span>
</span><span id="Composition.harmony-567"><a href="#Composition.harmony-567"><span class="linenos">567</span></a><span class="sd">			```python</span>
</span><span id="Composition.harmony-568"><a href="#Composition.harmony-568"><span class="linenos">568</span></a><span class="sd">			composition.harmony(</span>
</span><span id="Composition.harmony-569"><a href="#Composition.harmony-569"><span class="linenos">569</span></a><span class="sd">				style=&quot;dark_minor&quot;,</span>
</span><span id="Composition.harmony-570"><a href="#Composition.harmony-570"><span class="linenos">570</span></a><span class="sd">				cycle_beats=4,</span>
</span><span id="Composition.harmony-571"><a href="#Composition.harmony-571"><span class="linenos">571</span></a><span class="sd">				dominant_7th=True,</span>
</span><span id="Composition.harmony-572"><a href="#Composition.harmony-572"><span class="linenos">572</span></a><span class="sd">				gravity=0.8</span>
</span><span id="Composition.harmony-573"><a href="#Composition.harmony-573"><span class="linenos">573</span></a><span class="sd">			)</span>
</span><span id="Composition.harmony-574"><a href="#Composition.harmony-574"><span class="linenos">574</span></a><span class="sd">			```</span>
</span><span id="Composition.harmony-575"><a href="#Composition.harmony-575"><span class="linenos">575</span></a><span class="sd">		&quot;&quot;&quot;</span>
</span><span id="Composition.harmony-576"><a href="#Composition.harmony-576"><span class="linenos">576</span></a>
</span><span id="Composition.harmony-577"><a href="#Composition.harmony-577"><span class="linenos">577</span></a>		<span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">key</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="Composition.harmony-578"><a href="#Composition.harmony-578"><span class="linenos">578</span></a>			<span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Cannot configure harmony without a key - set key in the Composition constructor&quot;</span><span class="p">)</span>
</span><span id="Composition.harmony-579"><a href="#Composition.harmony-579"><span class="linenos">579</span></a>
</span><span id="Composition.harmony-580"><a href="#Composition.harmony-580"><span class="linenos">580</span></a>		<span class="bp">self</span><span class="o">.</span><span class="n">_harmonic_state</span> <span class="o">=</span> <span class="n">subsequence</span><span class="o">.</span><span class="n">harmonic_state</span><span class="o">.</span><span class="n">HarmonicState</span><span class="p">(</span>
</span><span id="Composition.harmony-581"><a href="#Composition.harmony-581"><span class="linenos">581</span></a>			<span class="n">key_name</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">key</span><span class="p">,</span>
</span><span id="Composition.harmony-582"><a href="#Composition.harmony-582"><span class="linenos">582</span></a>			<span class="n">graph_style</span> <span class="o">=</span> <span class="n">style</span><span class="p">,</span>
</span><span id="Composition.harmony-583"><a href="#Composition.harmony-583"><span class="linenos">583</span></a>			<span class="n">include_dominant_7th</span> <span class="o">=</span> <span class="n">dominant_7th</span><span class="p">,</span>
</span><span id="Composition.harmony-584"><a href="#Composition.harmony-584"><span class="linenos">584</span></a>			<span class="n">key_gravity_blend</span> <span class="o">=</span> <span class="n">gravity</span><span class="p">,</span>
</span><span id="Composition.harmony-585"><a href="#Composition.harmony-585"><span class="linenos">585</span></a>			<span class="n">minor_turnaround_weight</span> <span class="o">=</span> <span class="n">minor_weight</span>
</span><span id="Composition.harmony-586"><a href="#Composition.harmony-586"><span class="linenos">586</span></a>		<span class="p">)</span>
</span><span id="Composition.harmony-587"><a href="#Composition.harmony-587"><span class="linenos">587</span></a>
</span><span id="Composition.harmony-588"><a href="#Composition.harmony-588"><span class="linenos">588</span></a>		<span class="bp">self</span><span class="o">.</span><span class="n">_harmony_cycle_beats</span> <span class="o">=</span> <span class="n">cycle_beats</span>
</span><span id="Composition.harmony-589"><a href="#Composition.harmony-589"><span class="linenos">589</span></a>		<span class="bp">self</span><span class="o">.</span><span class="n">_harmony_reschedule_lookahead</span> <span class="o">=</span> <span class="n">reschedule_lookahead</span>
</span></pre></div>


            <div class="docstring"><p>Configure the harmonic state and chord change cycle for this composition.</p>

<p>Parameters:
        style: Chord graph style - <code>"diatonic_major"</code>, <code>"turnaround"</code>, <code>"dark_minor"</code>, or a <code>ChordGraph</code> instance
        cycle_beats: How often chords change (in beats, default 4)
        dominant_7th: Include dominant seventh chords (default True)
        gravity: Key gravity blend 0.0-1.0 (default 1.0). Higher values favor chords closer to the tonic.
        minor_weight: Weight for minor vs major turnarounds 0.0-1.0 (default 0.0, turnaround graph only)
        reschedule_lookahead: Reschedule lookahead in beats (default 1)</p>

<p>Example:</p>

<pre><code>    <div class="pdoc-code codehilite">
<pre><span></span><code><span class="n">composition</span><span class="o">.</span><span class="n">harmony</span><span class="p">(</span>
        <span class="n">style</span><span class="o">=</span><span class="s2">&quot;dark_minor&quot;</span><span class="p">,</span>
        <span class="n">cycle_beats</span><span class="o">=</span><span class="mi">4</span><span class="p">,</span>
        <span class="n">dominant_7th</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
        <span class="n">gravity</span><span class="o">=</span><span class="mf">0.8</span>
<span class="p">)</span>
</code></pre>
</div>
</code></pre>
</div>


                            </div>
                            <div id="Composition.on_event" class="classattr">
                                        <input id="Composition.on_event-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">on_event</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span>, </span><span class="param"><span class="n">event_name</span><span class="p">:</span> <span class="nb">str</span>, </span><span class="param"><span class="n">callback</span><span class="p">:</span> <span class="n">Callable</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="n">Any</span><span class="p">]</span></span><span class="return-annotation">) -> <span class="kc">None</span>:</span></span>

                <label class="view-source-button" for="Composition.on_event-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#Composition.on_event"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="Composition.on_event-591"><a href="#Composition.on_event-591"><span class="linenos">591</span></a>	<span class="k">def</span><span class="w"> </span><span class="nf">on_event</span> <span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">event_name</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">callback</span><span class="p">:</span> <span class="n">typing</span><span class="o">.</span><span class="n">Callable</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="n">typing</span><span class="o">.</span><span class="n">Any</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="Composition.on_event-592"><a href="#Composition.on_event-592"><span class="linenos">592</span></a>
</span><span id="Composition.on_event-593"><a href="#Composition.on_event-593"><span class="linenos">593</span></a><span class="w">		</span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="Composition.on_event-594"><a href="#Composition.on_event-594"><span class="linenos">594</span></a><span class="sd">		Register a callback for a sequencer event (e.g., &quot;bar&quot;, &quot;start&quot;, &quot;stop&quot;).</span>
</span><span id="Composition.on_event-595"><a href="#Composition.on_event-595"><span class="linenos">595</span></a><span class="sd">		&quot;&quot;&quot;</span>
</span><span id="Composition.on_event-596"><a href="#Composition.on_event-596"><span class="linenos">596</span></a>
</span><span id="Composition.on_event-597"><a href="#Composition.on_event-597"><span class="linenos">597</span></a>		<span class="bp">self</span><span class="o">.</span><span class="n">_sequencer</span><span class="o">.</span><span class="n">on_event</span><span class="p">(</span><span class="n">event_name</span><span class="p">,</span> <span class="n">callback</span><span class="p">)</span>
</span></pre></div>


            <div class="docstring"><p>Register a callback for a sequencer event (e.g., "bar", "start", "stop").</p>
</div>


                            </div>
                            <div id="Composition.seed" class="classattr">
                                        <input id="Composition.seed-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">seed</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span>, </span><span class="param"><span class="n">value</span><span class="p">:</span> <span class="nb">int</span></span><span class="return-annotation">) -> <span class="kc">None</span>:</span></span>

                <label class="view-source-button" for="Composition.seed-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#Composition.seed"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="Composition.seed-599"><a href="#Composition.seed-599"><span class="linenos">599</span></a>	<span class="k">def</span><span class="w"> </span><span class="nf">seed</span> <span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">:</span> <span class="nb">int</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="Composition.seed-600"><a href="#Composition.seed-600"><span class="linenos">600</span></a>
</span><span id="Composition.seed-601"><a href="#Composition.seed-601"><span class="linenos">601</span></a><span class="w">		</span><span class="sd">&quot;&quot;&quot;Set a random seed for deterministic, repeatable output.</span>
</span><span id="Composition.seed-602"><a href="#Composition.seed-602"><span class="linenos">602</span></a>
</span><span id="Composition.seed-603"><a href="#Composition.seed-603"><span class="linenos">603</span></a><span class="sd">		When set, all randomness - chord progressions, form transitions, and pattern</span>
</span><span id="Composition.seed-604"><a href="#Composition.seed-604"><span class="linenos">604</span></a><span class="sd">		builder functions - produces the same results on every run. Pattern builders</span>
</span><span id="Composition.seed-605"><a href="#Composition.seed-605"><span class="linenos">605</span></a><span class="sd">		access the seeded RNG via ``p.rng``.</span>
</span><span id="Composition.seed-606"><a href="#Composition.seed-606"><span class="linenos">606</span></a>
</span><span id="Composition.seed-607"><a href="#Composition.seed-607"><span class="linenos">607</span></a><span class="sd">		Parameters:</span>
</span><span id="Composition.seed-608"><a href="#Composition.seed-608"><span class="linenos">608</span></a><span class="sd">			value: Integer seed value</span>
</span><span id="Composition.seed-609"><a href="#Composition.seed-609"><span class="linenos">609</span></a>
</span><span id="Composition.seed-610"><a href="#Composition.seed-610"><span class="linenos">610</span></a><span class="sd">		Example:</span>
</span><span id="Composition.seed-611"><a href="#Composition.seed-611"><span class="linenos">611</span></a><span class="sd">			```python</span>
</span><span id="Composition.seed-612"><a href="#Composition.seed-612"><span class="linenos">612</span></a><span class="sd">			composition.seed(42)</span>
</span><span id="Composition.seed-613"><a href="#Composition.seed-613"><span class="linenos">613</span></a><span class="sd">			composition.play()  # same output every time</span>
</span><span id="Composition.seed-614"><a href="#Composition.seed-614"><span class="linenos">614</span></a><span class="sd">			```</span>
</span><span id="Composition.seed-615"><a href="#Composition.seed-615"><span class="linenos">615</span></a><span class="sd">		&quot;&quot;&quot;</span>
</span><span id="Composition.seed-616"><a href="#Composition.seed-616"><span class="linenos">616</span></a>
</span><span id="Composition.seed-617"><a href="#Composition.seed-617"><span class="linenos">617</span></a>		<span class="bp">self</span><span class="o">.</span><span class="n">_seed</span> <span class="o">=</span> <span class="n">value</span>
</span></pre></div>


            <div class="docstring"><p>Set a random seed for deterministic, repeatable output.</p>

<p>When set, all randomness - chord progressions, form transitions, and pattern
builder functions - produces the same results on every run. Pattern builders
access the seeded RNG via <code>p.rng</code>.</p>

<p>Parameters:
        value: Integer seed value</p>

<p>Example:</p>

<pre><code>    <div class="pdoc-code codehilite">
<pre><span></span><code><span class="n">composition</span><span class="o">.</span><span class="n">seed</span><span class="p">(</span><span class="mi">42</span><span class="p">)</span>
<span class="n">composition</span><span class="o">.</span><span class="n">play</span><span class="p">()</span>  <span class="c1"># same output every time</span>
</code></pre>
</div>
</code></pre>
</div>


                            </div>
                            <div id="Composition.display" class="classattr">
                                        <input id="Composition.display-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">display</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span>, </span><span class="param"><span class="n">enabled</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span></span><span class="return-annotation">) -> <span class="kc">None</span>:</span></span>

                <label class="view-source-button" for="Composition.display-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#Composition.display"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="Composition.display-619"><a href="#Composition.display-619"><span class="linenos">619</span></a>	<span class="k">def</span><span class="w"> </span><span class="nf">display</span> <span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">enabled</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="Composition.display-620"><a href="#Composition.display-620"><span class="linenos">620</span></a>
</span><span id="Composition.display-621"><a href="#Composition.display-621"><span class="linenos">621</span></a><span class="w">		</span><span class="sd">&quot;&quot;&quot;Enable or disable the live terminal status line.</span>
</span><span id="Composition.display-622"><a href="#Composition.display-622"><span class="linenos">622</span></a>
</span><span id="Composition.display-623"><a href="#Composition.display-623"><span class="linenos">623</span></a><span class="sd">		When enabled, a persistent status line shows the current bar, section,</span>
</span><span id="Composition.display-624"><a href="#Composition.display-624"><span class="linenos">624</span></a><span class="sd">		chord, BPM, and key. Log messages scroll above it without disruption.</span>
</span><span id="Composition.display-625"><a href="#Composition.display-625"><span class="linenos">625</span></a>
</span><span id="Composition.display-626"><a href="#Composition.display-626"><span class="linenos">626</span></a><span class="sd">		Parameters:</span>
</span><span id="Composition.display-627"><a href="#Composition.display-627"><span class="linenos">627</span></a><span class="sd">			enabled: Turn the display on (True) or off (False)</span>
</span><span id="Composition.display-628"><a href="#Composition.display-628"><span class="linenos">628</span></a>
</span><span id="Composition.display-629"><a href="#Composition.display-629"><span class="linenos">629</span></a><span class="sd">		Example:</span>
</span><span id="Composition.display-630"><a href="#Composition.display-630"><span class="linenos">630</span></a><span class="sd">			```python</span>
</span><span id="Composition.display-631"><a href="#Composition.display-631"><span class="linenos">631</span></a><span class="sd">			composition.display()  # enable before play()</span>
</span><span id="Composition.display-632"><a href="#Composition.display-632"><span class="linenos">632</span></a><span class="sd">			composition.play()</span>
</span><span id="Composition.display-633"><a href="#Composition.display-633"><span class="linenos">633</span></a><span class="sd">			```</span>
</span><span id="Composition.display-634"><a href="#Composition.display-634"><span class="linenos">634</span></a><span class="sd">		&quot;&quot;&quot;</span>
</span><span id="Composition.display-635"><a href="#Composition.display-635"><span class="linenos">635</span></a>
</span><span id="Composition.display-636"><a href="#Composition.display-636"><span class="linenos">636</span></a>		<span class="k">if</span> <span class="n">enabled</span><span class="p">:</span>
</span><span id="Composition.display-637"><a href="#Composition.display-637"><span class="linenos">637</span></a>			<span class="bp">self</span><span class="o">.</span><span class="n">_display</span> <span class="o">=</span> <span class="n">subsequence</span><span class="o">.</span><span class="n">display</span><span class="o">.</span><span class="n">Display</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
</span><span id="Composition.display-638"><a href="#Composition.display-638"><span class="linenos">638</span></a>		<span class="k">else</span><span class="p">:</span>
</span><span id="Composition.display-639"><a href="#Composition.display-639"><span class="linenos">639</span></a>			<span class="bp">self</span><span class="o">.</span><span class="n">_display</span> <span class="o">=</span> <span class="kc">None</span>
</span></pre></div>


            <div class="docstring"><p>Enable or disable the live terminal status line.</p>

<p>When enabled, a persistent status line shows the current bar, section,
chord, BPM, and key. Log messages scroll above it without disruption.</p>

<p>Parameters:
        enabled: Turn the display on (True) or off (False)</p>

<p>Example:</p>

<pre><code>    <div class="pdoc-code codehilite">
<pre><span></span><code><span class="n">composition</span><span class="o">.</span><span class="n">display</span><span class="p">()</span>  <span class="c1"># enable before play()</span>
<span class="n">composition</span><span class="o">.</span><span class="n">play</span><span class="p">()</span>
</code></pre>
</div>
</code></pre>
</div>


                            </div>
                            <div id="Composition.midi_input" class="classattr">
                                        <input id="Composition.midi_input-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">midi_input</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span>, </span><span class="param"><span class="n">device</span><span class="p">:</span> <span class="nb">str</span>, </span><span class="param"><span class="n">clock_follow</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span></span><span class="return-annotation">) -> <span class="kc">None</span>:</span></span>

                <label class="view-source-button" for="Composition.midi_input-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#Composition.midi_input"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="Composition.midi_input-641"><a href="#Composition.midi_input-641"><span class="linenos">641</span></a>	<span class="k">def</span><span class="w"> </span><span class="nf">midi_input</span> <span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">device</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">clock_follow</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="Composition.midi_input-642"><a href="#Composition.midi_input-642"><span class="linenos">642</span></a>
</span><span id="Composition.midi_input-643"><a href="#Composition.midi_input-643"><span class="linenos">643</span></a><span class="w">		</span><span class="sd">&quot;&quot;&quot;Configure MIDI input for receiving external clock and transport control.</span>
</span><span id="Composition.midi_input-644"><a href="#Composition.midi_input-644"><span class="linenos">644</span></a>
</span><span id="Composition.midi_input-645"><a href="#Composition.midi_input-645"><span class="linenos">645</span></a><span class="sd">		When ``clock_follow`` is enabled, the sequencer follows incoming MIDI</span>
</span><span id="Composition.midi_input-646"><a href="#Composition.midi_input-646"><span class="linenos">646</span></a><span class="sd">		clock ticks instead of using its own internal clock. The BPM set in</span>
</span><span id="Composition.midi_input-647"><a href="#Composition.midi_input-647"><span class="linenos">647</span></a><span class="sd">		the constructor is ignored - tempo is determined by the external</span>
</span><span id="Composition.midi_input-648"><a href="#Composition.midi_input-648"><span class="linenos">648</span></a><span class="sd">		source. MIDI start, stop, and continue messages control transport.</span>
</span><span id="Composition.midi_input-649"><a href="#Composition.midi_input-649"><span class="linenos">649</span></a>
</span><span id="Composition.midi_input-650"><a href="#Composition.midi_input-650"><span class="linenos">650</span></a><span class="sd">		When ``clock_follow`` is disabled (default), the input port is opened</span>
</span><span id="Composition.midi_input-651"><a href="#Composition.midi_input-651"><span class="linenos">651</span></a><span class="sd">		but no clock or transport messages are acted on.</span>
</span><span id="Composition.midi_input-652"><a href="#Composition.midi_input-652"><span class="linenos">652</span></a>
</span><span id="Composition.midi_input-653"><a href="#Composition.midi_input-653"><span class="linenos">653</span></a><span class="sd">		Parameters:</span>
</span><span id="Composition.midi_input-654"><a href="#Composition.midi_input-654"><span class="linenos">654</span></a><span class="sd">			device: MIDI input device name (e.g., ``&quot;Device Name:Port 1 16:0&quot;``)</span>
</span><span id="Composition.midi_input-655"><a href="#Composition.midi_input-655"><span class="linenos">655</span></a><span class="sd">			clock_follow: Follow external MIDI clock for timing (default False)</span>
</span><span id="Composition.midi_input-656"><a href="#Composition.midi_input-656"><span class="linenos">656</span></a>
</span><span id="Composition.midi_input-657"><a href="#Composition.midi_input-657"><span class="linenos">657</span></a><span class="sd">		Example:</span>
</span><span id="Composition.midi_input-658"><a href="#Composition.midi_input-658"><span class="linenos">658</span></a><span class="sd">			```python</span>
</span><span id="Composition.midi_input-659"><a href="#Composition.midi_input-659"><span class="linenos">659</span></a><span class="sd">			composition.midi_input(</span>
</span><span id="Composition.midi_input-660"><a href="#Composition.midi_input-660"><span class="linenos">660</span></a><span class="sd">				device=&quot;Scarlett 2i4 USB:Scarlett 2i4 USB MIDI 1 16:0&quot;,</span>
</span><span id="Composition.midi_input-661"><a href="#Composition.midi_input-661"><span class="linenos">661</span></a><span class="sd">				clock_follow=True</span>
</span><span id="Composition.midi_input-662"><a href="#Composition.midi_input-662"><span class="linenos">662</span></a><span class="sd">			)</span>
</span><span id="Composition.midi_input-663"><a href="#Composition.midi_input-663"><span class="linenos">663</span></a><span class="sd">			```</span>
</span><span id="Composition.midi_input-664"><a href="#Composition.midi_input-664"><span class="linenos">664</span></a><span class="sd">		&quot;&quot;&quot;</span>
</span><span id="Composition.midi_input-665"><a href="#Composition.midi_input-665"><span class="linenos">665</span></a>
</span><span id="Composition.midi_input-666"><a href="#Composition.midi_input-666"><span class="linenos">666</span></a>		<span class="bp">self</span><span class="o">.</span><span class="n">_input_device</span> <span class="o">=</span> <span class="n">device</span>
</span><span id="Composition.midi_input-667"><a href="#Composition.midi_input-667"><span class="linenos">667</span></a>		<span class="bp">self</span><span class="o">.</span><span class="n">_clock_follow</span> <span class="o">=</span> <span class="n">clock_follow</span>
</span></pre></div>


            <div class="docstring"><p>Configure MIDI input for receiving external clock and transport control.</p>

<p>When <code>clock_follow</code> is enabled, the sequencer follows incoming MIDI
clock ticks instead of using its own internal clock. The BPM set in
the constructor is ignored - tempo is determined by the external
source. MIDI start, stop, and continue messages control transport.</p>

<p>When <code>clock_follow</code> is disabled (default), the input port is opened
but no clock or transport messages are acted on.</p>

<p>Parameters:
        device: MIDI input device name (e.g., <code>"Device Name:Port 1 16:0"</code>)
        clock_follow: Follow external MIDI clock for timing (default False)</p>

<p>Example:</p>

<pre><code>    <div class="pdoc-code codehilite">
<pre><span></span><code><span class="n">composition</span><span class="o">.</span><span class="n">midi_input</span><span class="p">(</span>
        <span class="n">device</span><span class="o">=</span><span class="s2">&quot;Scarlett 2i4 USB:Scarlett 2i4 USB MIDI 1 16:0&quot;</span><span class="p">,</span>
        <span class="n">clock_follow</span><span class="o">=</span><span class="kc">True</span>
<span class="p">)</span>
</code></pre>
</div>
</code></pre>
</div>


                            </div>
                            <div id="Composition.live" class="classattr">
                                        <input id="Composition.live-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">live</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span>, </span><span class="param"><span class="n">port</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">5555</span></span><span class="return-annotation">) -> <span class="kc">None</span>:</span></span>

                <label class="view-source-button" for="Composition.live-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#Composition.live"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="Composition.live-669"><a href="#Composition.live-669"><span class="linenos">669</span></a>	<span class="k">def</span><span class="w"> </span><span class="nf">live</span> <span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">port</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">5555</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="Composition.live-670"><a href="#Composition.live-670"><span class="linenos">670</span></a>
</span><span id="Composition.live-671"><a href="#Composition.live-671"><span class="linenos">671</span></a><span class="w">		</span><span class="sd">&quot;&quot;&quot;Enable the live coding server for runtime interaction.</span>
</span><span id="Composition.live-672"><a href="#Composition.live-672"><span class="linenos">672</span></a>
</span><span id="Composition.live-673"><a href="#Composition.live-673"><span class="linenos">673</span></a><span class="sd">		Starts a TCP eval server on ``localhost`` that accepts Python code from</span>
</span><span id="Composition.live-674"><a href="#Composition.live-674"><span class="linenos">674</span></a><span class="sd">		any source - the bundled REPL client, an editor plugin, or a raw socket.</span>
</span><span id="Composition.live-675"><a href="#Composition.live-675"><span class="linenos">675</span></a><span class="sd">		The server launches when ``play()`` is called and stops when playback ends.</span>
</span><span id="Composition.live-676"><a href="#Composition.live-676"><span class="linenos">676</span></a>
</span><span id="Composition.live-677"><a href="#Composition.live-677"><span class="linenos">677</span></a><span class="sd">		Parameters:</span>
</span><span id="Composition.live-678"><a href="#Composition.live-678"><span class="linenos">678</span></a><span class="sd">			port: TCP port to listen on (default 5555)</span>
</span><span id="Composition.live-679"><a href="#Composition.live-679"><span class="linenos">679</span></a>
</span><span id="Composition.live-680"><a href="#Composition.live-680"><span class="linenos">680</span></a><span class="sd">		Example:</span>
</span><span id="Composition.live-681"><a href="#Composition.live-681"><span class="linenos">681</span></a><span class="sd">			```python</span>
</span><span id="Composition.live-682"><a href="#Composition.live-682"><span class="linenos">682</span></a><span class="sd">			composition.live()      # enable before play()</span>
</span><span id="Composition.live-683"><a href="#Composition.live-683"><span class="linenos">683</span></a><span class="sd">			composition.display()</span>
</span><span id="Composition.live-684"><a href="#Composition.live-684"><span class="linenos">684</span></a><span class="sd">			composition.play()</span>
</span><span id="Composition.live-685"><a href="#Composition.live-685"><span class="linenos">685</span></a><span class="sd">			```</span>
</span><span id="Composition.live-686"><a href="#Composition.live-686"><span class="linenos">686</span></a>
</span><span id="Composition.live-687"><a href="#Composition.live-687"><span class="linenos">687</span></a><span class="sd">			Then in another terminal::</span>
</span><span id="Composition.live-688"><a href="#Composition.live-688"><span class="linenos">688</span></a>
</span><span id="Composition.live-689"><a href="#Composition.live-689"><span class="linenos">689</span></a><span class="sd">				python -m subsequence.live_client</span>
</span><span id="Composition.live-690"><a href="#Composition.live-690"><span class="linenos">690</span></a><span class="sd">		&quot;&quot;&quot;</span>
</span><span id="Composition.live-691"><a href="#Composition.live-691"><span class="linenos">691</span></a>
</span><span id="Composition.live-692"><a href="#Composition.live-692"><span class="linenos">692</span></a>		<span class="bp">self</span><span class="o">.</span><span class="n">_live_server</span> <span class="o">=</span> <span class="n">subsequence</span><span class="o">.</span><span class="n">live_server</span><span class="o">.</span><span class="n">LiveServer</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">port</span><span class="o">=</span><span class="n">port</span><span class="p">)</span>
</span><span id="Composition.live-693"><a href="#Composition.live-693"><span class="linenos">693</span></a>		<span class="bp">self</span><span class="o">.</span><span class="n">_is_live</span> <span class="o">=</span> <span class="kc">True</span>
</span></pre></div>


            <div class="docstring"><p>Enable the live coding server for runtime interaction.</p>

<p>Starts a TCP eval server on <code>localhost</code> that accepts Python code from
any source - the bundled REPL client, an editor plugin, or a raw socket.
The server launches when <code><a href="#Composition.play">play()</a></code> is called and stops when playback ends.</p>

<p>Parameters:
        port: TCP port to listen on (default 5555)</p>

<p>Example:</p>

<pre><code>    <div class="pdoc-code codehilite">
<pre><span></span><code><span class="n">composition</span><span class="o">.</span><span class="n">live</span><span class="p">()</span>      <span class="c1"># enable before play()</span>
<span class="n">composition</span><span class="o">.</span><span class="n">display</span><span class="p">()</span>
<span class="n">composition</span><span class="o">.</span><span class="n">play</span><span class="p">()</span>
</code></pre>
</div>



    Then in another terminal::

            python -m <a href="subsequence/live_client.html">subsequence.live_client</a>
</code></pre>
</div>


                            </div>
                            <div id="Composition.set_bpm" class="classattr">
                                        <input id="Composition.set_bpm-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">set_bpm</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span>, </span><span class="param"><span class="n">bpm</span><span class="p">:</span> <span class="nb">int</span></span><span class="return-annotation">) -> <span class="kc">None</span>:</span></span>

                <label class="view-source-button" for="Composition.set_bpm-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#Composition.set_bpm"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="Composition.set_bpm-695"><a href="#Composition.set_bpm-695"><span class="linenos">695</span></a>	<span class="k">def</span><span class="w"> </span><span class="nf">set_bpm</span> <span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">bpm</span><span class="p">:</span> <span class="nb">int</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="Composition.set_bpm-696"><a href="#Composition.set_bpm-696"><span class="linenos">696</span></a>
</span><span id="Composition.set_bpm-697"><a href="#Composition.set_bpm-697"><span class="linenos">697</span></a><span class="w">		</span><span class="sd">&quot;&quot;&quot;Change the tempo while the composition is playing.</span>
</span><span id="Composition.set_bpm-698"><a href="#Composition.set_bpm-698"><span class="linenos">698</span></a>
</span><span id="Composition.set_bpm-699"><a href="#Composition.set_bpm-699"><span class="linenos">699</span></a><span class="sd">		When ``clock_follow`` is enabled, BPM is controlled by the external clock</span>
</span><span id="Composition.set_bpm-700"><a href="#Composition.set_bpm-700"><span class="linenos">700</span></a><span class="sd">		source and this method has no effect.</span>
</span><span id="Composition.set_bpm-701"><a href="#Composition.set_bpm-701"><span class="linenos">701</span></a>
</span><span id="Composition.set_bpm-702"><a href="#Composition.set_bpm-702"><span class="linenos">702</span></a><span class="sd">		Parameters:</span>
</span><span id="Composition.set_bpm-703"><a href="#Composition.set_bpm-703"><span class="linenos">703</span></a><span class="sd">			bpm: New tempo in beats per minute</span>
</span><span id="Composition.set_bpm-704"><a href="#Composition.set_bpm-704"><span class="linenos">704</span></a>
</span><span id="Composition.set_bpm-705"><a href="#Composition.set_bpm-705"><span class="linenos">705</span></a><span class="sd">		Example:</span>
</span><span id="Composition.set_bpm-706"><a href="#Composition.set_bpm-706"><span class="linenos">706</span></a><span class="sd">			```python</span>
</span><span id="Composition.set_bpm-707"><a href="#Composition.set_bpm-707"><span class="linenos">707</span></a><span class="sd">			composition.set_bpm(140)</span>
</span><span id="Composition.set_bpm-708"><a href="#Composition.set_bpm-708"><span class="linenos">708</span></a><span class="sd">			```</span>
</span><span id="Composition.set_bpm-709"><a href="#Composition.set_bpm-709"><span class="linenos">709</span></a><span class="sd">		&quot;&quot;&quot;</span>
</span><span id="Composition.set_bpm-710"><a href="#Composition.set_bpm-710"><span class="linenos">710</span></a>
</span><span id="Composition.set_bpm-711"><a href="#Composition.set_bpm-711"><span class="linenos">711</span></a>		<span class="bp">self</span><span class="o">.</span><span class="n">_sequencer</span><span class="o">.</span><span class="n">set_bpm</span><span class="p">(</span><span class="n">bpm</span><span class="p">)</span>
</span><span id="Composition.set_bpm-712"><a href="#Composition.set_bpm-712"><span class="linenos">712</span></a>
</span><span id="Composition.set_bpm-713"><a href="#Composition.set_bpm-713"><span class="linenos">713</span></a>		<span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">_clock_follow</span><span class="p">:</span>
</span><span id="Composition.set_bpm-714"><a href="#Composition.set_bpm-714"><span class="linenos">714</span></a>			<span class="bp">self</span><span class="o">.</span><span class="n">bpm</span> <span class="o">=</span> <span class="n">bpm</span>
</span></pre></div>


            <div class="docstring"><p>Change the tempo while the composition is playing.</p>

<p>When <code>clock_follow</code> is enabled, BPM is controlled by the external clock
source and this method has no effect.</p>

<p>Parameters:
        bpm: New tempo in beats per minute</p>

<p>Example:</p>

<pre><code>    <div class="pdoc-code codehilite">
<pre><span></span><code><span class="n">composition</span><span class="o">.</span><span class="n">set_bpm</span><span class="p">(</span><span class="mi">140</span><span class="p">)</span>
</code></pre>
</div>
</code></pre>
</div>


                            </div>
                            <div id="Composition.live_info" class="classattr">
                                        <input id="Composition.live_info-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">live_info</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span></span><span class="return-annotation">) -> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]</span>:</span></span>

                <label class="view-source-button" for="Composition.live_info-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#Composition.live_info"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="Composition.live_info-716"><a href="#Composition.live_info-716"><span class="linenos">716</span></a>	<span class="k">def</span><span class="w"> </span><span class="nf">live_info</span> <span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">typing</span><span class="o">.</span><span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">typing</span><span class="o">.</span><span class="n">Any</span><span class="p">]:</span>
</span><span id="Composition.live_info-717"><a href="#Composition.live_info-717"><span class="linenos">717</span></a>
</span><span id="Composition.live_info-718"><a href="#Composition.live_info-718"><span class="linenos">718</span></a><span class="w">		</span><span class="sd">&quot;&quot;&quot;Return a snapshot of the running composition state.</span>
</span><span id="Composition.live_info-719"><a href="#Composition.live_info-719"><span class="linenos">719</span></a>
</span><span id="Composition.live_info-720"><a href="#Composition.live_info-720"><span class="linenos">720</span></a><span class="sd">		Returns a dict with: ``bpm``, ``key``, ``bar``, ``section``, ``chord``,</span>
</span><span id="Composition.live_info-721"><a href="#Composition.live_info-721"><span class="linenos">721</span></a><span class="sd">		``patterns`` (list of dicts), and ``data``.</span>
</span><span id="Composition.live_info-722"><a href="#Composition.live_info-722"><span class="linenos">722</span></a>
</span><span id="Composition.live_info-723"><a href="#Composition.live_info-723"><span class="linenos">723</span></a><span class="sd">		Example:</span>
</span><span id="Composition.live_info-724"><a href="#Composition.live_info-724"><span class="linenos">724</span></a><span class="sd">			```python</span>
</span><span id="Composition.live_info-725"><a href="#Composition.live_info-725"><span class="linenos">725</span></a><span class="sd">			info = composition.live_info()</span>
</span><span id="Composition.live_info-726"><a href="#Composition.live_info-726"><span class="linenos">726</span></a><span class="sd">			print(info[&quot;bpm&quot;], info[&quot;chord&quot;])</span>
</span><span id="Composition.live_info-727"><a href="#Composition.live_info-727"><span class="linenos">727</span></a><span class="sd">			```</span>
</span><span id="Composition.live_info-728"><a href="#Composition.live_info-728"><span class="linenos">728</span></a><span class="sd">		&quot;&quot;&quot;</span>
</span><span id="Composition.live_info-729"><a href="#Composition.live_info-729"><span class="linenos">729</span></a>
</span><span id="Composition.live_info-730"><a href="#Composition.live_info-730"><span class="linenos">730</span></a>		<span class="n">section_info</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="Composition.live_info-731"><a href="#Composition.live_info-731"><span class="linenos">731</span></a>		<span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_form_state</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="Composition.live_info-732"><a href="#Composition.live_info-732"><span class="linenos">732</span></a>			<span class="n">section</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_form_state</span><span class="o">.</span><span class="n">get_section_info</span><span class="p">()</span>
</span><span id="Composition.live_info-733"><a href="#Composition.live_info-733"><span class="linenos">733</span></a>			<span class="k">if</span> <span class="n">section</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="Composition.live_info-734"><a href="#Composition.live_info-734"><span class="linenos">734</span></a>				<span class="n">section_info</span> <span class="o">=</span> <span class="p">{</span>
</span><span id="Composition.live_info-735"><a href="#Composition.live_info-735"><span class="linenos">735</span></a>					<span class="s2">&quot;name&quot;</span><span class="p">:</span> <span class="n">section</span><span class="o">.</span><span class="n">name</span><span class="p">,</span>
</span><span id="Composition.live_info-736"><a href="#Composition.live_info-736"><span class="linenos">736</span></a>					<span class="s2">&quot;bar&quot;</span><span class="p">:</span> <span class="n">section</span><span class="o">.</span><span class="n">bar</span><span class="p">,</span>
</span><span id="Composition.live_info-737"><a href="#Composition.live_info-737"><span class="linenos">737</span></a>					<span class="s2">&quot;bars&quot;</span><span class="p">:</span> <span class="n">section</span><span class="o">.</span><span class="n">bars</span><span class="p">,</span>
</span><span id="Composition.live_info-738"><a href="#Composition.live_info-738"><span class="linenos">738</span></a>					<span class="s2">&quot;progress&quot;</span><span class="p">:</span> <span class="n">section</span><span class="o">.</span><span class="n">progress</span>
</span><span id="Composition.live_info-739"><a href="#Composition.live_info-739"><span class="linenos">739</span></a>				<span class="p">}</span>
</span><span id="Composition.live_info-740"><a href="#Composition.live_info-740"><span class="linenos">740</span></a>
</span><span id="Composition.live_info-741"><a href="#Composition.live_info-741"><span class="linenos">741</span></a>		<span class="n">chord_name</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="Composition.live_info-742"><a href="#Composition.live_info-742"><span class="linenos">742</span></a>		<span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_harmonic_state</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="Composition.live_info-743"><a href="#Composition.live_info-743"><span class="linenos">743</span></a>			<span class="n">chord</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_harmonic_state</span><span class="o">.</span><span class="n">get_current_chord</span><span class="p">()</span>
</span><span id="Composition.live_info-744"><a href="#Composition.live_info-744"><span class="linenos">744</span></a>			<span class="k">if</span> <span class="n">chord</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="Composition.live_info-745"><a href="#Composition.live_info-745"><span class="linenos">745</span></a>				<span class="n">chord_name</span> <span class="o">=</span> <span class="n">chord</span><span class="o">.</span><span class="n">name</span><span class="p">()</span>
</span><span id="Composition.live_info-746"><a href="#Composition.live_info-746"><span class="linenos">746</span></a>
</span><span id="Composition.live_info-747"><a href="#Composition.live_info-747"><span class="linenos">747</span></a>		<span class="n">pattern_list</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="Composition.live_info-748"><a href="#Composition.live_info-748"><span class="linenos">748</span></a>		<span class="k">for</span> <span class="n">name</span><span class="p">,</span> <span class="n">pat</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_running_patterns</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
</span><span id="Composition.live_info-749"><a href="#Composition.live_info-749"><span class="linenos">749</span></a>			<span class="n">pattern_list</span><span class="o">.</span><span class="n">append</span><span class="p">({</span>
</span><span id="Composition.live_info-750"><a href="#Composition.live_info-750"><span class="linenos">750</span></a>				<span class="s2">&quot;name&quot;</span><span class="p">:</span> <span class="n">name</span><span class="p">,</span>
</span><span id="Composition.live_info-751"><a href="#Composition.live_info-751"><span class="linenos">751</span></a>				<span class="s2">&quot;channel&quot;</span><span class="p">:</span> <span class="n">pat</span><span class="o">.</span><span class="n">channel</span><span class="p">,</span>
</span><span id="Composition.live_info-752"><a href="#Composition.live_info-752"><span class="linenos">752</span></a>				<span class="s2">&quot;length&quot;</span><span class="p">:</span> <span class="n">pat</span><span class="o">.</span><span class="n">length</span><span class="p">,</span>
</span><span id="Composition.live_info-753"><a href="#Composition.live_info-753"><span class="linenos">753</span></a>				<span class="s2">&quot;cycle&quot;</span><span class="p">:</span> <span class="n">pat</span><span class="o">.</span><span class="n">_cycle_count</span><span class="p">,</span>
</span><span id="Composition.live_info-754"><a href="#Composition.live_info-754"><span class="linenos">754</span></a>				<span class="s2">&quot;muted&quot;</span><span class="p">:</span> <span class="n">pat</span><span class="o">.</span><span class="n">_muted</span>
</span><span id="Composition.live_info-755"><a href="#Composition.live_info-755"><span class="linenos">755</span></a>			<span class="p">})</span>
</span><span id="Composition.live_info-756"><a href="#Composition.live_info-756"><span class="linenos">756</span></a>
</span><span id="Composition.live_info-757"><a href="#Composition.live_info-757"><span class="linenos">757</span></a>		<span class="k">return</span> <span class="p">{</span>
</span><span id="Composition.live_info-758"><a href="#Composition.live_info-758"><span class="linenos">758</span></a>			<span class="s2">&quot;bpm&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">_sequencer</span><span class="o">.</span><span class="n">current_bpm</span> <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_clock_follow</span> <span class="k">else</span> <span class="bp">self</span><span class="o">.</span><span class="n">bpm</span><span class="p">,</span>
</span><span id="Composition.live_info-759"><a href="#Composition.live_info-759"><span class="linenos">759</span></a>			<span class="s2">&quot;key&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">key</span><span class="p">,</span>
</span><span id="Composition.live_info-760"><a href="#Composition.live_info-760"><span class="linenos">760</span></a>			<span class="s2">&quot;bar&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">_builder_bar</span><span class="p">,</span>
</span><span id="Composition.live_info-761"><a href="#Composition.live_info-761"><span class="linenos">761</span></a>			<span class="s2">&quot;section&quot;</span><span class="p">:</span> <span class="n">section_info</span><span class="p">,</span>
</span><span id="Composition.live_info-762"><a href="#Composition.live_info-762"><span class="linenos">762</span></a>			<span class="s2">&quot;chord&quot;</span><span class="p">:</span> <span class="n">chord_name</span><span class="p">,</span>
</span><span id="Composition.live_info-763"><a href="#Composition.live_info-763"><span class="linenos">763</span></a>			<span class="s2">&quot;patterns&quot;</span><span class="p">:</span> <span class="n">pattern_list</span><span class="p">,</span>
</span><span id="Composition.live_info-764"><a href="#Composition.live_info-764"><span class="linenos">764</span></a>			<span class="s2">&quot;input_device&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">_input_device</span><span class="p">,</span>
</span><span id="Composition.live_info-765"><a href="#Composition.live_info-765"><span class="linenos">765</span></a>			<span class="s2">&quot;clock_follow&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">_clock_follow</span><span class="p">,</span>
</span><span id="Composition.live_info-766"><a href="#Composition.live_info-766"><span class="linenos">766</span></a>			<span class="s2">&quot;data&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span>
</span><span id="Composition.live_info-767"><a href="#Composition.live_info-767"><span class="linenos">767</span></a>		<span class="p">}</span>
</span></pre></div>


            <div class="docstring"><p>Return a snapshot of the running composition state.</p>

<p>Returns a dict with: <code><a href="#Composition.bpm">bpm</a></code>, <code><a href="#Composition.key">key</a></code>, <code>bar</code>, <code>section</code>, <code>chord</code>,
<code>patterns</code> (list of dicts), and <code><a href="#Composition.data">data</a></code>.</p>

<p>Example:</p>

<pre><code>    <div class="pdoc-code codehilite">
<pre><span></span><code><span class="n">info</span> <span class="o">=</span> <span class="n">composition</span><span class="o">.</span><span class="n">live_info</span><span class="p">()</span>
<span class="nb">print</span><span class="p">(</span><span class="n">info</span><span class="p">[</span><span class="s2">&quot;bpm&quot;</span><span class="p">],</span> <span class="n">info</span><span class="p">[</span><span class="s2">&quot;chord&quot;</span><span class="p">])</span>
</code></pre>
</div>
</code></pre>
</div>


                            </div>
                            <div id="Composition.mute" class="classattr">
                                        <input id="Composition.mute-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">mute</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span>, </span><span class="param"><span class="n">name</span><span class="p">:</span> <span class="nb">str</span></span><span class="return-annotation">) -> <span class="kc">None</span>:</span></span>

                <label class="view-source-button" for="Composition.mute-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#Composition.mute"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="Composition.mute-769"><a href="#Composition.mute-769"><span class="linenos">769</span></a>	<span class="k">def</span><span class="w"> </span><span class="nf">mute</span> <span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="Composition.mute-770"><a href="#Composition.mute-770"><span class="linenos">770</span></a>
</span><span id="Composition.mute-771"><a href="#Composition.mute-771"><span class="linenos">771</span></a><span class="w">		</span><span class="sd">&quot;&quot;&quot;Mute a running pattern by name. The pattern keeps scheduling but produces no notes.</span>
</span><span id="Composition.mute-772"><a href="#Composition.mute-772"><span class="linenos">772</span></a>
</span><span id="Composition.mute-773"><a href="#Composition.mute-773"><span class="linenos">773</span></a><span class="sd">		Parameters:</span>
</span><span id="Composition.mute-774"><a href="#Composition.mute-774"><span class="linenos">774</span></a><span class="sd">			name: The function name of the pattern to mute</span>
</span><span id="Composition.mute-775"><a href="#Composition.mute-775"><span class="linenos">775</span></a>
</span><span id="Composition.mute-776"><a href="#Composition.mute-776"><span class="linenos">776</span></a><span class="sd">		Example:</span>
</span><span id="Composition.mute-777"><a href="#Composition.mute-777"><span class="linenos">777</span></a><span class="sd">			```python</span>
</span><span id="Composition.mute-778"><a href="#Composition.mute-778"><span class="linenos">778</span></a><span class="sd">			composition.mute(&quot;hats&quot;)</span>
</span><span id="Composition.mute-779"><a href="#Composition.mute-779"><span class="linenos">779</span></a><span class="sd">			```</span>
</span><span id="Composition.mute-780"><a href="#Composition.mute-780"><span class="linenos">780</span></a><span class="sd">		&quot;&quot;&quot;</span>
</span><span id="Composition.mute-781"><a href="#Composition.mute-781"><span class="linenos">781</span></a>
</span><span id="Composition.mute-782"><a href="#Composition.mute-782"><span class="linenos">782</span></a>		<span class="k">if</span> <span class="n">name</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_running_patterns</span><span class="p">:</span>
</span><span id="Composition.mute-783"><a href="#Composition.mute-783"><span class="linenos">783</span></a>			<span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Pattern &#39;</span><span class="si">{</span><span class="n">name</span><span class="si">}</span><span class="s2">&#39; not found. Available: </span><span class="si">{</span><span class="nb">list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_running_patterns</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="Composition.mute-784"><a href="#Composition.mute-784"><span class="linenos">784</span></a>
</span><span id="Composition.mute-785"><a href="#Composition.mute-785"><span class="linenos">785</span></a>		<span class="bp">self</span><span class="o">.</span><span class="n">_running_patterns</span><span class="p">[</span><span class="n">name</span><span class="p">]</span><span class="o">.</span><span class="n">_muted</span> <span class="o">=</span> <span class="kc">True</span>
</span><span id="Composition.mute-786"><a href="#Composition.mute-786"><span class="linenos">786</span></a>		<span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Muted pattern: </span><span class="si">{</span><span class="n">name</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span></pre></div>


            <div class="docstring"><p>Mute a running pattern by name. The pattern keeps scheduling but produces no notes.</p>

<p>Parameters:
        name: The function name of the pattern to mute</p>

<p>Example:</p>

<pre><code>    <div class="pdoc-code codehilite">
<pre><span></span><code><span class="n">composition</span><span class="o">.</span><span class="n">mute</span><span class="p">(</span><span class="s2">&quot;hats&quot;</span><span class="p">)</span>
</code></pre>
</div>
</code></pre>
</div>


                            </div>
                            <div id="Composition.unmute" class="classattr">
                                        <input id="Composition.unmute-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">unmute</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span>, </span><span class="param"><span class="n">name</span><span class="p">:</span> <span class="nb">str</span></span><span class="return-annotation">) -> <span class="kc">None</span>:</span></span>

                <label class="view-source-button" for="Composition.unmute-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#Composition.unmute"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="Composition.unmute-788"><a href="#Composition.unmute-788"><span class="linenos">788</span></a>	<span class="k">def</span><span class="w"> </span><span class="nf">unmute</span> <span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="Composition.unmute-789"><a href="#Composition.unmute-789"><span class="linenos">789</span></a>
</span><span id="Composition.unmute-790"><a href="#Composition.unmute-790"><span class="linenos">790</span></a><span class="w">		</span><span class="sd">&quot;&quot;&quot;Unmute a previously muted pattern.</span>
</span><span id="Composition.unmute-791"><a href="#Composition.unmute-791"><span class="linenos">791</span></a>
</span><span id="Composition.unmute-792"><a href="#Composition.unmute-792"><span class="linenos">792</span></a><span class="sd">		Parameters:</span>
</span><span id="Composition.unmute-793"><a href="#Composition.unmute-793"><span class="linenos">793</span></a><span class="sd">			name: The function name of the pattern to unmute</span>
</span><span id="Composition.unmute-794"><a href="#Composition.unmute-794"><span class="linenos">794</span></a>
</span><span id="Composition.unmute-795"><a href="#Composition.unmute-795"><span class="linenos">795</span></a><span class="sd">		Example:</span>
</span><span id="Composition.unmute-796"><a href="#Composition.unmute-796"><span class="linenos">796</span></a><span class="sd">			```python</span>
</span><span id="Composition.unmute-797"><a href="#Composition.unmute-797"><span class="linenos">797</span></a><span class="sd">			composition.unmute(&quot;hats&quot;)</span>
</span><span id="Composition.unmute-798"><a href="#Composition.unmute-798"><span class="linenos">798</span></a><span class="sd">			```</span>
</span><span id="Composition.unmute-799"><a href="#Composition.unmute-799"><span class="linenos">799</span></a><span class="sd">		&quot;&quot;&quot;</span>
</span><span id="Composition.unmute-800"><a href="#Composition.unmute-800"><span class="linenos">800</span></a>
</span><span id="Composition.unmute-801"><a href="#Composition.unmute-801"><span class="linenos">801</span></a>		<span class="k">if</span> <span class="n">name</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_running_patterns</span><span class="p">:</span>
</span><span id="Composition.unmute-802"><a href="#Composition.unmute-802"><span class="linenos">802</span></a>			<span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Pattern &#39;</span><span class="si">{</span><span class="n">name</span><span class="si">}</span><span class="s2">&#39; not found. Available: </span><span class="si">{</span><span class="nb">list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_running_patterns</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="Composition.unmute-803"><a href="#Composition.unmute-803"><span class="linenos">803</span></a>
</span><span id="Composition.unmute-804"><a href="#Composition.unmute-804"><span class="linenos">804</span></a>		<span class="bp">self</span><span class="o">.</span><span class="n">_running_patterns</span><span class="p">[</span><span class="n">name</span><span class="p">]</span><span class="o">.</span><span class="n">_muted</span> <span class="o">=</span> <span class="kc">False</span>
</span><span id="Composition.unmute-805"><a href="#Composition.unmute-805"><span class="linenos">805</span></a>		<span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Unmuted pattern: </span><span class="si">{</span><span class="n">name</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span></pre></div>


            <div class="docstring"><p>Unmute a previously muted pattern.</p>

<p>Parameters:
        name: The function name of the pattern to unmute</p>

<p>Example:</p>

<pre><code>    <div class="pdoc-code codehilite">
<pre><span></span><code><span class="n">composition</span><span class="o">.</span><span class="n">unmute</span><span class="p">(</span><span class="s2">&quot;hats&quot;</span><span class="p">)</span>
</code></pre>
</div>
</code></pre>
</div>


                            </div>
                            <div id="Composition.schedule" class="classattr">
                                        <input id="Composition.schedule-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">schedule</span><span class="signature pdoc-code multiline">(<span class="param">	<span class="bp">self</span>,</span><span class="param">	<span class="n">fn</span><span class="p">:</span> <span class="n">Callable</span>,</span><span class="param">	<span class="n">cycle_beats</span><span class="p">:</span> <span class="nb">int</span>,</span><span class="param">	<span class="n">reschedule_lookahead</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">1</span></span><span class="return-annotation">) -> <span class="kc">None</span>:</span></span>

                <label class="view-source-button" for="Composition.schedule-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#Composition.schedule"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="Composition.schedule-807"><a href="#Composition.schedule-807"><span class="linenos">807</span></a>	<span class="k">def</span><span class="w"> </span><span class="nf">schedule</span> <span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">fn</span><span class="p">:</span> <span class="n">typing</span><span class="o">.</span><span class="n">Callable</span><span class="p">,</span> <span class="n">cycle_beats</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="n">reschedule_lookahead</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">1</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="Composition.schedule-808"><a href="#Composition.schedule-808"><span class="linenos">808</span></a>
</span><span id="Composition.schedule-809"><a href="#Composition.schedule-809"><span class="linenos">809</span></a><span class="w">		</span><span class="sd">&quot;&quot;&quot;Register a function to run on a repeating beat-based cycle.</span>
</span><span id="Composition.schedule-810"><a href="#Composition.schedule-810"><span class="linenos">810</span></a>
</span><span id="Composition.schedule-811"><a href="#Composition.schedule-811"><span class="linenos">811</span></a><span class="sd">		Sync functions automatically run in a thread pool so they never block the MIDI clock.</span>
</span><span id="Composition.schedule-812"><a href="#Composition.schedule-812"><span class="linenos">812</span></a><span class="sd">		Async functions run directly on the event loop.</span>
</span><span id="Composition.schedule-813"><a href="#Composition.schedule-813"><span class="linenos">813</span></a>
</span><span id="Composition.schedule-814"><a href="#Composition.schedule-814"><span class="linenos">814</span></a><span class="sd">		Parameters:</span>
</span><span id="Composition.schedule-815"><a href="#Composition.schedule-815"><span class="linenos">815</span></a><span class="sd">			fn: Function to call on each cycle (sync or async)</span>
</span><span id="Composition.schedule-816"><a href="#Composition.schedule-816"><span class="linenos">816</span></a><span class="sd">			cycle_beats: How often to call the function (in beats)</span>
</span><span id="Composition.schedule-817"><a href="#Composition.schedule-817"><span class="linenos">817</span></a><span class="sd">			reschedule_lookahead: Reschedule lookahead in beats (default 1)</span>
</span><span id="Composition.schedule-818"><a href="#Composition.schedule-818"><span class="linenos">818</span></a>
</span><span id="Composition.schedule-819"><a href="#Composition.schedule-819"><span class="linenos">819</span></a><span class="sd">		Example:</span>
</span><span id="Composition.schedule-820"><a href="#Composition.schedule-820"><span class="linenos">820</span></a><span class="sd">			```python</span>
</span><span id="Composition.schedule-821"><a href="#Composition.schedule-821"><span class="linenos">821</span></a><span class="sd">			# Sync function (runs in thread pool automatically)</span>
</span><span id="Composition.schedule-822"><a href="#Composition.schedule-822"><span class="linenos">822</span></a><span class="sd">			def fetch_data():</span>
</span><span id="Composition.schedule-823"><a href="#Composition.schedule-823"><span class="linenos">823</span></a><span class="sd">				composition.data[&quot;value&quot;] = some_external_api()</span>
</span><span id="Composition.schedule-824"><a href="#Composition.schedule-824"><span class="linenos">824</span></a>
</span><span id="Composition.schedule-825"><a href="#Composition.schedule-825"><span class="linenos">825</span></a><span class="sd">			composition.schedule(fetch_data, cycle_beats=32)  # Every 8 bars</span>
</span><span id="Composition.schedule-826"><a href="#Composition.schedule-826"><span class="linenos">826</span></a>
</span><span id="Composition.schedule-827"><a href="#Composition.schedule-827"><span class="linenos">827</span></a><span class="sd">			# Async function (runs directly)</span>
</span><span id="Composition.schedule-828"><a href="#Composition.schedule-828"><span class="linenos">828</span></a><span class="sd">			async def async_task():</span>
</span><span id="Composition.schedule-829"><a href="#Composition.schedule-829"><span class="linenos">829</span></a><span class="sd">				composition.data[&quot;value&quot;] = await some_async_api()</span>
</span><span id="Composition.schedule-830"><a href="#Composition.schedule-830"><span class="linenos">830</span></a>
</span><span id="Composition.schedule-831"><a href="#Composition.schedule-831"><span class="linenos">831</span></a><span class="sd">			composition.schedule(async_task, cycle_beats=16)</span>
</span><span id="Composition.schedule-832"><a href="#Composition.schedule-832"><span class="linenos">832</span></a><span class="sd">			```</span>
</span><span id="Composition.schedule-833"><a href="#Composition.schedule-833"><span class="linenos">833</span></a><span class="sd">		&quot;&quot;&quot;</span>
</span><span id="Composition.schedule-834"><a href="#Composition.schedule-834"><span class="linenos">834</span></a>
</span><span id="Composition.schedule-835"><a href="#Composition.schedule-835"><span class="linenos">835</span></a>		<span class="bp">self</span><span class="o">.</span><span class="n">_pending_scheduled</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">_PendingScheduled</span><span class="p">(</span><span class="n">fn</span><span class="p">,</span> <span class="n">cycle_beats</span><span class="p">,</span> <span class="n">reschedule_lookahead</span><span class="p">))</span>
</span></pre></div>


            <div class="docstring"><p>Register a function to run on a repeating beat-based cycle.</p>

<p>Sync functions automatically run in a thread pool so they never block the MIDI clock.
Async functions run directly on the event loop.</p>

<p>Parameters:
        fn: Function to call on each cycle (sync or async)
        cycle_beats: How often to call the function (in beats)
        reschedule_lookahead: Reschedule lookahead in beats (default 1)</p>

<p>Example:</p>

<pre><code>    <div class="pdoc-code codehilite">
<pre><span></span><code><span class="c1"># Sync function (runs in thread pool automatically)</span>
<span class="k">def</span><span class="w"> </span><span class="nf">fetch_data</span><span class="p">():</span>
        <span class="n">composition</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s2">&quot;value&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">some_external_api</span><span class="p">()</span>

<span class="n">composition</span><span class="o">.</span><span class="n">schedule</span><span class="p">(</span><span class="n">fetch_data</span><span class="p">,</span> <span class="n">cycle_beats</span><span class="o">=</span><span class="mi">32</span><span class="p">)</span>  <span class="c1"># Every 8 bars</span>

<span class="c1"># Async function (runs directly)</span>
<span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">async_task</span><span class="p">():</span>
        <span class="n">composition</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s2">&quot;value&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="k">await</span> <span class="n">some_async_api</span><span class="p">()</span>

<span class="n">composition</span><span class="o">.</span><span class="n">schedule</span><span class="p">(</span><span class="n">async_task</span><span class="p">,</span> <span class="n">cycle_beats</span><span class="o">=</span><span class="mi">16</span><span class="p">)</span>
</code></pre>
</div>
</code></pre>
</div>


                            </div>
                            <div id="Composition.form" class="classattr">
                                        <input id="Composition.form-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">form</span><span class="signature pdoc-code multiline">(<span class="param">	<span class="bp">self</span>,</span><span class="param">	<span class="n">sections</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">List</span><span class="p">[</span><span class="n">Tuple</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">int</span><span class="p">]],</span> <span class="n">Iterator</span><span class="p">[</span><span class="n">Tuple</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">int</span><span class="p">]],</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Tuple</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="n">Optional</span><span class="p">[</span><span class="n">List</span><span class="p">[</span><span class="n">Tuple</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">int</span><span class="p">]]]]]]</span>,</span><span class="param">	<span class="n">loop</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span>,</span><span class="param">	<span class="n">start</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span></span><span class="return-annotation">) -> <span class="kc">None</span>:</span></span>

                <label class="view-source-button" for="Composition.form-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#Composition.form"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="Composition.form-837"><a href="#Composition.form-837"><span class="linenos">837</span></a>	<span class="k">def</span><span class="w"> </span><span class="nf">form</span> <span class="p">(</span>
</span><span id="Composition.form-838"><a href="#Composition.form-838"><span class="linenos">838</span></a>		<span class="bp">self</span><span class="p">,</span>
</span><span id="Composition.form-839"><a href="#Composition.form-839"><span class="linenos">839</span></a>		<span class="n">sections</span><span class="p">:</span> <span class="n">typing</span><span class="o">.</span><span class="n">Union</span><span class="p">[</span>
</span><span id="Composition.form-840"><a href="#Composition.form-840"><span class="linenos">840</span></a>			<span class="n">typing</span><span class="o">.</span><span class="n">List</span><span class="p">[</span><span class="n">typing</span><span class="o">.</span><span class="n">Tuple</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">int</span><span class="p">]],</span>
</span><span id="Composition.form-841"><a href="#Composition.form-841"><span class="linenos">841</span></a>			<span class="n">typing</span><span class="o">.</span><span class="n">Iterator</span><span class="p">[</span><span class="n">typing</span><span class="o">.</span><span class="n">Tuple</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">int</span><span class="p">]],</span>
</span><span id="Composition.form-842"><a href="#Composition.form-842"><span class="linenos">842</span></a>			<span class="n">typing</span><span class="o">.</span><span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">typing</span><span class="o">.</span><span class="n">Tuple</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="n">typing</span><span class="o">.</span><span class="n">Optional</span><span class="p">[</span><span class="n">typing</span><span class="o">.</span><span class="n">List</span><span class="p">[</span><span class="n">typing</span><span class="o">.</span><span class="n">Tuple</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">int</span><span class="p">]]]]]</span>
</span><span id="Composition.form-843"><a href="#Composition.form-843"><span class="linenos">843</span></a>		<span class="p">],</span>
</span><span id="Composition.form-844"><a href="#Composition.form-844"><span class="linenos">844</span></a>		<span class="n">loop</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
</span><span id="Composition.form-845"><a href="#Composition.form-845"><span class="linenos">845</span></a>		<span class="n">start</span><span class="p">:</span> <span class="n">typing</span><span class="o">.</span><span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="Composition.form-846"><a href="#Composition.form-846"><span class="linenos">846</span></a>	<span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="Composition.form-847"><a href="#Composition.form-847"><span class="linenos">847</span></a>
</span><span id="Composition.form-848"><a href="#Composition.form-848"><span class="linenos">848</span></a><span class="w">		</span><span class="sd">&quot;&quot;&quot;Define the compositional form as a sequence of sections or a weighted section graph.</span>
</span><span id="Composition.form-849"><a href="#Composition.form-849"><span class="linenos">849</span></a>
</span><span id="Composition.form-850"><a href="#Composition.form-850"><span class="linenos">850</span></a><span class="sd">		Three modes:</span>
</span><span id="Composition.form-851"><a href="#Composition.form-851"><span class="linenos">851</span></a><span class="sd">		- **Dict** (graph): Weighted section transitions. Format: `{section_name: (bars, [(next_section, weight), ...])}`</span>
</span><span id="Composition.form-852"><a href="#Composition.form-852"><span class="linenos">852</span></a><span class="sd">		- **List**: Linear sequence. With `loop=True`, cycles back to the start.</span>
</span><span id="Composition.form-853"><a href="#Composition.form-853"><span class="linenos">853</span></a><span class="sd">		- **Generator**: Yields `(name, bars)` tuples for stochastic structures.</span>
</span><span id="Composition.form-854"><a href="#Composition.form-854"><span class="linenos">854</span></a>
</span><span id="Composition.form-855"><a href="#Composition.form-855"><span class="linenos">855</span></a><span class="sd">		Parameters:</span>
</span><span id="Composition.form-856"><a href="#Composition.form-856"><span class="linenos">856</span></a><span class="sd">			sections: Dict (graph), list, or generator of `(name, bars)` tuples</span>
</span><span id="Composition.form-857"><a href="#Composition.form-857"><span class="linenos">857</span></a><span class="sd">			loop: For lists only - cycle back to start after the last section (default False)</span>
</span><span id="Composition.form-858"><a href="#Composition.form-858"><span class="linenos">858</span></a><span class="sd">			start: For dicts only - initial section name (default: first dict key)</span>
</span><span id="Composition.form-859"><a href="#Composition.form-859"><span class="linenos">859</span></a>
</span><span id="Composition.form-860"><a href="#Composition.form-860"><span class="linenos">860</span></a><span class="sd">		Example:</span>
</span><span id="Composition.form-861"><a href="#Composition.form-861"><span class="linenos">861</span></a><span class="sd">			```python</span>
</span><span id="Composition.form-862"><a href="#Composition.form-862"><span class="linenos">862</span></a><span class="sd">			# Graph-based form - intro plays once, then never returns</span>
</span><span id="Composition.form-863"><a href="#Composition.form-863"><span class="linenos">863</span></a><span class="sd">			composition.form({</span>
</span><span id="Composition.form-864"><a href="#Composition.form-864"><span class="linenos">864</span></a><span class="sd">				&quot;intro&quot;:     (4, [(&quot;verse&quot;, 1)]),</span>
</span><span id="Composition.form-865"><a href="#Composition.form-865"><span class="linenos">865</span></a><span class="sd">				&quot;verse&quot;:     (8, [(&quot;chorus&quot;, 3), (&quot;bridge&quot;, 1)]),</span>
</span><span id="Composition.form-866"><a href="#Composition.form-866"><span class="linenos">866</span></a><span class="sd">				&quot;chorus&quot;:    (8, [(&quot;breakdown&quot;, 2), (&quot;verse&quot;, 1)]),</span>
</span><span id="Composition.form-867"><a href="#Composition.form-867"><span class="linenos">867</span></a><span class="sd">				&quot;bridge&quot;:    (4, [(&quot;chorus&quot;, 1)]),</span>
</span><span id="Composition.form-868"><a href="#Composition.form-868"><span class="linenos">868</span></a><span class="sd">				&quot;breakdown&quot;: (4, [(&quot;verse&quot;, 1)]),</span>
</span><span id="Composition.form-869"><a href="#Composition.form-869"><span class="linenos">869</span></a><span class="sd">			}, start=&quot;intro&quot;)</span>
</span><span id="Composition.form-870"><a href="#Composition.form-870"><span class="linenos">870</span></a>
</span><span id="Composition.form-871"><a href="#Composition.form-871"><span class="linenos">871</span></a><span class="sd">			# List-based form with loop</span>
</span><span id="Composition.form-872"><a href="#Composition.form-872"><span class="linenos">872</span></a><span class="sd">			composition.form([(&quot;intro&quot;, 4), (&quot;verse&quot;, 8), (&quot;chorus&quot;, 8)], loop=True)</span>
</span><span id="Composition.form-873"><a href="#Composition.form-873"><span class="linenos">873</span></a>
</span><span id="Composition.form-874"><a href="#Composition.form-874"><span class="linenos">874</span></a><span class="sd">			# Generator form</span>
</span><span id="Composition.form-875"><a href="#Composition.form-875"><span class="linenos">875</span></a><span class="sd">			def my_form():</span>
</span><span id="Composition.form-876"><a href="#Composition.form-876"><span class="linenos">876</span></a><span class="sd">				yield (&quot;intro&quot;, 4)</span>
</span><span id="Composition.form-877"><a href="#Composition.form-877"><span class="linenos">877</span></a><span class="sd">				while True:</span>
</span><span id="Composition.form-878"><a href="#Composition.form-878"><span class="linenos">878</span></a><span class="sd">					yield (&quot;verse&quot;, random.choice([8, 16]))</span>
</span><span id="Composition.form-879"><a href="#Composition.form-879"><span class="linenos">879</span></a><span class="sd">					yield (&quot;chorus&quot;, 8)</span>
</span><span id="Composition.form-880"><a href="#Composition.form-880"><span class="linenos">880</span></a>
</span><span id="Composition.form-881"><a href="#Composition.form-881"><span class="linenos">881</span></a><span class="sd">			composition.form(my_form())</span>
</span><span id="Composition.form-882"><a href="#Composition.form-882"><span class="linenos">882</span></a><span class="sd">			```</span>
</span><span id="Composition.form-883"><a href="#Composition.form-883"><span class="linenos">883</span></a><span class="sd">		&quot;&quot;&quot;</span>
</span><span id="Composition.form-884"><a href="#Composition.form-884"><span class="linenos">884</span></a>
</span><span id="Composition.form-885"><a href="#Composition.form-885"><span class="linenos">885</span></a>		<span class="bp">self</span><span class="o">.</span><span class="n">_form_state</span> <span class="o">=</span> <span class="n">FormState</span><span class="p">(</span><span class="n">sections</span><span class="p">,</span> <span class="n">loop</span><span class="o">=</span><span class="n">loop</span><span class="p">,</span> <span class="n">start</span><span class="o">=</span><span class="n">start</span><span class="p">)</span>
</span></pre></div>


            <div class="docstring"><p>Define the compositional form as a sequence of sections or a weighted section graph.</p>

<p>Three modes:</p>

<ul>
<li><strong>Dict</strong> (graph): Weighted section transitions. Format: <code>{section_name: (bars, [(next_section, weight), ...])}</code></li>
<li><strong>List</strong>: Linear sequence. With <code>loop=True</code>, cycles back to the start.</li>
<li><strong>Generator</strong>: Yields <code>(name, bars)</code> tuples for stochastic structures.</li>
</ul>

<p>Parameters:
        sections: Dict (graph), list, or generator of <code>(name, bars)</code> tuples
        loop: For lists only - cycle back to start after the last section (default False)
        start: For dicts only - initial section name (default: first dict key)</p>

<p>Example:</p>

<pre><code>    <div class="pdoc-code codehilite">
<pre><span></span><code><span class="c1"># Graph-based form - intro plays once, then never returns</span>
<span class="n">composition</span><span class="o">.</span><span class="n">form</span><span class="p">({</span>
        <span class="s2">&quot;intro&quot;</span><span class="p">:</span>     <span class="p">(</span><span class="mi">4</span><span class="p">,</span> <span class="p">[(</span><span class="s2">&quot;verse&quot;</span><span class="p">,</span> <span class="mi">1</span><span class="p">)]),</span>
        <span class="s2">&quot;verse&quot;</span><span class="p">:</span>     <span class="p">(</span><span class="mi">8</span><span class="p">,</span> <span class="p">[(</span><span class="s2">&quot;chorus&quot;</span><span class="p">,</span> <span class="mi">3</span><span class="p">),</span> <span class="p">(</span><span class="s2">&quot;bridge&quot;</span><span class="p">,</span> <span class="mi">1</span><span class="p">)]),</span>
        <span class="s2">&quot;chorus&quot;</span><span class="p">:</span>    <span class="p">(</span><span class="mi">8</span><span class="p">,</span> <span class="p">[(</span><span class="s2">&quot;breakdown&quot;</span><span class="p">,</span> <span class="mi">2</span><span class="p">),</span> <span class="p">(</span><span class="s2">&quot;verse&quot;</span><span class="p">,</span> <span class="mi">1</span><span class="p">)]),</span>
        <span class="s2">&quot;bridge&quot;</span><span class="p">:</span>    <span class="p">(</span><span class="mi">4</span><span class="p">,</span> <span class="p">[(</span><span class="s2">&quot;chorus&quot;</span><span class="p">,</span> <span class="mi">1</span><span class="p">)]),</span>
        <span class="s2">&quot;breakdown&quot;</span><span class="p">:</span> <span class="p">(</span><span class="mi">4</span><span class="p">,</span> <span class="p">[(</span><span class="s2">&quot;verse&quot;</span><span class="p">,</span> <span class="mi">1</span><span class="p">)]),</span>
<span class="p">},</span> <span class="n">start</span><span class="o">=</span><span class="s2">&quot;intro&quot;</span><span class="p">)</span>

<span class="c1"># List-based form with loop</span>
<span class="n">composition</span><span class="o">.</span><span class="n">form</span><span class="p">([(</span><span class="s2">&quot;intro&quot;</span><span class="p">,</span> <span class="mi">4</span><span class="p">),</span> <span class="p">(</span><span class="s2">&quot;verse&quot;</span><span class="p">,</span> <span class="mi">8</span><span class="p">),</span> <span class="p">(</span><span class="s2">&quot;chorus&quot;</span><span class="p">,</span> <span class="mi">8</span><span class="p">)],</span> <span class="n">loop</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

<span class="c1"># Generator form</span>
<span class="k">def</span><span class="w"> </span><span class="nf">my_form</span><span class="p">():</span>
        <span class="k">yield</span> <span class="p">(</span><span class="s2">&quot;intro&quot;</span><span class="p">,</span> <span class="mi">4</span><span class="p">)</span>
        <span class="k">while</span> <span class="kc">True</span><span class="p">:</span>
                <span class="k">yield</span> <span class="p">(</span><span class="s2">&quot;verse&quot;</span><span class="p">,</span> <span class="n">random</span><span class="o">.</span><span class="n">choice</span><span class="p">([</span><span class="mi">8</span><span class="p">,</span> <span class="mi">16</span><span class="p">]))</span>
                <span class="k">yield</span> <span class="p">(</span><span class="s2">&quot;chorus&quot;</span><span class="p">,</span> <span class="mi">8</span><span class="p">)</span>

<span class="n">composition</span><span class="o">.</span><span class="n">form</span><span class="p">(</span><span class="n">my_form</span><span class="p">())</span>
</code></pre>
</div>
</code></pre>
</div>


                            </div>
                            <div id="Composition.pattern" class="classattr">
                                        <input id="Composition.pattern-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">pattern</span><span class="signature pdoc-code multiline">(<span class="param">	<span class="bp">self</span>,</span><span class="param">	<span class="n">channel</span><span class="p">:</span> <span class="nb">int</span>,</span><span class="param">	<span class="n">length</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mi">4</span>,</span><span class="param">	<span class="n">drum_note_map</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">int</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span>,</span><span class="param">	<span class="n">reschedule_lookahead</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mi">1</span>,</span><span class="param">	<span class="n">voice_leading</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span></span><span class="return-annotation">) -> <span class="n">Callable</span>:</span></span>

                <label class="view-source-button" for="Composition.pattern-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#Composition.pattern"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="Composition.pattern-887"><a href="#Composition.pattern-887"><span class="linenos">887</span></a>	<span class="k">def</span><span class="w"> </span><span class="nf">pattern</span> <span class="p">(</span>
</span><span id="Composition.pattern-888"><a href="#Composition.pattern-888"><span class="linenos">888</span></a>		<span class="bp">self</span><span class="p">,</span>
</span><span id="Composition.pattern-889"><a href="#Composition.pattern-889"><span class="linenos">889</span></a>		<span class="n">channel</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
</span><span id="Composition.pattern-890"><a href="#Composition.pattern-890"><span class="linenos">890</span></a>		<span class="n">length</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mi">4</span><span class="p">,</span>
</span><span id="Composition.pattern-891"><a href="#Composition.pattern-891"><span class="linenos">891</span></a>		<span class="n">drum_note_map</span><span class="p">:</span> <span class="n">typing</span><span class="o">.</span><span class="n">Optional</span><span class="p">[</span><span class="n">typing</span><span class="o">.</span><span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">int</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="Composition.pattern-892"><a href="#Composition.pattern-892"><span class="linenos">892</span></a>		<span class="n">reschedule_lookahead</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span>
</span><span id="Composition.pattern-893"><a href="#Composition.pattern-893"><span class="linenos">893</span></a>		<span class="n">voice_leading</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span>
</span><span id="Composition.pattern-894"><a href="#Composition.pattern-894"><span class="linenos">894</span></a>	<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">typing</span><span class="o">.</span><span class="n">Callable</span><span class="p">:</span>
</span><span id="Composition.pattern-895"><a href="#Composition.pattern-895"><span class="linenos">895</span></a>
</span><span id="Composition.pattern-896"><a href="#Composition.pattern-896"><span class="linenos">896</span></a><span class="w">		</span><span class="sd">&quot;&quot;&quot;Decorator that registers a builder function as a repeating pattern.</span>
</span><span id="Composition.pattern-897"><a href="#Composition.pattern-897"><span class="linenos">897</span></a>
</span><span id="Composition.pattern-898"><a href="#Composition.pattern-898"><span class="linenos">898</span></a><span class="sd">		The builder function receives a `PatternBuilder` (`p`) and optionally a `chord` parameter</span>
</span><span id="Composition.pattern-899"><a href="#Composition.pattern-899"><span class="linenos">899</span></a><span class="sd">		(automatically injected if present and harmony is configured).</span>
</span><span id="Composition.pattern-900"><a href="#Composition.pattern-900"><span class="linenos">900</span></a>
</span><span id="Composition.pattern-901"><a href="#Composition.pattern-901"><span class="linenos">901</span></a><span class="sd">		Parameters:</span>
</span><span id="Composition.pattern-902"><a href="#Composition.pattern-902"><span class="linenos">902</span></a><span class="sd">			channel: MIDI channel (0-15)</span>
</span><span id="Composition.pattern-903"><a href="#Composition.pattern-903"><span class="linenos">903</span></a><span class="sd">			length: Pattern length in beats (default 4)</span>
</span><span id="Composition.pattern-904"><a href="#Composition.pattern-904"><span class="linenos">904</span></a><span class="sd">			drum_note_map: Optional dict mapping string names to MIDI note numbers (e.g., `{&quot;kick&quot;: 36}`)</span>
</span><span id="Composition.pattern-905"><a href="#Composition.pattern-905"><span class="linenos">905</span></a><span class="sd">			reschedule_lookahead: Reschedule lookahead in beats (default 1)</span>
</span><span id="Composition.pattern-906"><a href="#Composition.pattern-906"><span class="linenos">906</span></a><span class="sd">			voice_leading: When True, the injected chord automatically picks the</span>
</span><span id="Composition.pattern-907"><a href="#Composition.pattern-907"><span class="linenos">907</span></a><span class="sd">				inversion closest to the previous chord so that voices move smoothly.</span>
</span><span id="Composition.pattern-908"><a href="#Composition.pattern-908"><span class="linenos">908</span></a><span class="sd">				Each pattern tracks its own voice leading state independently.</span>
</span><span id="Composition.pattern-909"><a href="#Composition.pattern-909"><span class="linenos">909</span></a>
</span><span id="Composition.pattern-910"><a href="#Composition.pattern-910"><span class="linenos">910</span></a><span class="sd">		Example:</span>
</span><span id="Composition.pattern-911"><a href="#Composition.pattern-911"><span class="linenos">911</span></a><span class="sd">			```python</span>
</span><span id="Composition.pattern-912"><a href="#Composition.pattern-912"><span class="linenos">912</span></a><span class="sd">			@composition.pattern(channel=9, length=4, drum_note_map={&quot;kick&quot;: 36, &quot;snare&quot;: 38})</span>
</span><span id="Composition.pattern-913"><a href="#Composition.pattern-913"><span class="linenos">913</span></a><span class="sd">			def drums(p):</span>
</span><span id="Composition.pattern-914"><a href="#Composition.pattern-914"><span class="linenos">914</span></a><span class="sd">				p.hit_steps(&quot;kick&quot;, [0, 4, 8, 12], velocity=127)</span>
</span><span id="Composition.pattern-915"><a href="#Composition.pattern-915"><span class="linenos">915</span></a><span class="sd">				p.hit_steps(&quot;snare&quot;, [4, 12], velocity=100)</span>
</span><span id="Composition.pattern-916"><a href="#Composition.pattern-916"><span class="linenos">916</span></a>
</span><span id="Composition.pattern-917"><a href="#Composition.pattern-917"><span class="linenos">917</span></a><span class="sd">			@composition.pattern(channel=0, length=4, voice_leading=True)</span>
</span><span id="Composition.pattern-918"><a href="#Composition.pattern-918"><span class="linenos">918</span></a><span class="sd">			def chords(p, chord):</span>
</span><span id="Composition.pattern-919"><a href="#Composition.pattern-919"><span class="linenos">919</span></a><span class="sd">				# chord is automatically injected with voice leading</span>
</span><span id="Composition.pattern-920"><a href="#Composition.pattern-920"><span class="linenos">920</span></a><span class="sd">				p.chord(chord, root=52, velocity=90, sustain=True)</span>
</span><span id="Composition.pattern-921"><a href="#Composition.pattern-921"><span class="linenos">921</span></a><span class="sd">			```</span>
</span><span id="Composition.pattern-922"><a href="#Composition.pattern-922"><span class="linenos">922</span></a><span class="sd">		&quot;&quot;&quot;</span>
</span><span id="Composition.pattern-923"><a href="#Composition.pattern-923"><span class="linenos">923</span></a>
</span><span id="Composition.pattern-924"><a href="#Composition.pattern-924"><span class="linenos">924</span></a>		<span class="k">def</span><span class="w"> </span><span class="nf">decorator</span> <span class="p">(</span><span class="n">fn</span><span class="p">:</span> <span class="n">typing</span><span class="o">.</span><span class="n">Callable</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">typing</span><span class="o">.</span><span class="n">Callable</span><span class="p">:</span>
</span><span id="Composition.pattern-925"><a href="#Composition.pattern-925"><span class="linenos">925</span></a>
</span><span id="Composition.pattern-926"><a href="#Composition.pattern-926"><span class="linenos">926</span></a><span class="w">			</span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="Composition.pattern-927"><a href="#Composition.pattern-927"><span class="linenos">927</span></a><span class="sd">			Wrap the builder function and register it as a pending pattern.</span>
</span><span id="Composition.pattern-928"><a href="#Composition.pattern-928"><span class="linenos">928</span></a><span class="sd">			During live sessions, hot-swap an existing pattern&#39;s builder instead.</span>
</span><span id="Composition.pattern-929"><a href="#Composition.pattern-929"><span class="linenos">929</span></a><span class="sd">			&quot;&quot;&quot;</span>
</span><span id="Composition.pattern-930"><a href="#Composition.pattern-930"><span class="linenos">930</span></a>
</span><span id="Composition.pattern-931"><a href="#Composition.pattern-931"><span class="linenos">931</span></a>			<span class="c1"># Hot-swap: if we&#39;re live and a pattern with this name exists, replace its builder.</span>
</span><span id="Composition.pattern-932"><a href="#Composition.pattern-932"><span class="linenos">932</span></a>			<span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_is_live</span> <span class="ow">and</span> <span class="n">fn</span><span class="o">.</span><span class="vm">__name__</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_running_patterns</span><span class="p">:</span>
</span><span id="Composition.pattern-933"><a href="#Composition.pattern-933"><span class="linenos">933</span></a>				<span class="n">running</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_running_patterns</span><span class="p">[</span><span class="n">fn</span><span class="o">.</span><span class="vm">__name__</span><span class="p">]</span>
</span><span id="Composition.pattern-934"><a href="#Composition.pattern-934"><span class="linenos">934</span></a>				<span class="n">running</span><span class="o">.</span><span class="n">_builder_fn</span> <span class="o">=</span> <span class="n">fn</span>
</span><span id="Composition.pattern-935"><a href="#Composition.pattern-935"><span class="linenos">935</span></a>				<span class="n">running</span><span class="o">.</span><span class="n">_wants_chord</span> <span class="o">=</span> <span class="n">_fn_has_parameter</span><span class="p">(</span><span class="n">fn</span><span class="p">,</span> <span class="s2">&quot;chord&quot;</span><span class="p">)</span>
</span><span id="Composition.pattern-936"><a href="#Composition.pattern-936"><span class="linenos">936</span></a>				<span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Hot-swapped pattern: </span><span class="si">{</span><span class="n">fn</span><span class="o">.</span><span class="vm">__name__</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="Composition.pattern-937"><a href="#Composition.pattern-937"><span class="linenos">937</span></a>				<span class="k">return</span> <span class="n">fn</span>
</span><span id="Composition.pattern-938"><a href="#Composition.pattern-938"><span class="linenos">938</span></a>
</span><span id="Composition.pattern-939"><a href="#Composition.pattern-939"><span class="linenos">939</span></a>			<span class="n">pending</span> <span class="o">=</span> <span class="n">_PendingPattern</span><span class="p">(</span>
</span><span id="Composition.pattern-940"><a href="#Composition.pattern-940"><span class="linenos">940</span></a>				<span class="n">builder_fn</span> <span class="o">=</span> <span class="n">fn</span><span class="p">,</span>
</span><span id="Composition.pattern-941"><a href="#Composition.pattern-941"><span class="linenos">941</span></a>				<span class="n">channel</span> <span class="o">=</span> <span class="n">channel</span><span class="p">,</span>
</span><span id="Composition.pattern-942"><a href="#Composition.pattern-942"><span class="linenos">942</span></a>				<span class="n">length</span> <span class="o">=</span> <span class="n">length</span><span class="p">,</span>
</span><span id="Composition.pattern-943"><a href="#Composition.pattern-943"><span class="linenos">943</span></a>				<span class="n">drum_note_map</span> <span class="o">=</span> <span class="n">drum_note_map</span><span class="p">,</span>
</span><span id="Composition.pattern-944"><a href="#Composition.pattern-944"><span class="linenos">944</span></a>				<span class="n">reschedule_lookahead</span> <span class="o">=</span> <span class="n">reschedule_lookahead</span><span class="p">,</span>
</span><span id="Composition.pattern-945"><a href="#Composition.pattern-945"><span class="linenos">945</span></a>				<span class="n">voice_leading</span> <span class="o">=</span> <span class="n">voice_leading</span>
</span><span id="Composition.pattern-946"><a href="#Composition.pattern-946"><span class="linenos">946</span></a>			<span class="p">)</span>
</span><span id="Composition.pattern-947"><a href="#Composition.pattern-947"><span class="linenos">947</span></a>
</span><span id="Composition.pattern-948"><a href="#Composition.pattern-948"><span class="linenos">948</span></a>			<span class="bp">self</span><span class="o">.</span><span class="n">_pending_patterns</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">pending</span><span class="p">)</span>
</span><span id="Composition.pattern-949"><a href="#Composition.pattern-949"><span class="linenos">949</span></a>
</span><span id="Composition.pattern-950"><a href="#Composition.pattern-950"><span class="linenos">950</span></a>			<span class="k">return</span> <span class="n">fn</span>
</span><span id="Composition.pattern-951"><a href="#Composition.pattern-951"><span class="linenos">951</span></a>
</span><span id="Composition.pattern-952"><a href="#Composition.pattern-952"><span class="linenos">952</span></a>		<span class="k">return</span> <span class="n">decorator</span>
</span></pre></div>


            <div class="docstring"><p>Decorator that registers a builder function as a repeating pattern.</p>

<p>The builder function receives a <code>PatternBuilder</code> (<code>p</code>) and optionally a <code>chord</code> parameter
(automatically injected if present and harmony is configured).</p>

<p>Parameters:
        channel: MIDI channel (0-15)
        length: Pattern length in beats (default 4)
        drum_note_map: Optional dict mapping string names to MIDI note numbers (e.g., <code>{"kick": 36}</code>)
        reschedule_lookahead: Reschedule lookahead in beats (default 1)
        voice_leading: When True, the injected chord automatically picks the
                inversion closest to the previous chord so that voices move smoothly.
                Each pattern tracks its own voice leading state independently.</p>

<p>Example:</p>

<pre><code>    <div class="pdoc-code codehilite">
<pre><span></span><code><span class="nd">@composition</span><span class="o">.</span><span class="n">pattern</span><span class="p">(</span><span class="n">channel</span><span class="o">=</span><span class="mi">9</span><span class="p">,</span> <span class="n">length</span><span class="o">=</span><span class="mi">4</span><span class="p">,</span> <span class="n">drum_note_map</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;kick&quot;</span><span class="p">:</span> <span class="mi">36</span><span class="p">,</span> <span class="s2">&quot;snare&quot;</span><span class="p">:</span> <span class="mi">38</span><span class="p">})</span>
<span class="k">def</span><span class="w"> </span><span class="nf">drums</span><span class="p">(</span><span class="n">p</span><span class="p">):</span>
        <span class="n">p</span><span class="o">.</span><span class="n">hit_steps</span><span class="p">(</span><span class="s2">&quot;kick&quot;</span><span class="p">,</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">8</span><span class="p">,</span> <span class="mi">12</span><span class="p">],</span> <span class="n">velocity</span><span class="o">=</span><span class="mi">127</span><span class="p">)</span>
        <span class="n">p</span><span class="o">.</span><span class="n">hit_steps</span><span class="p">(</span><span class="s2">&quot;snare&quot;</span><span class="p">,</span> <span class="p">[</span><span class="mi">4</span><span class="p">,</span> <span class="mi">12</span><span class="p">],</span> <span class="n">velocity</span><span class="o">=</span><span class="mi">100</span><span class="p">)</span>

<span class="nd">@composition</span><span class="o">.</span><span class="n">pattern</span><span class="p">(</span><span class="n">channel</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">length</span><span class="o">=</span><span class="mi">4</span><span class="p">,</span> <span class="n">voice_leading</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="k">def</span><span class="w"> </span><span class="nf">chords</span><span class="p">(</span><span class="n">p</span><span class="p">,</span> <span class="n">chord</span><span class="p">):</span>
        <span class="c1"># chord is automatically injected with voice leading</span>
        <span class="n">p</span><span class="o">.</span><span class="n">chord</span><span class="p">(</span><span class="n">chord</span><span class="p">,</span> <span class="n">root</span><span class="o">=</span><span class="mi">52</span><span class="p">,</span> <span class="n">velocity</span><span class="o">=</span><span class="mi">90</span><span class="p">,</span> <span class="n">sustain</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</code></pre>
</div>
</code></pre>
</div>


                            </div>
                            <div id="Composition.layer" class="classattr">
                                        <input id="Composition.layer-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">layer</span><span class="signature pdoc-code multiline">(<span class="param">	<span class="bp">self</span>,</span><span class="param">	<span class="o">*</span><span class="n">builder_fns</span><span class="p">:</span> <span class="n">Callable</span>,</span><span class="param">	<span class="n">channel</span><span class="p">:</span> <span class="nb">int</span>,</span><span class="param">	<span class="n">length</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mi">4</span>,</span><span class="param">	<span class="n">drum_note_map</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">int</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span>,</span><span class="param">	<span class="n">reschedule_lookahead</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mi">1</span>,</span><span class="param">	<span class="n">voice_leading</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span></span><span class="return-annotation">) -> <span class="kc">None</span>:</span></span>

                <label class="view-source-button" for="Composition.layer-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#Composition.layer"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="Composition.layer-954"><a href="#Composition.layer-954"><span class="linenos"> 954</span></a>	<span class="k">def</span><span class="w"> </span><span class="nf">layer</span> <span class="p">(</span>
</span><span id="Composition.layer-955"><a href="#Composition.layer-955"><span class="linenos"> 955</span></a>		<span class="bp">self</span><span class="p">,</span>
</span><span id="Composition.layer-956"><a href="#Composition.layer-956"><span class="linenos"> 956</span></a>		<span class="o">*</span><span class="n">builder_fns</span><span class="p">:</span> <span class="n">typing</span><span class="o">.</span><span class="n">Callable</span><span class="p">,</span>
</span><span id="Composition.layer-957"><a href="#Composition.layer-957"><span class="linenos"> 957</span></a>		<span class="n">channel</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
</span><span id="Composition.layer-958"><a href="#Composition.layer-958"><span class="linenos"> 958</span></a>		<span class="n">length</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mi">4</span><span class="p">,</span>
</span><span id="Composition.layer-959"><a href="#Composition.layer-959"><span class="linenos"> 959</span></a>		<span class="n">drum_note_map</span><span class="p">:</span> <span class="n">typing</span><span class="o">.</span><span class="n">Optional</span><span class="p">[</span><span class="n">typing</span><span class="o">.</span><span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">int</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="Composition.layer-960"><a href="#Composition.layer-960"><span class="linenos"> 960</span></a>		<span class="n">reschedule_lookahead</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span>
</span><span id="Composition.layer-961"><a href="#Composition.layer-961"><span class="linenos"> 961</span></a>		<span class="n">voice_leading</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span>
</span><span id="Composition.layer-962"><a href="#Composition.layer-962"><span class="linenos"> 962</span></a>	<span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="Composition.layer-963"><a href="#Composition.layer-963"><span class="linenos"> 963</span></a>
</span><span id="Composition.layer-964"><a href="#Composition.layer-964"><span class="linenos"> 964</span></a><span class="w">		</span><span class="sd">&quot;&quot;&quot;Register multiple builder functions as a single layered pattern.</span>
</span><span id="Composition.layer-965"><a href="#Composition.layer-965"><span class="linenos"> 965</span></a>
</span><span id="Composition.layer-966"><a href="#Composition.layer-966"><span class="linenos"> 966</span></a><span class="sd">		Each builder function runs sequentially on the same PatternBuilder, so their notes</span>
</span><span id="Composition.layer-967"><a href="#Composition.layer-967"><span class="linenos"> 967</span></a><span class="sd">		merge into one pattern. This is useful for composing reusable rhythm or melody</span>
</span><span id="Composition.layer-968"><a href="#Composition.layer-968"><span class="linenos"> 968</span></a><span class="sd">		fragments without creating separate MIDI patterns.</span>
</span><span id="Composition.layer-969"><a href="#Composition.layer-969"><span class="linenos"> 969</span></a>
</span><span id="Composition.layer-970"><a href="#Composition.layer-970"><span class="linenos"> 970</span></a><span class="sd">		Transforms like ``dropout()`` or ``swing()`` called in any builder affect the</span>
</span><span id="Composition.layer-971"><a href="#Composition.layer-971"><span class="linenos"> 971</span></a><span class="sd">		combined result. If you need transforms to apply to only one layer, use separate</span>
</span><span id="Composition.layer-972"><a href="#Composition.layer-972"><span class="linenos"> 972</span></a><span class="sd">		patterns instead.</span>
</span><span id="Composition.layer-973"><a href="#Composition.layer-973"><span class="linenos"> 973</span></a>
</span><span id="Composition.layer-974"><a href="#Composition.layer-974"><span class="linenos"> 974</span></a><span class="sd">		Parameters:</span>
</span><span id="Composition.layer-975"><a href="#Composition.layer-975"><span class="linenos"> 975</span></a><span class="sd">			*builder_fns: Two or more builder functions (each takes a PatternBuilder, and optionally a chord)</span>
</span><span id="Composition.layer-976"><a href="#Composition.layer-976"><span class="linenos"> 976</span></a><span class="sd">			channel: MIDI channel (0-15)</span>
</span><span id="Composition.layer-977"><a href="#Composition.layer-977"><span class="linenos"> 977</span></a><span class="sd">			length: Pattern length in beats (default 4)</span>
</span><span id="Composition.layer-978"><a href="#Composition.layer-978"><span class="linenos"> 978</span></a><span class="sd">			drum_note_map: Optional dict mapping string names to MIDI note numbers</span>
</span><span id="Composition.layer-979"><a href="#Composition.layer-979"><span class="linenos"> 979</span></a><span class="sd">			reschedule_lookahead: Reschedule lookahead in beats (default 1)</span>
</span><span id="Composition.layer-980"><a href="#Composition.layer-980"><span class="linenos"> 980</span></a>
</span><span id="Composition.layer-981"><a href="#Composition.layer-981"><span class="linenos"> 981</span></a><span class="sd">		Example:</span>
</span><span id="Composition.layer-982"><a href="#Composition.layer-982"><span class="linenos"> 982</span></a><span class="sd">			```python</span>
</span><span id="Composition.layer-983"><a href="#Composition.layer-983"><span class="linenos"> 983</span></a><span class="sd">			def kick (p):</span>
</span><span id="Composition.layer-984"><a href="#Composition.layer-984"><span class="linenos"> 984</span></a><span class="sd">				p.hit_steps(&quot;kick&quot;, [0, 4, 8, 12], velocity=127)</span>
</span><span id="Composition.layer-985"><a href="#Composition.layer-985"><span class="linenos"> 985</span></a>
</span><span id="Composition.layer-986"><a href="#Composition.layer-986"><span class="linenos"> 986</span></a><span class="sd">			def hats (p):</span>
</span><span id="Composition.layer-987"><a href="#Composition.layer-987"><span class="linenos"> 987</span></a><span class="sd">				p.hit_steps(&quot;hh_closed&quot;, list(range(16)), velocity=80)</span>
</span><span id="Composition.layer-988"><a href="#Composition.layer-988"><span class="linenos"> 988</span></a><span class="sd">				p.velocity_shape(low=60, high=100)</span>
</span><span id="Composition.layer-989"><a href="#Composition.layer-989"><span class="linenos"> 989</span></a>
</span><span id="Composition.layer-990"><a href="#Composition.layer-990"><span class="linenos"> 990</span></a><span class="sd">			composition.layer(kick, hats, channel=9, length=4, drum_note_map=DRUM_NOTE_MAP)</span>
</span><span id="Composition.layer-991"><a href="#Composition.layer-991"><span class="linenos"> 991</span></a><span class="sd">			```</span>
</span><span id="Composition.layer-992"><a href="#Composition.layer-992"><span class="linenos"> 992</span></a><span class="sd">		&quot;&quot;&quot;</span>
</span><span id="Composition.layer-993"><a href="#Composition.layer-993"><span class="linenos"> 993</span></a>
</span><span id="Composition.layer-994"><a href="#Composition.layer-994"><span class="linenos"> 994</span></a>		<span class="n">wants_chord</span> <span class="o">=</span> <span class="nb">any</span><span class="p">(</span><span class="n">_fn_has_parameter</span><span class="p">(</span><span class="n">fn</span><span class="p">,</span> <span class="s2">&quot;chord&quot;</span><span class="p">)</span> <span class="k">for</span> <span class="n">fn</span> <span class="ow">in</span> <span class="n">builder_fns</span><span class="p">)</span>
</span><span id="Composition.layer-995"><a href="#Composition.layer-995"><span class="linenos"> 995</span></a>
</span><span id="Composition.layer-996"><a href="#Composition.layer-996"><span class="linenos"> 996</span></a>		<span class="k">if</span> <span class="n">wants_chord</span><span class="p">:</span>
</span><span id="Composition.layer-997"><a href="#Composition.layer-997"><span class="linenos"> 997</span></a>
</span><span id="Composition.layer-998"><a href="#Composition.layer-998"><span class="linenos"> 998</span></a>			<span class="k">def</span><span class="w"> </span><span class="nf">merged_builder</span> <span class="p">(</span><span class="n">p</span><span class="p">:</span> <span class="n">subsequence</span><span class="o">.</span><span class="n">pattern_builder</span><span class="o">.</span><span class="n">PatternBuilder</span><span class="p">,</span> <span class="n">chord</span><span class="p">:</span> <span class="n">_InjectedChord</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="Composition.layer-999"><a href="#Composition.layer-999"><span class="linenos"> 999</span></a>
</span><span id="Composition.layer-1000"><a href="#Composition.layer-1000"><span class="linenos">1000</span></a>				<span class="k">for</span> <span class="n">fn</span> <span class="ow">in</span> <span class="n">builder_fns</span><span class="p">:</span>
</span><span id="Composition.layer-1001"><a href="#Composition.layer-1001"><span class="linenos">1001</span></a>					<span class="k">if</span> <span class="n">_fn_has_parameter</span><span class="p">(</span><span class="n">fn</span><span class="p">,</span> <span class="s2">&quot;chord&quot;</span><span class="p">):</span>
</span><span id="Composition.layer-1002"><a href="#Composition.layer-1002"><span class="linenos">1002</span></a>						<span class="n">fn</span><span class="p">(</span><span class="n">p</span><span class="p">,</span> <span class="n">chord</span><span class="p">)</span>
</span><span id="Composition.layer-1003"><a href="#Composition.layer-1003"><span class="linenos">1003</span></a>					<span class="k">else</span><span class="p">:</span>
</span><span id="Composition.layer-1004"><a href="#Composition.layer-1004"><span class="linenos">1004</span></a>						<span class="n">fn</span><span class="p">(</span><span class="n">p</span><span class="p">)</span>
</span><span id="Composition.layer-1005"><a href="#Composition.layer-1005"><span class="linenos">1005</span></a>
</span><span id="Composition.layer-1006"><a href="#Composition.layer-1006"><span class="linenos">1006</span></a>		<span class="k">else</span><span class="p">:</span>
</span><span id="Composition.layer-1007"><a href="#Composition.layer-1007"><span class="linenos">1007</span></a>
</span><span id="Composition.layer-1008"><a href="#Composition.layer-1008"><span class="linenos">1008</span></a>			<span class="k">def</span><span class="w"> </span><span class="nf">merged_builder</span> <span class="p">(</span><span class="n">p</span><span class="p">:</span> <span class="n">subsequence</span><span class="o">.</span><span class="n">pattern_builder</span><span class="o">.</span><span class="n">PatternBuilder</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>  <span class="c1"># type: ignore[misc]</span>
</span><span id="Composition.layer-1009"><a href="#Composition.layer-1009"><span class="linenos">1009</span></a>
</span><span id="Composition.layer-1010"><a href="#Composition.layer-1010"><span class="linenos">1010</span></a>				<span class="k">for</span> <span class="n">fn</span> <span class="ow">in</span> <span class="n">builder_fns</span><span class="p">:</span>
</span><span id="Composition.layer-1011"><a href="#Composition.layer-1011"><span class="linenos">1011</span></a>					<span class="n">fn</span><span class="p">(</span><span class="n">p</span><span class="p">)</span>
</span><span id="Composition.layer-1012"><a href="#Composition.layer-1012"><span class="linenos">1012</span></a>
</span><span id="Composition.layer-1013"><a href="#Composition.layer-1013"><span class="linenos">1013</span></a>		<span class="n">pending</span> <span class="o">=</span> <span class="n">_PendingPattern</span><span class="p">(</span>
</span><span id="Composition.layer-1014"><a href="#Composition.layer-1014"><span class="linenos">1014</span></a>			<span class="n">builder_fn</span> <span class="o">=</span> <span class="n">merged_builder</span><span class="p">,</span>
</span><span id="Composition.layer-1015"><a href="#Composition.layer-1015"><span class="linenos">1015</span></a>			<span class="n">channel</span> <span class="o">=</span> <span class="n">channel</span><span class="p">,</span>
</span><span id="Composition.layer-1016"><a href="#Composition.layer-1016"><span class="linenos">1016</span></a>			<span class="n">length</span> <span class="o">=</span> <span class="n">length</span><span class="p">,</span>
</span><span id="Composition.layer-1017"><a href="#Composition.layer-1017"><span class="linenos">1017</span></a>			<span class="n">drum_note_map</span> <span class="o">=</span> <span class="n">drum_note_map</span><span class="p">,</span>
</span><span id="Composition.layer-1018"><a href="#Composition.layer-1018"><span class="linenos">1018</span></a>			<span class="n">reschedule_lookahead</span> <span class="o">=</span> <span class="n">reschedule_lookahead</span><span class="p">,</span>
</span><span id="Composition.layer-1019"><a href="#Composition.layer-1019"><span class="linenos">1019</span></a>			<span class="n">voice_leading</span> <span class="o">=</span> <span class="n">voice_leading</span>
</span><span id="Composition.layer-1020"><a href="#Composition.layer-1020"><span class="linenos">1020</span></a>		<span class="p">)</span>
</span><span id="Composition.layer-1021"><a href="#Composition.layer-1021"><span class="linenos">1021</span></a>
</span><span id="Composition.layer-1022"><a href="#Composition.layer-1022"><span class="linenos">1022</span></a>		<span class="bp">self</span><span class="o">.</span><span class="n">_pending_patterns</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">pending</span><span class="p">)</span>
</span></pre></div>


            <div class="docstring"><p>Register multiple builder functions as a single layered pattern.</p>

<p>Each builder function runs sequentially on the same PatternBuilder, so their notes
merge into one pattern. This is useful for composing reusable rhythm or melody
fragments without creating separate MIDI patterns.</p>

<p>Transforms like <code>dropout()</code> or <code>swing()</code> called in any builder affect the
combined result. If you need transforms to apply to only one layer, use separate
patterns instead.</p>

<p>Parameters:
        *builder_fns: Two or more builder functions (each takes a PatternBuilder, and optionally a chord)
        channel: MIDI channel (0-15)
        length: Pattern length in beats (default 4)
        drum_note_map: Optional dict mapping string names to MIDI note numbers
        reschedule_lookahead: Reschedule lookahead in beats (default 1)</p>

<p>Example:</p>

<pre><code>    <div class="pdoc-code codehilite">
<pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">kick</span> <span class="p">(</span><span class="n">p</span><span class="p">):</span>
        <span class="n">p</span><span class="o">.</span><span class="n">hit_steps</span><span class="p">(</span><span class="s2">&quot;kick&quot;</span><span class="p">,</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">8</span><span class="p">,</span> <span class="mi">12</span><span class="p">],</span> <span class="n">velocity</span><span class="o">=</span><span class="mi">127</span><span class="p">)</span>

<span class="k">def</span><span class="w"> </span><span class="nf">hats</span> <span class="p">(</span><span class="n">p</span><span class="p">):</span>
        <span class="n">p</span><span class="o">.</span><span class="n">hit_steps</span><span class="p">(</span><span class="s2">&quot;hh_closed&quot;</span><span class="p">,</span> <span class="nb">list</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="mi">16</span><span class="p">)),</span> <span class="n">velocity</span><span class="o">=</span><span class="mi">80</span><span class="p">)</span>
        <span class="n">p</span><span class="o">.</span><span class="n">velocity_shape</span><span class="p">(</span><span class="n">low</span><span class="o">=</span><span class="mi">60</span><span class="p">,</span> <span class="n">high</span><span class="o">=</span><span class="mi">100</span><span class="p">)</span>

<span class="n">composition</span><span class="o">.</span><span class="n">layer</span><span class="p">(</span><span class="n">kick</span><span class="p">,</span> <span class="n">hats</span><span class="p">,</span> <span class="n">channel</span><span class="o">=</span><span class="mi">9</span><span class="p">,</span> <span class="n">length</span><span class="o">=</span><span class="mi">4</span><span class="p">,</span> <span class="n">drum_note_map</span><span class="o">=</span><span class="n">DRUM_NOTE_MAP</span><span class="p">)</span>
</code></pre>
</div>
</code></pre>
</div>


                            </div>
                            <div id="Composition.play" class="classattr">
                                        <input id="Composition.play-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">play</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span></span><span class="return-annotation">) -> <span class="kc">None</span>:</span></span>

                <label class="view-source-button" for="Composition.play-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#Composition.play"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="Composition.play-1024"><a href="#Composition.play-1024"><span class="linenos">1024</span></a>	<span class="k">def</span><span class="w"> </span><span class="nf">play</span> <span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="Composition.play-1025"><a href="#Composition.play-1025"><span class="linenos">1025</span></a>
</span><span id="Composition.play-1026"><a href="#Composition.play-1026"><span class="linenos">1026</span></a><span class="w">		</span><span class="sd">&quot;&quot;&quot;Start playback, blocking until stopped via Ctrl+C or signal.</span>
</span><span id="Composition.play-1027"><a href="#Composition.play-1027"><span class="linenos">1027</span></a>
</span><span id="Composition.play-1028"><a href="#Composition.play-1028"><span class="linenos">1028</span></a><span class="sd">		Schedules all registered patterns, harmonic state (if configured), form state (if configured),</span>
</span><span id="Composition.play-1029"><a href="#Composition.play-1029"><span class="linenos">1029</span></a><span class="sd">		and scheduled tasks. Runs the sequencer loop until interrupted.</span>
</span><span id="Composition.play-1030"><a href="#Composition.play-1030"><span class="linenos">1030</span></a>
</span><span id="Composition.play-1031"><a href="#Composition.play-1031"><span class="linenos">1031</span></a><span class="sd">		Example:</span>
</span><span id="Composition.play-1032"><a href="#Composition.play-1032"><span class="linenos">1032</span></a><span class="sd">			```python</span>
</span><span id="Composition.play-1033"><a href="#Composition.play-1033"><span class="linenos">1033</span></a><span class="sd">			if __name__ == &quot;__main__&quot;:</span>
</span><span id="Composition.play-1034"><a href="#Composition.play-1034"><span class="linenos">1034</span></a><span class="sd">				composition.play()  # Press Ctrl+C to stop</span>
</span><span id="Composition.play-1035"><a href="#Composition.play-1035"><span class="linenos">1035</span></a><span class="sd">			```</span>
</span><span id="Composition.play-1036"><a href="#Composition.play-1036"><span class="linenos">1036</span></a><span class="sd">		&quot;&quot;&quot;</span>
</span><span id="Composition.play-1037"><a href="#Composition.play-1037"><span class="linenos">1037</span></a>
</span><span id="Composition.play-1038"><a href="#Composition.play-1038"><span class="linenos">1038</span></a>		<span class="k">try</span><span class="p">:</span>
</span><span id="Composition.play-1039"><a href="#Composition.play-1039"><span class="linenos">1039</span></a>			<span class="n">asyncio</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_run</span><span class="p">())</span>
</span><span id="Composition.play-1040"><a href="#Composition.play-1040"><span class="linenos">1040</span></a>
</span><span id="Composition.play-1041"><a href="#Composition.play-1041"><span class="linenos">1041</span></a>		<span class="k">except</span> <span class="ne">KeyboardInterrupt</span><span class="p">:</span>
</span><span id="Composition.play-1042"><a href="#Composition.play-1042"><span class="linenos">1042</span></a>			<span class="k">pass</span>
</span></pre></div>


            <div class="docstring"><p>Start playback, blocking until stopped via Ctrl+C or signal.</p>

<p>Schedules all registered patterns, harmonic state (if configured), form state (if configured),
and scheduled tasks. Runs the sequencer loop until interrupted.</p>

<p>Example:</p>

<pre><code>    <div class="pdoc-code codehilite">
<pre><span></span><code><span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s2">&quot;__main__&quot;</span><span class="p">:</span>
        <span class="n">composition</span><span class="o">.</span><span class="n">play</span><span class="p">()</span>  <span class="c1"># Press Ctrl+C to stop</span>
</code></pre>
</div>
</code></pre>
</div>


                            </div>
                </section>
    </main>
<script>
    function escapeHTML(html) {
        return document.createElement('div').appendChild(document.createTextNode(html)).parentNode.innerHTML;
    }

    const originalContent = document.querySelector("main.pdoc");
    let currentContent = originalContent;

    function setContent(innerHTML) {
        let elem;
        if (innerHTML) {
            elem = document.createElement("main");
            elem.classList.add("pdoc");
            elem.innerHTML = innerHTML;
        } else {
            elem = originalContent;
        }
        if (currentContent !== elem) {
            currentContent.replaceWith(elem);
            currentContent = elem;
        }
    }

    function getSearchTerm() {
        return (new URL(window.location)).searchParams.get("search");
    }

    const searchBox = document.querySelector(".pdoc input[type=search]");
    searchBox.addEventListener("input", function () {
        let url = new URL(window.location);
        if (searchBox.value.trim()) {
            url.hash = "";
            url.searchParams.set("search", searchBox.value);
        } else {
            url.searchParams.delete("search");
        }
        history.replaceState("", "", url.toString());
        onInput();
    });
    window.addEventListener("popstate", onInput);


    let search, searchErr;

    async function initialize() {
        try {
            search = await new Promise((resolve, reject) => {
                const script = document.createElement("script");
                script.type = "text/javascript";
                script.async = true;
                script.onload = () => resolve(window.pdocSearch);
                script.onerror = (e) => reject(e);
                script.src = "search.js";
                document.getElementsByTagName("head")[0].appendChild(script);
            });
        } catch (e) {
            console.error("Cannot fetch pdoc search index");
            searchErr = "Cannot fetch search index.";
        }
        onInput();

        document.querySelector("nav.pdoc").addEventListener("click", e => {
            if (e.target.hash) {
                searchBox.value = "";
                searchBox.dispatchEvent(new Event("input"));
            }
        });
    }

    function onInput() {
        setContent((() => {
            const term = getSearchTerm();
            if (!term) {
                return null
            }
            if (searchErr) {
                return `<h3>Error: ${searchErr}</h3>`
            }
            if (!search) {
                return "<h3>Searching...</h3>"
            }

            window.scrollTo({top: 0, left: 0, behavior: 'auto'});

            const results = search(term);

            let html;
            if (results.length === 0) {
                html = `No search results for '${escapeHTML(term)}'.`
            } else {
                html = `<h4>${results.length} search result${results.length > 1 ? "s" : ""} for '${escapeHTML(term)}'.</h4>`;
            }
            for (let result of results.slice(0, 10)) {
                let doc = result.doc;
                let url = `${doc.modulename.replaceAll(".", "/")}.html`;
                if (doc.qualname) {
                    url += `#${doc.qualname}`;
                }

                let heading;
                switch (result.doc.kind) {
                    case "function":
                        if (doc.fullname.endsWith(".__init__")) {
                            heading = `<span class="name">${doc.fullname.replace(/\.__init__$/, "")}</span>${doc.signature}`;
                        } else {
                            heading = `<span class="def">${doc.funcdef}</span> <span class="name">${doc.fullname}</span>${doc.signature}`;
                        }
                        break;
                    case "class":
                        heading = `<span class="def">class</span> <span class="name">${doc.fullname}</span>`;
                        if (doc.bases)
                            heading += `<wbr>(<span class="base">${doc.bases}</span>)`;
                        heading += `:`;
                        break;
                    case "variable":
                        heading = `<span class="name">${doc.fullname}</span>`;
                        if (doc.annotation)
                            heading += `<span class="annotation">${doc.annotation}</span>`;
                        if (doc.default_value)
                            heading += `<span class="default_value"> = ${doc.default_value}</span>`;
                        break;
                    default:
                        heading = `<span class="name">${doc.fullname}</span>`;
                        break;
                }
                html += `
                        <section class="search-result">
                        <a href="${url}" class="attr ${doc.kind}">${heading}</a>
                        <div class="docstring">${doc.doc}</div>
                        </section>
                    `;

            }
            return html;
        })());
    }

    if (getSearchTerm()) {
        initialize();
        searchBox.value = getSearchTerm();
        onInput();
    } else {
        searchBox.addEventListener("focus", initialize, {once: true});
    }

    searchBox.addEventListener("keydown", e => {
        if (["ArrowDown", "ArrowUp", "Enter"].includes(e.key)) {
            let focused = currentContent.querySelector(".search-result.focused");
            if (!focused) {
                currentContent.querySelector(".search-result").classList.add("focused");
            } else if (
                e.key === "ArrowDown"
                && focused.nextElementSibling
                && focused.nextElementSibling.classList.contains("search-result")
            ) {
                focused.classList.remove("focused");
                focused.nextElementSibling.classList.add("focused");
                focused.nextElementSibling.scrollIntoView({
                    behavior: "smooth",
                    block: "nearest",
                    inline: "nearest"
                });
            } else if (
                e.key === "ArrowUp"
                && focused.previousElementSibling
                && focused.previousElementSibling.classList.contains("search-result")
            ) {
                focused.classList.remove("focused");
                focused.previousElementSibling.classList.add("focused");
                focused.previousElementSibling.scrollIntoView({
                    behavior: "smooth",
                    block: "nearest",
                    inline: "nearest"
                });
            } else if (
                e.key === "Enter"
            ) {
                focused.querySelector("a").click();
            }
        }
    });
</script></body>
</html>